!function(t,e){t&&!t.getElementById("livereloadscript")&&((e=t.createElement("script")).async=1,e.src="//"+(self.location.host||"localhost").split(":")[0]+":35729/livereload.js?snipver=1",e.id="livereloadscript",t.getElementsByTagName("head")[0].appendChild(e))}(self.document),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("fabric")):"function"==typeof define&&define.amd?define(["fabric"],e):(t="undefined"!=typeof globalThis?globalThis:t||self).FabricPathEditor=e(t.fabric)}(this,(function(t){"use strict";function e(t,e){return t===e||t!=t&&e!=e}function r(t,r){for(var n=t.length;n--;)if(e(t[n][0],r))return n;return-1}var n=Array.prototype.splice;function o(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}o.prototype.clear=function(){this.__data__=[],this.size=0},o.prototype.delete=function(t){var e=this.__data__,o=r(e,t);return!(o<0)&&(o==e.length-1?e.pop():n.call(e,o,1),--this.size,!0)},o.prototype.get=function(t){var e=this.__data__,n=r(e,t);return n<0?void 0:e[n][1]},o.prototype.has=function(t){return r(this.__data__,t)>-1},o.prototype.set=function(t,e){var n=this.__data__,o=r(n,t);return o<0?(++this.size,n.push([t,e])):n[o][1]=e,this};var i="object"==typeof global&&global&&global.Object===Object&&global,a="object"==typeof self&&self&&self.Object===Object&&self,c=i||a||Function("return this")(),s=c.Symbol,u=Object.prototype,l=u.hasOwnProperty,f=u.toString,p=s?s.toStringTag:void 0;var h=Object.prototype.toString;var v="[object Null]",b="[object Undefined]",d=s?s.toStringTag:void 0;function y(t){return null==t?void 0===t?b:v:d&&d in Object(t)?function(t){var e=l.call(t,p),r=t[p];try{t[p]=void 0;var n=!0}catch(t){}var o=f.call(t);return n&&(e?t[p]=r:delete t[p]),o}(t):function(t){return h.call(t)}(t)}function _(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}var g="[object AsyncFunction]",j="[object Function]",m="[object GeneratorFunction]",O="[object Proxy]";function A(t){if(!_(t))return!1;var e=y(t);return e==j||e==m||e==g||e==O}var w,x=c["__core-js_shared__"],P=(w=/[^.]+$/.exec(x&&x.keys&&x.keys.IE_PROTO||""))?"Symbol(src)_1."+w:"";var S=Function.prototype.toString;function E(t){if(null!=t){try{return S.call(t)}catch(t){}try{return t+""}catch(t){}}return""}var I=/^\[object .+?Constructor\]$/,T=Function.prototype,C=Object.prototype,R=T.toString,M=C.hasOwnProperty,k=RegExp("^"+R.call(M).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function U(t){return!(!_(t)||(e=t,P&&P in e))&&(A(t)?k:I).test(E(t));var e}function z(t,e){var r=function(t,e){return null==t?void 0:t[e]}(t,e);return U(r)?r:void 0}var L=z(c,"Map"),B=z(Object,"create");var N=Object.prototype.hasOwnProperty;var V=Object.prototype.hasOwnProperty;function D(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function H(t,e){var r,n,o=t.__data__;return("string"==(n=typeof(r=e))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==r:null===r)?o["string"==typeof e?"string":"hash"]:o.map}function F(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}D.prototype.clear=function(){this.__data__=B?B(null):{},this.size=0},D.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},D.prototype.get=function(t){var e=this.__data__;if(B){var r=e[t];return"__lodash_hash_undefined__"===r?void 0:r}return N.call(e,t)?e[t]:void 0},D.prototype.has=function(t){var e=this.__data__;return B?void 0!==e[t]:V.call(e,t)},D.prototype.set=function(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=B&&void 0===e?"__lodash_hash_undefined__":e,this},F.prototype.clear=function(){this.size=0,this.__data__={hash:new D,map:new(L||o),string:new D}},F.prototype.delete=function(t){var e=H(this,t).delete(t);return this.size-=e?1:0,e},F.prototype.get=function(t){return H(this,t).get(t)},F.prototype.has=function(t){return H(this,t).has(t)},F.prototype.set=function(t,e){var r=H(this,t),n=r.size;return r.set(t,e),this.size+=r.size==n?0:1,this};function $(t){var e=this.__data__=new o(t);this.size=e.size}$.prototype.clear=function(){this.__data__=new o,this.size=0},$.prototype.delete=function(t){var e=this.__data__,r=e.delete(t);return this.size=e.size,r},$.prototype.get=function(t){return this.__data__.get(t)},$.prototype.has=function(t){return this.__data__.has(t)},$.prototype.set=function(t,e){var r=this.__data__;if(r instanceof o){var n=r.__data__;if(!L||n.length<199)return n.push([t,e]),this.size=++r.size,this;r=this.__data__=new F(n)}return r.set(t,e),this.size=r.size,this};function W(t){var e=-1,r=null==t?0:t.length;for(this.__data__=new F;++e<r;)this.add(t[e])}function Q(t,e){for(var r=-1,n=null==t?0:t.length;++r<n;)if(e(t[r],r,t))return!0;return!1}W.prototype.add=W.prototype.push=function(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this},W.prototype.has=function(t){return this.__data__.has(t)};var X=1,Y=2;function Z(t,e,r,n,o,i){var a=r&X,c=t.length,s=e.length;if(c!=s&&!(a&&s>c))return!1;var u=i.get(t),l=i.get(e);if(u&&l)return u==e&&l==t;var f=-1,p=!0,h=r&Y?new W:void 0;for(i.set(t,e),i.set(e,t);++f<c;){var v=t[f],b=e[f];if(n)var d=a?n(b,v,f,e,t,i):n(v,b,f,t,e,i);if(void 0!==d){if(d)continue;p=!1;break}if(h){if(!Q(e,(function(t,e){if(a=e,!h.has(a)&&(v===t||o(v,t,r,n,i)))return h.push(e);var a}))){p=!1;break}}else if(v!==b&&!o(v,b,r,n,i)){p=!1;break}}return i.delete(t),i.delete(e),p}var q=c.Uint8Array;function G(t){var e=-1,r=Array(t.size);return t.forEach((function(t,n){r[++e]=[n,t]})),r}function J(t){var e=-1,r=Array(t.size);return t.forEach((function(t){r[++e]=t})),r}var K=1,tt=2,et="[object Boolean]",rt="[object Date]",nt="[object Error]",ot="[object Map]",it="[object Number]",at="[object RegExp]",ct="[object Set]",st="[object String]",ut="[object Symbol]",lt="[object ArrayBuffer]",ft="[object DataView]",pt=s?s.prototype:void 0,ht=pt?pt.valueOf:void 0;function vt(t,e){for(var r=-1,n=e.length,o=t.length;++r<n;)t[o+r]=e[r];return t}var bt=Array.isArray;function dt(t,e,r){var n=e(t);return bt(t)?n:vt(n,r(t))}function yt(){return[]}var _t=Object.prototype.propertyIsEnumerable,gt=Object.getOwnPropertySymbols,jt=gt?function(t){return null==t?[]:(t=Object(t),function(t,e){for(var r=-1,n=null==t?0:t.length,o=0,i=[];++r<n;){var a=t[r];e(a,r,t)&&(i[o++]=a)}return i}(gt(t),(function(e){return _t.call(t,e)})))}:yt;function mt(t){return null!=t&&"object"==typeof t}function Ot(t){return mt(t)&&"[object Arguments]"==y(t)}var At=Object.prototype,wt=At.hasOwnProperty,xt=At.propertyIsEnumerable,Pt=Ot(function(){return arguments}())?Ot:function(t){return mt(t)&&wt.call(t,"callee")&&!xt.call(t,"callee")};var St="object"==typeof exports&&exports&&!exports.nodeType&&exports,Et=St&&"object"==typeof module&&module&&!module.nodeType&&module,It=Et&&Et.exports===St?c.Buffer:void 0,Tt=(It?It.isBuffer:void 0)||function(){return!1},Ct=9007199254740991,Rt=/^(?:0|[1-9]\d*)$/;function Mt(t,e){var r=typeof t;return!!(e=null==e?Ct:e)&&("number"==r||"symbol"!=r&&Rt.test(t))&&t>-1&&t%1==0&&t<e}var kt=9007199254740991;function Ut(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=kt}var zt={};function Lt(t){return function(e){return t(e)}}zt["[object Float32Array]"]=zt["[object Float64Array]"]=zt["[object Int8Array]"]=zt["[object Int16Array]"]=zt["[object Int32Array]"]=zt["[object Uint8Array]"]=zt["[object Uint8ClampedArray]"]=zt["[object Uint16Array]"]=zt["[object Uint32Array]"]=!0,zt["[object Arguments]"]=zt["[object Array]"]=zt["[object ArrayBuffer]"]=zt["[object Boolean]"]=zt["[object DataView]"]=zt["[object Date]"]=zt["[object Error]"]=zt["[object Function]"]=zt["[object Map]"]=zt["[object Number]"]=zt["[object Object]"]=zt["[object RegExp]"]=zt["[object Set]"]=zt["[object String]"]=zt["[object WeakMap]"]=!1;var Bt="object"==typeof exports&&exports&&!exports.nodeType&&exports,Nt=Bt&&"object"==typeof module&&module&&!module.nodeType&&module,Vt=Nt&&Nt.exports===Bt&&i.process,Dt=function(){try{var t=Nt&&Nt.require&&Nt.require("util").types;return t||Vt&&Vt.binding&&Vt.binding("util")}catch(t){}}(),Ht=Dt&&Dt.isTypedArray,Ft=Ht?Lt(Ht):function(t){return mt(t)&&Ut(t.length)&&!!zt[y(t)]},$t=Object.prototype.hasOwnProperty;function Wt(t,e){var r=bt(t),n=!r&&Pt(t),o=!r&&!n&&Tt(t),i=!r&&!n&&!o&&Ft(t),a=r||n||o||i,c=a?function(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n}(t.length,String):[],s=c.length;for(var u in t)!e&&!$t.call(t,u)||a&&("length"==u||o&&("offset"==u||"parent"==u)||i&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||Mt(u,s))||c.push(u);return c}var Qt=Object.prototype;function Xt(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||Qt)}function Yt(t,e){return function(r){return t(e(r))}}var Zt=Yt(Object.keys,Object),qt=Object.prototype.hasOwnProperty;function Gt(t){return null!=t&&Ut(t.length)&&!A(t)}function Jt(t){return Gt(t)?Wt(t):function(t){if(!Xt(t))return Zt(t);var e=[];for(var r in Object(t))qt.call(t,r)&&"constructor"!=r&&e.push(r);return e}(t)}function Kt(t){return dt(t,Jt,jt)}var te=1,ee=Object.prototype.hasOwnProperty;var re=z(c,"DataView"),ne=z(c,"Promise"),oe=z(c,"Set"),ie=z(c,"WeakMap"),ae="[object Map]",ce="[object Promise]",se="[object Set]",ue="[object WeakMap]",le="[object DataView]",fe=E(re),pe=E(L),he=E(ne),ve=E(oe),be=E(ie),de=y;(re&&de(new re(new ArrayBuffer(1)))!=le||L&&de(new L)!=ae||ne&&de(ne.resolve())!=ce||oe&&de(new oe)!=se||ie&&de(new ie)!=ue)&&(de=function(t){var e=y(t),r="[object Object]"==e?t.constructor:void 0,n=r?E(r):"";if(n)switch(n){case fe:return le;case pe:return ae;case he:return ce;case ve:return se;case be:return ue}return e});var ye=de,_e=1,ge="[object Arguments]",je="[object Array]",me="[object Object]",Oe=Object.prototype.hasOwnProperty;function Ae(t,r,n,o,i,a){var c=bt(t),s=bt(r),u=c?je:ye(t),l=s?je:ye(r),f=(u=u==ge?me:u)==me,p=(l=l==ge?me:l)==me,h=u==l;if(h&&Tt(t)){if(!Tt(r))return!1;c=!0,f=!1}if(h&&!f)return a||(a=new $),c||Ft(t)?Z(t,r,n,o,i,a):function(t,r,n,o,i,a,c){switch(n){case ft:if(t.byteLength!=r.byteLength||t.byteOffset!=r.byteOffset)return!1;t=t.buffer,r=r.buffer;case lt:return!(t.byteLength!=r.byteLength||!a(new q(t),new q(r)));case et:case rt:case it:return e(+t,+r);case nt:return t.name==r.name&&t.message==r.message;case at:case st:return t==r+"";case ot:var s=G;case ct:var u=o&K;if(s||(s=J),t.size!=r.size&&!u)return!1;var l=c.get(t);if(l)return l==r;o|=tt,c.set(t,r);var f=Z(s(t),s(r),o,i,a,c);return c.delete(t),f;case ut:if(ht)return ht.call(t)==ht.call(r)}return!1}(t,r,u,n,o,i,a);if(!(n&_e)){var v=f&&Oe.call(t,"__wrapped__"),b=p&&Oe.call(r,"__wrapped__");if(v||b){var d=v?t.value():t,y=b?r.value():r;return a||(a=new $),i(d,y,n,o,a)}}return!!h&&(a||(a=new $),function(t,e,r,n,o,i){var a=r&te,c=Kt(t),s=c.length;if(s!=Kt(e).length&&!a)return!1;for(var u=s;u--;){var l=c[u];if(!(a?l in e:ee.call(e,l)))return!1}var f=i.get(t),p=i.get(e);if(f&&p)return f==e&&p==t;var h=!0;i.set(t,e),i.set(e,t);for(var v=a;++u<s;){var b=t[l=c[u]],d=e[l];if(n)var y=a?n(d,b,l,e,t,i):n(b,d,l,t,e,i);if(!(void 0===y?b===d||o(b,d,r,n,i):y)){h=!1;break}v||(v="constructor"==l)}if(h&&!v){var _=t.constructor,g=e.constructor;_==g||!("constructor"in t)||!("constructor"in e)||"function"==typeof _&&_ instanceof _&&"function"==typeof g&&g instanceof g||(h=!1)}return i.delete(t),i.delete(e),h}(t,r,n,o,i,a))}function we(t,e,r,n,o){return t===e||(null==t||null==e||!mt(t)&&!mt(e)?t!=t&&e!=e:Ae(t,e,r,n,we,o))}var xe=function(){try{var t=z(Object,"defineProperty");return t({},"",{}),t}catch(t){}}();function Pe(t,e,r){"__proto__"==e&&xe?xe(t,e,{configurable:!0,enumerable:!0,value:r,writable:!0}):t[e]=r}var Se=Object.prototype.hasOwnProperty;function Ee(t,r,n){var o=t[r];Se.call(t,r)&&e(o,n)&&(void 0!==n||r in t)||Pe(t,r,n)}function Ie(t,e,r,n){var o=!r;r||(r={});for(var i=-1,a=e.length;++i<a;){var c=e[i],s=n?n(r[c],t[c],c,r,t):void 0;void 0===s&&(s=t[c]),o?Pe(r,c,s):Ee(r,c,s)}return r}var Te=Object.prototype.hasOwnProperty;function Ce(t){if(!_(t))return function(t){var e=[];if(null!=t)for(var r in Object(t))e.push(r);return e}(t);var e=Xt(t),r=[];for(var n in t)("constructor"!=n||!e&&Te.call(t,n))&&r.push(n);return r}function Re(t){return Gt(t)?Wt(t,!0):Ce(t)}var Me="object"==typeof exports&&exports&&!exports.nodeType&&exports,ke=Me&&"object"==typeof module&&module&&!module.nodeType&&module,Ue=ke&&ke.exports===Me?c.Buffer:void 0,ze=Ue?Ue.allocUnsafe:void 0;var Le=Yt(Object.getPrototypeOf,Object),Be=Object.getOwnPropertySymbols?function(t){for(var e=[];t;)vt(e,jt(t)),t=Le(t);return e}:yt;function Ne(t){return dt(t,Re,Be)}var Ve=Object.prototype.hasOwnProperty;function De(t){var e=new t.constructor(t.byteLength);return new q(e).set(new q(t)),e}var He=/\w*$/;var Fe=s?s.prototype:void 0,$e=Fe?Fe.valueOf:void 0;var We="[object Boolean]",Qe="[object Date]",Xe="[object Map]",Ye="[object Number]",Ze="[object RegExp]",qe="[object Set]",Ge="[object String]",Je="[object Symbol]",Ke="[object ArrayBuffer]",tr="[object DataView]",er="[object Float32Array]",rr="[object Float64Array]",nr="[object Int8Array]",or="[object Int16Array]",ir="[object Int32Array]",ar="[object Uint8Array]",cr="[object Uint8ClampedArray]",sr="[object Uint16Array]",ur="[object Uint32Array]";function lr(t,e,r){var n,o,i,a=t.constructor;switch(e){case Ke:return De(t);case We:case Qe:return new a(+t);case tr:return function(t,e){var r=e?De(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.byteLength)}(t,r);case er:case rr:case nr:case or:case ir:case ar:case cr:case sr:case ur:return function(t,e){var r=e?De(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.length)}(t,r);case Xe:return new a;case Ye:case Ge:return new a(t);case Ze:return(i=new(o=t).constructor(o.source,He.exec(o))).lastIndex=o.lastIndex,i;case qe:return new a;case Je:return n=t,$e?Object($e.call(n)):{}}}var fr=Object.create,pr=function(){function t(){}return function(e){if(!_(e))return{};if(fr)return fr(e);t.prototype=e;var r=new t;return t.prototype=void 0,r}}();var hr=Dt&&Dt.isMap,vr=hr?Lt(hr):function(t){return mt(t)&&"[object Map]"==ye(t)};var br=Dt&&Dt.isSet,dr=br?Lt(br):function(t){return mt(t)&&"[object Set]"==ye(t)},yr=1,_r=2,gr=4,jr="[object Arguments]",mr="[object Function]",Or="[object GeneratorFunction]",Ar="[object Object]",wr={};function xr(t,e,r,n,o,i){var a,c=e&yr,s=e&_r,u=e&gr;if(r&&(a=o?r(t,n,o,i):r(t)),void 0!==a)return a;if(!_(t))return t;var l=bt(t);if(l){if(a=function(t){var e=t.length,r=new t.constructor(e);return e&&"string"==typeof t[0]&&Ve.call(t,"index")&&(r.index=t.index,r.input=t.input),r}(t),!c)return function(t,e){var r=-1,n=t.length;for(e||(e=Array(n));++r<n;)e[r]=t[r];return e}(t,a)}else{var f=ye(t),p=f==mr||f==Or;if(Tt(t))return function(t,e){if(e)return t.slice();var r=t.length,n=ze?ze(r):new t.constructor(r);return t.copy(n),n}(t,c);if(f==Ar||f==jr||p&&!o){if(a=s||p?{}:function(t){return"function"!=typeof t.constructor||Xt(t)?{}:pr(Le(t))}(t),!c)return s?function(t,e){return Ie(t,Be(t),e)}(t,function(t,e){return t&&Ie(e,Re(e),t)}(a,t)):function(t,e){return Ie(t,jt(t),e)}(t,function(t,e){return t&&Ie(e,Jt(e),t)}(a,t))}else{if(!wr[f])return o?t:{};a=lr(t,f,c)}}i||(i=new $);var h=i.get(t);if(h)return h;i.set(t,a),dr(t)?t.forEach((function(n){a.add(xr(n,e,r,n,t,i))})):vr(t)&&t.forEach((function(n,o){a.set(o,xr(n,e,r,o,t,i))}));var v=l?void 0:(u?s?Ne:Kt:s?Re:Jt)(t);return function(t,e){for(var r=-1,n=null==t?0:t.length;++r<n&&!1!==e(t[r],r,t););}(v||t,(function(n,o){v&&(n=t[o=n]),Ee(a,o,xr(n,e,r,o,t,i))})),a}wr[jr]=wr["[object Array]"]=wr["[object ArrayBuffer]"]=wr["[object DataView]"]=wr["[object Boolean]"]=wr["[object Date]"]=wr["[object Float32Array]"]=wr["[object Float64Array]"]=wr["[object Int8Array]"]=wr["[object Int16Array]"]=wr["[object Int32Array]"]=wr["[object Map]"]=wr["[object Number]"]=wr[Ar]=wr["[object RegExp]"]=wr["[object Set]"]=wr["[object String]"]=wr["[object Symbol]"]=wr["[object Uint8Array]"]=wr["[object Uint8ClampedArray]"]=wr["[object Uint16Array]"]=wr["[object Uint32Array]"]=!0,wr["[object Error]"]=wr[mr]=wr["[object WeakMap]"]=!1;function Pr(t){return xr(t,5)}function Sr(t){return t}var Er=Math.max;var Ir=xe?function(t,e){return xe(t,"toString",{configurable:!0,enumerable:!1,value:(r=e,function(){return r}),writable:!0});var r}:Sr,Tr=Ir,Cr=Date.now;var Rr,Mr,kr,Ur=(Rr=Tr,Mr=0,kr=0,function(){var t=Cr(),e=16-(t-kr);if(kr=t,e>0){if(++Mr>=800)return arguments[0]}else Mr=0;return Rr.apply(void 0,arguments)});var zr=Object.prototype,Lr=zr.hasOwnProperty,Br=function(t,e){return Ur(function(t,e,r){return e=Er(void 0===e?t.length-1:e,0),function(){for(var n=arguments,o=-1,i=Er(n.length-e,0),a=Array(i);++o<i;)a[o]=n[e+o];o=-1;for(var c=Array(e+1);++o<e;)c[o]=n[o];return c[e]=r(a),function(t,e,r){switch(r.length){case 0:return t.call(e);case 1:return t.call(e,r[0]);case 2:return t.call(e,r[0],r[1]);case 3:return t.call(e,r[0],r[1],r[2])}return t.apply(e,r)}(t,this,c)}}(t,e,Sr),t+"")}((function(t,r){t=Object(t);var n=-1,o=r.length,i=o>2?r[2]:void 0;for(i&&function(t,r,n){if(!_(n))return!1;var o=typeof r;return!!("number"==o?Gt(n)&&Mt(r,n.length):"string"==o&&r in n)&&e(n[r],t)}(r[0],r[1],i)&&(o=1);++n<o;)for(var a=r[n],c=Re(a),s=-1,u=c.length;++s<u;){var l=c[s],f=t[l];(void 0===f||e(f,zr[l])&&!Lr.call(t,l))&&(t[l]=a[l])}return t})),Nr=/\s/;var Vr=/^\s+/;function Dr(t){return t?t.slice(0,function(t){for(var e=t.length;e--&&Nr.test(t.charAt(e)););return e}(t)+1).replace(Vr,""):t}var Hr="[object Symbol]";function Fr(t){return"symbol"==typeof t||mt(t)&&y(t)==Hr}var $r=NaN,Wr=/^[-+]0x[0-9a-f]+$/i,Qr=/^0b[01]+$/i,Xr=/^0o[0-7]+$/i,Yr=parseInt;function Zr(t){if("number"==typeof t)return t;if(Fr(t))return $r;if(_(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=_(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=Dr(t);var r=Qr.test(t);return r||Xr.test(t)?Yr(t.slice(2),r?2:8):Wr.test(t)?$r:+t}var qr=1/0,Gr=17976931348623157e292;function Jr(t){var e=function(t){return t?(t=Zr(t))===qr||t===-qr?(t<0?-1:1)*Gr:t==t?t:0:0===t?t:0}(t),r=e%1;return e==e?r?e-r:e:0}var Kr=1/0,tn=s?s.prototype:void 0,en=tn?tn.toString:void 0;function rn(t){if("string"==typeof t)return t;if(bt(t))return function(t,e){for(var r=-1,n=null==t?0:t.length,o=Array(n);++r<n;)o[r]=e(t[r],r,t);return o}(t,rn)+"";if(Fr(t))return en?en.call(t):"";var e=t+"";return"0"==e&&1/t==-Kr?"-0":e}function nn(t){return null==t?"":rn(t)}var on=c.isFinite,an=Math.min;var cn=function(t){var e=Math[t];return function(t,r){if(t=Zr(t),(r=null==r?0:an(Jr(r),292))&&on(t)){var n=(nn(t)+"e").split("e");return+((n=(nn(e(n[0]+"e"+(+n[1]+r)))+"e").split("e"))[0]+"e"+(+n[1]-r))}return e(t)}}("round");const sn=Symbol("fabric-path-editor-symbol"),un=Symbol("fabric-path-editor-controller-info");var ln,fn;!function(t){t.MAJOR_POINT="major-point",t.SUB_POINT="sub-point"}(ln||(ln={})),function(t){t.START="M",t.LINE="L",t.QUADRATIC_CURCE="Q",t.BEZIER_CURVE="C",t.CLOSE="z"}(fn||(fn={}));class pn{constructor(t,e={}){this._options={},this.source=null,this.target=null,this.controllers={points:[]},this.listeners=[],this._inbuiltStatus={cancelHandlerMirrorMove:!1},this._storePlatformStatus=null,this._platform=t,this._options=Br(e,this._options)}observe(t){this.source=t}static transformPath(t,e,r=!0){const{translate:n,scale:o,rotate:i}=e,a=r?t.path:Pr(t.path);return null==a||a.forEach(((t,e)=>{const[,...r]=t;for(let t=0;t<r.length;t+=2){let r=a[e][t+1],c=a[e][t+2];void 0!==o&&(r*=o.x,c*=o.y),void 0!==i&&(r=Math.cos(i*Math.PI/180)*r-Math.sin(i*Math.PI/180)*c,c=Math.sin(i*Math.PI/180)*r+Math.cos(i*Math.PI/180)*c),void 0!==n&&(r+=n.x,c+=n.y),a[e][t+1]=r,a[e][t+2]=c}})),a}static initializePath(e,r,n=[1,0,0,1,0,0]){var o;const i=e.left,a=e.top;null===(o=e.path)||void 0===o||o.forEach((t=>{const[,...e]=t;for(let r=0;r<e.length;r+=2)t[r+1]=cn(t[r+1],3),t[r+2]=cn(t[r+2],3)}));const c=new t.fabric.Path(t.fabric.util.joinPath(e.path)).getCenterPoint();e.initialize(r);const s=new t.fabric.Path(r).getCenterPoint(),u=t.fabric.util.transformPoint(new t.fabric.Point(s.x-c.x,s.y-c.y),n);e.set({left:i+u.x,top:a+u.y}),e.setCoords()}_patchPath(e){if(!e.path)return;const r=e.path;pn.transformPath(e,{translate:{x:-e.pathOffset.x,y:-e.pathOffset.y}});if(r[r.length-1][0]===fn.CLOSE){const t=r[0].slice(r[0].length-2),e=r[r.length-2].slice(r[r.length-2].length-2);r[0]!==r[r.length-2]&&e[0]===t[0]&&e[1]===t[1]||r.splice(r.length-1,0,[fn.LINE,t[0],t[1]])}e.pathOffset=new t.fabric.Point(0,0)}_initPlatformStatus(){var t;if(!this._platform)return;const e=this._platform;this._storePlatformStatus={canvasSelection:null!==(t=e.selection)&&void 0!==t&&t,objectSelections:new WeakMap(e._objects.map((t=>{var e;return[t,null===(e=t.selectable)||void 0===e||e]})))},e.selection=!1,e.preserveObjectStacking=!0,e.controlsAboveOverlay=!0,e.discardActiveObject(),e.forEachObject((t=>{t.set({selectable:!1})}))}_getPointInstructions(t){var e,r;const n=t[un].instruction,o=null===(e=this.target)||void 0===e?void 0:e.path;if(!o)return{cur:null,next:null,pre:null};const i=o.indexOf(n);let a=o[i-1],c=o[i+1];return(null===(r=o[o.length-1])||void 0===r?void 0:r[0])===fn.CLOSE&&!a&&(a=o[o.length-2]),c&&c[0]===fn.CLOSE&&(c=o[0]),{cur:n,pre:null!=a?a:null,next:null!=c?c:null}}_getInstructionPoint(t){return this.controllers.points.find((e=>e[un].instruction===t))}_getPointAroundPoints(t){const{cur:e,pre:r,next:n}=this._getPointInstructions(t);if(!e)return{cur:null,pre:null,next:null};let o=null,i=null;switch(e[0]){case fn.START:(null==r?void 0:r[0])===fn.QUADRATIC_CURCE&&(o={instruction:r,instructionValueIdx:r.length-2,point:{x:r[r.length-2],y:r[r.length-1]}}),(null==r?void 0:r[0])===fn.BEZIER_CURVE&&(o={instruction:r,instructionValueIdx:r.length-4,point:{x:r[r.length-4],y:r[r.length-3]}});break;case fn.LINE:r&&(o={instruction:r,instructionValueIdx:r.length-2,point:{x:r[r.length-2],y:r[r.length-1]}});break;case fn.QUADRATIC_CURCE:o={instruction:e,instructionValueIdx:1,point:{x:e[1],y:e[2]}};break;case fn.BEZIER_CURVE:o={instruction:e,instructionValueIdx:3,point:{x:e[3],y:e[4]}};case fn.CLOSE:}return n&&n[0]!==fn.CLOSE&&(i={instruction:n,instructionValueIdx:1,point:{x:n[1],y:n[2]}}),{cur:{instruction:e,instructionValueIdx:e.length-2,point:{x:e[e.length-2],y:e[e.length-1]}},pre:o,next:i}}_withSourceTransform(e){const r=t.fabric.util.transformPoint(new t.fabric.Point(e.x,e.y),this.source.calcOwnMatrix());return{left:r.x,top:r.y}}_invertSourceTransform(e){const r=t.fabric.util.transformPoint(new t.fabric.Point(e.x,e.y),t.fabric.util.invertTransform(this.source.calcOwnMatrix()));return{left:r.x,top:r.y}}_initPathControlPoints(){const e=this._platform,r=this.target;if(!e||!r)return;const n=this.controllers.points;n.length&&e.remove(...n);const o=[],i=r.path;null==i||i.forEach(((e,r)=>{var a,c;const s=e;if(s[0]===fn.CLOSE)return;if((null===(a=i[r+1])||void 0===a?void 0:a[0])===fn.CLOSE)return;const[u,l]=s.slice(s.length-2),f=null!==(c=n.pop())&&void 0!==c?c:new t.fabric.Group([new t.fabric.Circle({strokeWidth:4,radius:6,fill:"#ffffff",stroke:"#4b4b4b",originX:"center",originY:"center"})],{originX:"center",originY:"center",hasBorders:!1,hasControls:!1});f[sn]=!0,f[un]={type:ln.MAJOR_POINT,instruction:s,instructionValueIdx:s.length-2},this._observe(f,(({left:t,top:e})=>{const{pre:r}=this._getPointInstructions(f),{preHandler:n,nextHandler:o}=this.controllers,i=t-s[s.length-2],a=e-s[s.length-1];n&&n.point.set({left:n.point.left+i,top:n.point.top+a}),o&&o.point.set({left:o.point.left+i,top:o.point.top+a}),s[s.length-2]=t,s[s.length-1]=e,s[0]===fn.START&&r&&(r[r.length-2]=t),s[0]===fn.START&&r&&(r[r.length-1]=e),f.setCoords()})),f.set(this._withSourceTransform({x:u,y:l})),o.push(f)})),e.add(...o),this.controllers.points=o}_initPathControlHandlers(){return["pre","next"].forEach((e=>{const r=new t.fabric.Group([new t.fabric.Circle({radius:4,stroke:"#bebebe",strokeWidth:2,fill:"#bebebe",originX:"center",originY:"center"})],{originX:"center",originY:"center",hasBorders:!1,hasControls:!1});r[sn]=!0,r[un]={type:ln.SUB_POINT};const n=new t.fabric.Line([0,0,0,0],{stroke:"#bebebe",strokeWidth:1,strokeDashArray:[4,3],strokeUniform:!0,selectable:!1,evented:!1,originX:"center",originY:"center"});this.controllers[`${e}Handler`]={point:r,line:n}})),this.controllers}_observe(t,e){var r,n;let o=null!==(r=t.left)&&void 0!==r?r:0,i=null!==(n=t.top)&&void 0!==n?n:0;Object.defineProperties(t,{left:{get:()=>o,set:t=>{if(o===t)return;const r={x:o,y:i};o=t,e(this._invertSourceTransform({x:o,y:i}),this._invertSourceTransform(r))}},top:{get:()=>i,set:t=>{if(i===t)return;const r={x:o,y:i};i=t,e(this._invertSourceTransform({x:o,y:i}),this._invertSourceTransform(r))}}})}_on(t,e,r){"global"===t&&window.addEventListener(e,r),"canvas"===t&&this._platform.on(e,r),this.listeners.push({type:t,eventName:e,handler:r})}_initEvents(){(()=>{this._on("canvas","selection:created",(t=>{this.focus(...t.selected)})),this._on("canvas","selection:updated",(t=>{this.focus(...t.selected)})),this._on("canvas","selection:cleared",(t=>{this.focus()}))})(),(()=>{let t;const e=[{combinationKeys:["alt"],onActivate:()=>{this._inbuiltStatus.cancelHandlerMirrorMove=!0},onDeactivate:()=>{this._inbuiltStatus.cancelHandlerMirrorMove=!1}},{key:"backspace",onActivate:()=>{this.remove()}}],r=()=>{var e;t&&(null===(e=t.onDeactivate)||void 0===e||e.call(t),t=void 0)},n=n=>{let o=n.key.toLowerCase();e.forEach((e=>{var i;const{key:a,combinationKeys:c=[]}=e;(a||0!==c.length)&&("keyup"===n.type&&(o=""),a&&a!==o||c.some((t=>!n[`${t}Key`]))?"keyup"===n.type&&r():t!==e&&(null===(i=null==t?void 0:t.onDeactivate)||void 0===i||i.call(t),t=e,null==t||t.onActivate()))}))};this._on("global","keydown",n.bind(this)),this._on("global","keyup",n.bind(this)),this._on("global","blur",r)})()}async enterEditing(t){if(!this.source||"path"!==this.source.type)throw Error("Please observe target path before editing.");this._initPlatformStatus(),this.target=await new Promise((t=>this.source.clone(t))),this._patchPath(this.target),t&&t(this.target),this.target[sn]=!0,this.target.set({selectable:!1,objectCaching:!1}),this._platform.add(this.target),this._platform.renderOnAddRemove=!1,this._initPathControlPoints(),this._initPathControlHandlers(),this._platform.renderOnAddRemove=!0,this._platform.renderAll(),this._initEvents()}leaveEditing(){}focus(...t){const e=this._platform,{preHandler:r,nextHandler:n,activePoint:o}=this.controllers,i=t[0],a=t=>{if(!t)return;t.item(0).set({fill:"#ffffff"});const{preHandler:r,nextHandler:n}=this.controllers;r&&(e.remove(r.point),e.remove(r.line)),n&&(e.remove(n.point),e.remove(n.line))},c=t=>{t.item(0).set({fill:"#29ca6e"});const{cur:r,pre:n,next:o}=this._getPointAroundPoints(t),{preHandler:i,nextHandler:a}=this.controllers;let c=!0;[{target:i,mirrorTarget:a,instruction:n,hidden:!(null==n?void 0:n.point)||!r||r.instruction[0]===fn.LINE},{target:a,mirrorTarget:i,instruction:o,hidden:!(null==o?void 0:o.point)||o.instruction[0]===fn.LINE}].forEach((({target:r,mirrorTarget:n,instruction:o,hidden:i})=>{r&&(i?this._observe(r.point,(()=>{})):(null==o?void 0:o.point)&&(r.point[un].instruction=o.instruction,r.point[un].instructionValueIdx=o.instructionValueIdx,this._observe(r.point,(({left:e,top:i})=>{r.line.set({x1:t.left,y1:t.top,x2:r.point.left,y2:r.point.top}),o.instruction[o.instructionValueIdx]=e,o.instruction[o.instructionValueIdx+1]=i,this._inbuiltStatus.cancelHandlerMirrorMove?c=!1:c&&this.controllers.activeHandlerPoint&&n&&(n.point.set({left:2*t.left-r.point.left,top:2*t.top-r.point.top}),n.line.set({x1:t.left,y1:t.top,x2:n.point.left,y2:n.point.top})),r.point.setCoords()})),r.point.set(this._withSourceTransform(o.point)),e.add(r.line,r.point)))})),c=void 0!==i&&void 0!==a&&i.point.left+a.point.left===2*t.left&&i.point.top+a.point.top===2*t.top,e.renderAll()},s=t=>{const e=[r,n].find((e=>(null==e?void 0:e.point)===t));e&&e.point.item(0).set({stroke:"#4b4b4b"}),this.controllers.activeHandlerPoint=t};(()=>{[r,n].forEach((t=>{t&&t.point.item(0).set({stroke:"#bebebe"})})),this.controllers.activeHandlerPoint=void 0})(),i?(i[un].type===ln.MAJOR_POINT&&(a(o),c(i),this.controllers.activePoint=i),i[un].type===ln.SUB_POINT&&s(i),e.setActiveObject(i)):(a(o),this.controllers.activePoint=void 0,e.discardActiveObject()),e.renderAll()}remove(t){var e,r,n;if(void 0===t&&(t=null!==(e=this.controllers.activeHandlerPoint)&&void 0!==e?e:this.controllers.activePoint),!t||!this.target)return;const o=this._platform,i=this.target.path;if(!i)return;const{type:a,instruction:c}=t[un];if(c){switch(a){case ln.MAJOR_POINT:{const t=i.indexOf(c),e=Pr(i),o=e.splice(0,t+1);o.pop(),e.length&&(null===(r=o[0])||void 0===r?void 0:r[0])===fn.START&&o.shift(),(null===(n=e[e.length-1])||void 0===n?void 0:n[0])===fn.CLOSE&&e.pop(),e.push(...o);const a=e[e.length-1];c[0]===fn.START&&a&&(s=a.slice(a.length-2),u=c.slice(1),we(s,u))&&e.pop();const l=e[0];l&&(l.splice(1,{[fn.START]:0,[fn.LINE]:0,[fn.BEZIER_CURVE]:4,[fn.QUADRATIC_CURCE]:2}[l[0]]),l[0]=fn.START),this.target.path=e,this._initPathControlPoints();break}case ln.SUB_POINT:c.splice(1,{[fn.BEZIER_CURVE]:4,[fn.QUADRATIC_CURCE]:2}[c[0]]),c[0]=fn.LINE,this.focus(this.controllers.activePoint)}var s,u;o.requestRenderAll()}}destory(){}}return pn}));
