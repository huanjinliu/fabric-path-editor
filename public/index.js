!function(t,e){t&&!t.getElementById("livereloadscript")&&((e=t.createElement("script")).async=1,e.src="//"+(self.location.host||"localhost").split(":")[0]+":35729/livereload.js?snipver=1",e.id="livereloadscript",t.getElementsByTagName("head")[0].appendChild(e))}(self.document),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("fabric")):"function"==typeof define&&define.amd?define(["fabric"],e):(t="undefined"!=typeof globalThis?globalThis:t||self).FabricPathEditor=e(t.fabric)}(this,(function(t){"use strict";function e(t,e){return t===e||t!=t&&e!=e}function r(t,r){for(var n=t.length;n--;)if(e(t[n][0],r))return n;return-1}var n=Array.prototype.splice;function o(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}o.prototype.clear=function(){this.__data__=[],this.size=0},o.prototype.delete=function(t){var e=this.__data__,o=r(e,t);return!(o<0)&&(o==e.length-1?e.pop():n.call(e,o,1),--this.size,!0)},o.prototype.get=function(t){var e=this.__data__,n=r(e,t);return n<0?void 0:e[n][1]},o.prototype.has=function(t){return r(this.__data__,t)>-1},o.prototype.set=function(t,e){var n=this.__data__,o=r(n,t);return o<0?(++this.size,n.push([t,e])):n[o][1]=e,this};var i="object"==typeof global&&global&&global.Object===Object&&global,a="object"==typeof self&&self&&self.Object===Object&&self,c=i||a||Function("return this")(),s=c.Symbol,l=Object.prototype,u=l.hasOwnProperty,f=l.toString,p=s?s.toStringTag:void 0;var h=Object.prototype.toString;var v="[object Null]",b="[object Undefined]",d=s?s.toStringTag:void 0;function y(t){return null==t?void 0===t?b:v:d&&d in Object(t)?function(t){var e=u.call(t,p),r=t[p];try{t[p]=void 0;var n=!0}catch(t){}var o=f.call(t);return n&&(e?t[p]=r:delete t[p]),o}(t):function(t){return h.call(t)}(t)}function _(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}var g="[object AsyncFunction]",j="[object Function]",m="[object GeneratorFunction]",O="[object Proxy]";function A(t){if(!_(t))return!1;var e=y(t);return e==j||e==m||e==g||e==O}var P,w=c["__core-js_shared__"],x=(P=/[^.]+$/.exec(w&&w.keys&&w.keys.IE_PROTO||""))?"Symbol(src)_1."+P:"";var E=Function.prototype.toString;function S(t){if(null!=t){try{return E.call(t)}catch(t){}try{return t+""}catch(t){}}return""}var I=/^\[object .+?Constructor\]$/,C=Function.prototype,R=Object.prototype,T=C.toString,M=R.hasOwnProperty,k=RegExp("^"+T.call(M).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function U(t){return!(!_(t)||(e=t,x&&x in e))&&(A(t)?k:I).test(S(t));var e}function L(t,e){var r=function(t,e){return null==t?void 0:t[e]}(t,e);return U(r)?r:void 0}var z=L(c,"Map"),B=L(Object,"create");var N=Object.prototype.hasOwnProperty;var V=Object.prototype.hasOwnProperty;function D(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function H(t,e){var r,n,o=t.__data__;return("string"==(n=typeof(r=e))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==r:null===r)?o["string"==typeof e?"string":"hash"]:o.map}function F(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}D.prototype.clear=function(){this.__data__=B?B(null):{},this.size=0},D.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},D.prototype.get=function(t){var e=this.__data__;if(B){var r=e[t];return"__lodash_hash_undefined__"===r?void 0:r}return N.call(e,t)?e[t]:void 0},D.prototype.has=function(t){var e=this.__data__;return B?void 0!==e[t]:V.call(e,t)},D.prototype.set=function(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=B&&void 0===e?"__lodash_hash_undefined__":e,this},F.prototype.clear=function(){this.size=0,this.__data__={hash:new D,map:new(z||o),string:new D}},F.prototype.delete=function(t){var e=H(this,t).delete(t);return this.size-=e?1:0,e},F.prototype.get=function(t){return H(this,t).get(t)},F.prototype.has=function(t){return H(this,t).has(t)},F.prototype.set=function(t,e){var r=H(this,t),n=r.size;return r.set(t,e),this.size+=r.size==n?0:1,this};function $(t){var e=this.__data__=new o(t);this.size=e.size}$.prototype.clear=function(){this.__data__=new o,this.size=0},$.prototype.delete=function(t){var e=this.__data__,r=e.delete(t);return this.size=e.size,r},$.prototype.get=function(t){return this.__data__.get(t)},$.prototype.has=function(t){return this.__data__.has(t)},$.prototype.set=function(t,e){var r=this.__data__;if(r instanceof o){var n=r.__data__;if(!z||n.length<199)return n.push([t,e]),this.size=++r.size,this;r=this.__data__=new F(n)}return r.set(t,e),this.size=r.size,this};function W(t){var e=-1,r=null==t?0:t.length;for(this.__data__=new F;++e<r;)this.add(t[e])}function Q(t,e){for(var r=-1,n=null==t?0:t.length;++r<n;)if(e(t[r],r,t))return!0;return!1}W.prototype.add=W.prototype.push=function(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this},W.prototype.has=function(t){return this.__data__.has(t)};var X=1,Y=2;function Z(t,e,r,n,o,i){var a=r&X,c=t.length,s=e.length;if(c!=s&&!(a&&s>c))return!1;var l=i.get(t),u=i.get(e);if(l&&u)return l==e&&u==t;var f=-1,p=!0,h=r&Y?new W:void 0;for(i.set(t,e),i.set(e,t);++f<c;){var v=t[f],b=e[f];if(n)var d=a?n(b,v,f,e,t,i):n(v,b,f,t,e,i);if(void 0!==d){if(d)continue;p=!1;break}if(h){if(!Q(e,(function(t,e){if(a=e,!h.has(a)&&(v===t||o(v,t,r,n,i)))return h.push(e);var a}))){p=!1;break}}else if(v!==b&&!o(v,b,r,n,i)){p=!1;break}}return i.delete(t),i.delete(e),p}var q=c.Uint8Array;function G(t){var e=-1,r=Array(t.size);return t.forEach((function(t,n){r[++e]=[n,t]})),r}function J(t){var e=-1,r=Array(t.size);return t.forEach((function(t){r[++e]=t})),r}var K=1,tt=2,et="[object Boolean]",rt="[object Date]",nt="[object Error]",ot="[object Map]",it="[object Number]",at="[object RegExp]",ct="[object Set]",st="[object String]",lt="[object Symbol]",ut="[object ArrayBuffer]",ft="[object DataView]",pt=s?s.prototype:void 0,ht=pt?pt.valueOf:void 0;function vt(t,e){for(var r=-1,n=e.length,o=t.length;++r<n;)t[o+r]=e[r];return t}var bt=Array.isArray;function dt(t,e,r){var n=e(t);return bt(t)?n:vt(n,r(t))}function yt(){return[]}var _t=Object.prototype.propertyIsEnumerable,gt=Object.getOwnPropertySymbols,jt=gt?function(t){return null==t?[]:(t=Object(t),function(t,e){for(var r=-1,n=null==t?0:t.length,o=0,i=[];++r<n;){var a=t[r];e(a,r,t)&&(i[o++]=a)}return i}(gt(t),(function(e){return _t.call(t,e)})))}:yt;function mt(t){return null!=t&&"object"==typeof t}function Ot(t){return mt(t)&&"[object Arguments]"==y(t)}var At=Object.prototype,Pt=At.hasOwnProperty,wt=At.propertyIsEnumerable,xt=Ot(function(){return arguments}())?Ot:function(t){return mt(t)&&Pt.call(t,"callee")&&!wt.call(t,"callee")};var Et="object"==typeof exports&&exports&&!exports.nodeType&&exports,St=Et&&"object"==typeof module&&module&&!module.nodeType&&module,It=St&&St.exports===Et?c.Buffer:void 0,Ct=(It?It.isBuffer:void 0)||function(){return!1},Rt=9007199254740991,Tt=/^(?:0|[1-9]\d*)$/;function Mt(t,e){var r=typeof t;return!!(e=null==e?Rt:e)&&("number"==r||"symbol"!=r&&Tt.test(t))&&t>-1&&t%1==0&&t<e}var kt=9007199254740991;function Ut(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=kt}var Lt={};function zt(t){return function(e){return t(e)}}Lt["[object Float32Array]"]=Lt["[object Float64Array]"]=Lt["[object Int8Array]"]=Lt["[object Int16Array]"]=Lt["[object Int32Array]"]=Lt["[object Uint8Array]"]=Lt["[object Uint8ClampedArray]"]=Lt["[object Uint16Array]"]=Lt["[object Uint32Array]"]=!0,Lt["[object Arguments]"]=Lt["[object Array]"]=Lt["[object ArrayBuffer]"]=Lt["[object Boolean]"]=Lt["[object DataView]"]=Lt["[object Date]"]=Lt["[object Error]"]=Lt["[object Function]"]=Lt["[object Map]"]=Lt["[object Number]"]=Lt["[object Object]"]=Lt["[object RegExp]"]=Lt["[object Set]"]=Lt["[object String]"]=Lt["[object WeakMap]"]=!1;var Bt="object"==typeof exports&&exports&&!exports.nodeType&&exports,Nt=Bt&&"object"==typeof module&&module&&!module.nodeType&&module,Vt=Nt&&Nt.exports===Bt&&i.process,Dt=function(){try{var t=Nt&&Nt.require&&Nt.require("util").types;return t||Vt&&Vt.binding&&Vt.binding("util")}catch(t){}}(),Ht=Dt&&Dt.isTypedArray,Ft=Ht?zt(Ht):function(t){return mt(t)&&Ut(t.length)&&!!Lt[y(t)]},$t=Object.prototype.hasOwnProperty;function Wt(t,e){var r=bt(t),n=!r&&xt(t),o=!r&&!n&&Ct(t),i=!r&&!n&&!o&&Ft(t),a=r||n||o||i,c=a?function(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n}(t.length,String):[],s=c.length;for(var l in t)!e&&!$t.call(t,l)||a&&("length"==l||o&&("offset"==l||"parent"==l)||i&&("buffer"==l||"byteLength"==l||"byteOffset"==l)||Mt(l,s))||c.push(l);return c}var Qt=Object.prototype;function Xt(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||Qt)}function Yt(t,e){return function(r){return t(e(r))}}var Zt=Yt(Object.keys,Object),qt=Object.prototype.hasOwnProperty;function Gt(t){return null!=t&&Ut(t.length)&&!A(t)}function Jt(t){return Gt(t)?Wt(t):function(t){if(!Xt(t))return Zt(t);var e=[];for(var r in Object(t))qt.call(t,r)&&"constructor"!=r&&e.push(r);return e}(t)}function Kt(t){return dt(t,Jt,jt)}var te=1,ee=Object.prototype.hasOwnProperty;var re=L(c,"DataView"),ne=L(c,"Promise"),oe=L(c,"Set"),ie=L(c,"WeakMap"),ae="[object Map]",ce="[object Promise]",se="[object Set]",le="[object WeakMap]",ue="[object DataView]",fe=S(re),pe=S(z),he=S(ne),ve=S(oe),be=S(ie),de=y;(re&&de(new re(new ArrayBuffer(1)))!=ue||z&&de(new z)!=ae||ne&&de(ne.resolve())!=ce||oe&&de(new oe)!=se||ie&&de(new ie)!=le)&&(de=function(t){var e=y(t),r="[object Object]"==e?t.constructor:void 0,n=r?S(r):"";if(n)switch(n){case fe:return ue;case pe:return ae;case he:return ce;case ve:return se;case be:return le}return e});var ye=de,_e=1,ge="[object Arguments]",je="[object Array]",me="[object Object]",Oe=Object.prototype.hasOwnProperty;function Ae(t,r,n,o,i,a){var c=bt(t),s=bt(r),l=c?je:ye(t),u=s?je:ye(r),f=(l=l==ge?me:l)==me,p=(u=u==ge?me:u)==me,h=l==u;if(h&&Ct(t)){if(!Ct(r))return!1;c=!0,f=!1}if(h&&!f)return a||(a=new $),c||Ft(t)?Z(t,r,n,o,i,a):function(t,r,n,o,i,a,c){switch(n){case ft:if(t.byteLength!=r.byteLength||t.byteOffset!=r.byteOffset)return!1;t=t.buffer,r=r.buffer;case ut:return!(t.byteLength!=r.byteLength||!a(new q(t),new q(r)));case et:case rt:case it:return e(+t,+r);case nt:return t.name==r.name&&t.message==r.message;case at:case st:return t==r+"";case ot:var s=G;case ct:var l=o&K;if(s||(s=J),t.size!=r.size&&!l)return!1;var u=c.get(t);if(u)return u==r;o|=tt,c.set(t,r);var f=Z(s(t),s(r),o,i,a,c);return c.delete(t),f;case lt:if(ht)return ht.call(t)==ht.call(r)}return!1}(t,r,l,n,o,i,a);if(!(n&_e)){var v=f&&Oe.call(t,"__wrapped__"),b=p&&Oe.call(r,"__wrapped__");if(v||b){var d=v?t.value():t,y=b?r.value():r;return a||(a=new $),i(d,y,n,o,a)}}return!!h&&(a||(a=new $),function(t,e,r,n,o,i){var a=r&te,c=Kt(t),s=c.length;if(s!=Kt(e).length&&!a)return!1;for(var l=s;l--;){var u=c[l];if(!(a?u in e:ee.call(e,u)))return!1}var f=i.get(t),p=i.get(e);if(f&&p)return f==e&&p==t;var h=!0;i.set(t,e),i.set(e,t);for(var v=a;++l<s;){var b=t[u=c[l]],d=e[u];if(n)var y=a?n(d,b,u,e,t,i):n(b,d,u,t,e,i);if(!(void 0===y?b===d||o(b,d,r,n,i):y)){h=!1;break}v||(v="constructor"==u)}if(h&&!v){var _=t.constructor,g=e.constructor;_==g||!("constructor"in t)||!("constructor"in e)||"function"==typeof _&&_ instanceof _&&"function"==typeof g&&g instanceof g||(h=!1)}return i.delete(t),i.delete(e),h}(t,r,n,o,i,a))}function Pe(t,e,r,n,o){return t===e||(null==t||null==e||!mt(t)&&!mt(e)?t!=t&&e!=e:Ae(t,e,r,n,Pe,o))}function we(t,e){return Pe(t,e)}var xe=function(){try{var t=L(Object,"defineProperty");return t({},"",{}),t}catch(t){}}();function Ee(t,e,r){"__proto__"==e&&xe?xe(t,e,{configurable:!0,enumerable:!0,value:r,writable:!0}):t[e]=r}var Se=Object.prototype.hasOwnProperty;function Ie(t,r,n){var o=t[r];Se.call(t,r)&&e(o,n)&&(void 0!==n||r in t)||Ee(t,r,n)}function Ce(t,e,r,n){var o=!r;r||(r={});for(var i=-1,a=e.length;++i<a;){var c=e[i],s=n?n(r[c],t[c],c,r,t):void 0;void 0===s&&(s=t[c]),o?Ee(r,c,s):Ie(r,c,s)}return r}var Re=Object.prototype.hasOwnProperty;function Te(t){if(!_(t))return function(t){var e=[];if(null!=t)for(var r in Object(t))e.push(r);return e}(t);var e=Xt(t),r=[];for(var n in t)("constructor"!=n||!e&&Re.call(t,n))&&r.push(n);return r}function Me(t){return Gt(t)?Wt(t,!0):Te(t)}var ke="object"==typeof exports&&exports&&!exports.nodeType&&exports,Ue=ke&&"object"==typeof module&&module&&!module.nodeType&&module,Le=Ue&&Ue.exports===ke?c.Buffer:void 0,ze=Le?Le.allocUnsafe:void 0;var Be=Yt(Object.getPrototypeOf,Object),Ne=Object.getOwnPropertySymbols?function(t){for(var e=[];t;)vt(e,jt(t)),t=Be(t);return e}:yt;function Ve(t){return dt(t,Me,Ne)}var De=Object.prototype.hasOwnProperty;function He(t){var e=new t.constructor(t.byteLength);return new q(e).set(new q(t)),e}var Fe=/\w*$/;var $e=s?s.prototype:void 0,We=$e?$e.valueOf:void 0;var Qe="[object Boolean]",Xe="[object Date]",Ye="[object Map]",Ze="[object Number]",qe="[object RegExp]",Ge="[object Set]",Je="[object String]",Ke="[object Symbol]",tr="[object ArrayBuffer]",er="[object DataView]",rr="[object Float32Array]",nr="[object Float64Array]",or="[object Int8Array]",ir="[object Int16Array]",ar="[object Int32Array]",cr="[object Uint8Array]",sr="[object Uint8ClampedArray]",lr="[object Uint16Array]",ur="[object Uint32Array]";function fr(t,e,r){var n,o,i,a=t.constructor;switch(e){case tr:return He(t);case Qe:case Xe:return new a(+t);case er:return function(t,e){var r=e?He(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.byteLength)}(t,r);case rr:case nr:case or:case ir:case ar:case cr:case sr:case lr:case ur:return function(t,e){var r=e?He(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.length)}(t,r);case Ye:return new a;case Ze:case Je:return new a(t);case qe:return(i=new(o=t).constructor(o.source,Fe.exec(o))).lastIndex=o.lastIndex,i;case Ge:return new a;case Ke:return n=t,We?Object(We.call(n)):{}}}var pr=Object.create,hr=function(){function t(){}return function(e){if(!_(e))return{};if(pr)return pr(e);t.prototype=e;var r=new t;return t.prototype=void 0,r}}();var vr=Dt&&Dt.isMap,br=vr?zt(vr):function(t){return mt(t)&&"[object Map]"==ye(t)};var dr=Dt&&Dt.isSet,yr=dr?zt(dr):function(t){return mt(t)&&"[object Set]"==ye(t)},_r=1,gr=2,jr=4,mr="[object Arguments]",Or="[object Function]",Ar="[object GeneratorFunction]",Pr="[object Object]",wr={};function xr(t,e,r,n,o,i){var a,c=e&_r,s=e&gr,l=e&jr;if(r&&(a=o?r(t,n,o,i):r(t)),void 0!==a)return a;if(!_(t))return t;var u=bt(t);if(u){if(a=function(t){var e=t.length,r=new t.constructor(e);return e&&"string"==typeof t[0]&&De.call(t,"index")&&(r.index=t.index,r.input=t.input),r}(t),!c)return function(t,e){var r=-1,n=t.length;for(e||(e=Array(n));++r<n;)e[r]=t[r];return e}(t,a)}else{var f=ye(t),p=f==Or||f==Ar;if(Ct(t))return function(t,e){if(e)return t.slice();var r=t.length,n=ze?ze(r):new t.constructor(r);return t.copy(n),n}(t,c);if(f==Pr||f==mr||p&&!o){if(a=s||p?{}:function(t){return"function"!=typeof t.constructor||Xt(t)?{}:hr(Be(t))}(t),!c)return s?function(t,e){return Ce(t,Ne(t),e)}(t,function(t,e){return t&&Ce(e,Me(e),t)}(a,t)):function(t,e){return Ce(t,jt(t),e)}(t,function(t,e){return t&&Ce(e,Jt(e),t)}(a,t))}else{if(!wr[f])return o?t:{};a=fr(t,f,c)}}i||(i=new $);var h=i.get(t);if(h)return h;i.set(t,a),yr(t)?t.forEach((function(n){a.add(xr(n,e,r,n,t,i))})):br(t)&&t.forEach((function(n,o){a.set(o,xr(n,e,r,o,t,i))}));var v=u?void 0:(l?s?Ve:Kt:s?Me:Jt)(t);return function(t,e){for(var r=-1,n=null==t?0:t.length;++r<n&&!1!==e(t[r],r,t););}(v||t,(function(n,o){v&&(n=t[o=n]),Ie(a,o,xr(n,e,r,o,t,i))})),a}wr[mr]=wr["[object Array]"]=wr["[object ArrayBuffer]"]=wr["[object DataView]"]=wr["[object Boolean]"]=wr["[object Date]"]=wr["[object Float32Array]"]=wr["[object Float64Array]"]=wr["[object Int8Array]"]=wr["[object Int16Array]"]=wr["[object Int32Array]"]=wr["[object Map]"]=wr["[object Number]"]=wr[Pr]=wr["[object RegExp]"]=wr["[object Set]"]=wr["[object String]"]=wr["[object Symbol]"]=wr["[object Uint8Array]"]=wr["[object Uint8ClampedArray]"]=wr["[object Uint16Array]"]=wr["[object Uint32Array]"]=!0,wr["[object Error]"]=wr[Or]=wr["[object WeakMap]"]=!1;function Er(t){return xr(t,5)}function Sr(t){return t}var Ir=Math.max;var Cr=xe?function(t,e){return xe(t,"toString",{configurable:!0,enumerable:!1,value:(r=e,function(){return r}),writable:!0});var r}:Sr,Rr=Cr,Tr=Date.now;var Mr,kr,Ur,Lr=(Mr=Rr,kr=0,Ur=0,function(){var t=Tr(),e=16-(t-Ur);if(Ur=t,e>0){if(++kr>=800)return arguments[0]}else kr=0;return Mr.apply(void 0,arguments)});var zr=Object.prototype,Br=zr.hasOwnProperty,Nr=function(t,e){return Lr(function(t,e,r){return e=Ir(void 0===e?t.length-1:e,0),function(){for(var n=arguments,o=-1,i=Ir(n.length-e,0),a=Array(i);++o<i;)a[o]=n[e+o];o=-1;for(var c=Array(e+1);++o<e;)c[o]=n[o];return c[e]=r(a),function(t,e,r){switch(r.length){case 0:return t.call(e);case 1:return t.call(e,r[0]);case 2:return t.call(e,r[0],r[1]);case 3:return t.call(e,r[0],r[1],r[2])}return t.apply(e,r)}(t,this,c)}}(t,e,Sr),t+"")}((function(t,r){t=Object(t);var n=-1,o=r.length,i=o>2?r[2]:void 0;for(i&&function(t,r,n){if(!_(n))return!1;var o=typeof r;return!!("number"==o?Gt(n)&&Mt(r,n.length):"string"==o&&r in n)&&e(n[r],t)}(r[0],r[1],i)&&(o=1);++n<o;)for(var a=r[n],c=Me(a),s=-1,l=c.length;++s<l;){var u=c[s],f=t[u];(void 0===f||e(f,zr[u])&&!Br.call(t,u))&&(t[u]=a[u])}return t})),Vr=/\s/;var Dr=/^\s+/;function Hr(t){return t?t.slice(0,function(t){for(var e=t.length;e--&&Vr.test(t.charAt(e)););return e}(t)+1).replace(Dr,""):t}var Fr="[object Symbol]";function $r(t){return"symbol"==typeof t||mt(t)&&y(t)==Fr}var Wr=NaN,Qr=/^[-+]0x[0-9a-f]+$/i,Xr=/^0b[01]+$/i,Yr=/^0o[0-7]+$/i,Zr=parseInt;function qr(t){if("number"==typeof t)return t;if($r(t))return Wr;if(_(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=_(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=Hr(t);var r=Xr.test(t);return r||Yr.test(t)?Zr(t.slice(2),r?2:8):Qr.test(t)?Wr:+t}var Gr=1/0,Jr=17976931348623157e292;function Kr(t){var e=function(t){return t?(t=qr(t))===Gr||t===-Gr?(t<0?-1:1)*Jr:t==t?t:0:0===t?t:0}(t),r=e%1;return e==e?r?e-r:e:0}var tn=1/0,en=s?s.prototype:void 0,rn=en?en.toString:void 0;function nn(t){if("string"==typeof t)return t;if(bt(t))return function(t,e){for(var r=-1,n=null==t?0:t.length,o=Array(n);++r<n;)o[r]=e(t[r],r,t);return o}(t,nn)+"";if($r(t))return rn?rn.call(t):"";var e=t+"";return"0"==e&&1/t==-tn?"-0":e}function on(t){return null==t?"":nn(t)}var an=c.isFinite,cn=Math.min;var sn=function(t){var e=Math[t];return function(t,r){if(t=qr(t),(r=null==r?0:cn(Kr(r),292))&&an(t)){var n=(on(t)+"e").split("e");return+((n=(on(e(n[0]+"e"+(+n[1]+r)))+"e").split("e"))[0]+"e"+(+n[1]-r))}return e(t)}}("round");const ln=Symbol("fabric-path-editor-symbol"),un=Symbol("fabric-path-editor-controller-info");var fn,pn;!function(t){t.MAJOR_POINT="major-point",t.SUB_POINT="sub-point"}(fn||(fn={})),function(t){t.START="M",t.LINE="L",t.QUADRATIC_CURCE="Q",t.BEZIER_CURVE="C",t.CLOSE="z"}(pn||(pn={}));class hn{constructor(t,e={}){this._options={},this.source=null,this.target=null,this.controllers={points:[]},this.listeners=[],this._inbuiltStatus={cancelHandlerMirrorMove:!1},this._storePlatformStatus=null,this._platform=t,this._options=Nr(e,this._options)}observe(t){this.source=t}static transformPath(t,e,r=!0){const{translate:n,scale:o,rotate:i}=e,a=r?t.path:Er(t.path);return null==a||a.forEach(((t,e)=>{const[,...r]=t;for(let t=0;t<r.length;t+=2){let r=a[e][t+1],c=a[e][t+2];void 0!==o&&(r*=o.x,c*=o.y),void 0!==i&&(r=Math.cos(i*Math.PI/180)*r-Math.sin(i*Math.PI/180)*c,c=Math.sin(i*Math.PI/180)*r+Math.cos(i*Math.PI/180)*c),void 0!==n&&(r+=n.x,c+=n.y),a[e][t+1]=r,a[e][t+2]=c}})),a}static initializePath(e,r,n=[1,0,0,1,0,0]){var o;const i=e.left,a=e.top;null===(o=e.path)||void 0===o||o.forEach((t=>{const[,...e]=t;for(let r=0;r<e.length;r+=2)t[r+1]=sn(t[r+1],3),t[r+2]=sn(t[r+2],3)}));const c=new t.fabric.Path(t.fabric.util.joinPath(e.path)).getCenterPoint();e.initialize(r);const s=new t.fabric.Path(r).getCenterPoint(),l=t.fabric.util.transformPoint(new t.fabric.Point(s.x-c.x,s.y-c.y),n);e.set({left:i+l.x,top:a+l.y}),e.setCoords()}_patchPath(e){if(!e.path)return;hn.transformPath(e,{translate:{x:-e.pathOffset.x,y:-e.pathOffset.y}});const r=this._splitPath(e.path);for(const t of r){if(t[t.length-1][0]===pn.CLOSE){const e=t[0].slice(t[0].length-2),r=t[t.length-2].slice(t[t.length-2].length-2);t[0]!==t[t.length-2]&&r[0]===e[0]&&r[1]===e[1]||t.splice(t.length-1,0,[pn.LINE,e[0],e[1]])}}e.path=r.flat(1),e.pathOffset=new t.fabric.Point(0,0)}_initPlatformStatus(){var t;if(!this._platform)return;const e=this._platform;this._storePlatformStatus={canvasSelection:null!==(t=e.selection)&&void 0!==t&&t,objectSelections:new WeakMap(e._objects.map((t=>{var e;return[t,null===(e=t.selectable)||void 0===e||e]})))},e.selection=!1,e.preserveObjectStacking=!0,e.controlsAboveOverlay=!0,e.discardActiveObject(),e.forEachObject((t=>{t.set({selectable:!1})}))}_splitPath(t){return t.reduce(((t,e,r,n)=>e?(e[0]===pn.START&&t[t.length-1].length&&t.push([]),t[t.length-1].push(e),e[0]===pn.CLOSE&&r!==n.length-1&&t.push([]),t):t),[[]])}_getPointInstructions(t){var e,r;const n=t[un].instruction,o=null===(e=this.target)||void 0===e?void 0:e.path;if(!o)return{path:[],cur:null,next:null,pre:null};const i=this._splitPath(o).find((t=>t.includes(n))),a=i.indexOf(n);let c=i[a-1],s=i[a+1];return(null===(r=i[i.length-1])||void 0===r?void 0:r[0])===pn.CLOSE&&!c&&(c=i[i.length-2]),s&&s[0]===pn.CLOSE&&(s=i[0]),{path:i,cur:n,pre:null!=c?c:null,next:null!=s?s:null}}_getInstructionPoint(t){return this.controllers.points.find((e=>e[un].instruction===t))}_getPointAroundPoints(t){const{cur:e,pre:r,next:n}=this._getPointInstructions(t);if(!e)return{cur:null,pre:null,next:null};let o=null,i=null;switch(e[0]){case pn.START:(null==r?void 0:r[0])===pn.QUADRATIC_CURCE&&(o={instruction:r,instructionValueIdx:r.length-2,point:{x:r[r.length-2],y:r[r.length-1]}}),(null==r?void 0:r[0])===pn.BEZIER_CURVE&&(o={instruction:r,instructionValueIdx:r.length-4,point:{x:r[r.length-4],y:r[r.length-3]}});break;case pn.LINE:r&&(o={instruction:r,instructionValueIdx:r.length-2,point:{x:r[r.length-2],y:r[r.length-1]}});break;case pn.QUADRATIC_CURCE:o={instruction:e,instructionValueIdx:1,point:{x:e[1],y:e[2]}};break;case pn.BEZIER_CURVE:o={instruction:e,instructionValueIdx:3,point:{x:e[3],y:e[4]}};case pn.CLOSE:}return n&&n[0]!==pn.CLOSE&&(i={instruction:n,instructionValueIdx:1,point:{x:n[1],y:n[2]}}),{cur:{instruction:e,instructionValueIdx:e.length-2,point:{x:e[e.length-2],y:e[e.length-1]}},pre:o,next:i}}_calcAbsolutePosition(e){const r=t.fabric.util.transformPoint(new t.fabric.Point(e.x,e.y),this.source.calcOwnMatrix());return{left:r.x,top:r.y}}_calcRelativeCrood(e){return t.fabric.util.transformPoint(new t.fabric.Point(e.left,e.top),t.fabric.util.invertTransform(this.source.calcOwnMatrix()))}_initPathControlPoints(){var e;const r=this._platform,n=this.target;if(!r||!n)return;const o=this.controllers.points;o.length&&r.remove(...o);const i=[];null===(e=this._splitPath(n.path))||void 0===e||e.forEach((e=>{e[0],e.forEach(((r,n)=>{var a,c;const s=r;if(s[0]===pn.CLOSE)return;if((null===(a=e[n+1])||void 0===a?void 0:a[0])===pn.CLOSE)return;const[l,u]=s.slice(s.length-2),f=null!==(c=o.pop())&&void 0!==c?c:new t.fabric.Group([new t.fabric.Circle({strokeWidth:4,radius:6,fill:"#ffffff",stroke:"#4b4b4b",originX:"center",originY:"center"})],{originX:"center",originY:"center",hasBorders:!1,hasControls:!1});f[ln]=!0,f[un]={type:fn.MAJOR_POINT,instruction:s,instructionValueIdx:s.length-2},this._observe(f,(({left:t,top:e},r)=>{const n=this._calcRelativeCrood({left:t,top:e});this._calcRelativeCrood(r);const{path:o}=this._getPointInstructions(f),{preHandler:i,nextHandler:a}=this.controllers,c=n.x-s[s.length-2],l=n.y-s[s.length-1];i&&i.point.set({left:i.point.left+c,top:i.point.top+l}),a&&a.point.set({left:a.point.left+c,top:a.point.top+l}),s[s.length-2]=n.x,s[s.length-1]=n.y;const u=o[o.length-2];u&&s!==u&&u[0]!==pn.CLOSE&&o[0]===s&&o[o.length-1][0]===pn.CLOSE&&(u[u.length-2]=n.x,u[u.length-1]=n.y),f.setCoords()})),f.set(this._calcAbsolutePosition({x:l,y:u})),i.push(f)}))})),r.add(...i),this.controllers.points=i}_initPathControlHandlers(){return["pre","next"].forEach((e=>{const r=new t.fabric.Group([new t.fabric.Circle({radius:4,stroke:"#bebebe",strokeWidth:2,fill:"#bebebe",originX:"center",originY:"center"})],{originX:"center",originY:"center",hasBorders:!1,hasControls:!1});r[ln]=!0,r[un]={type:fn.SUB_POINT};const n=new t.fabric.Line([0,0,0,0],{stroke:"#bebebe",strokeWidth:1,strokeDashArray:[4,3],strokeUniform:!0,selectable:!1,evented:!1,originX:"center",originY:"center"});this.controllers[`${e}Handler`]={point:r,line:n}})),this.controllers}_observe(t,e){let{left:r=0,top:n=0}=t;Object.defineProperties(t,{left:{get:()=>r,set:t=>{if(r===t)return;const o={left:r,top:n};r=t,e({left:r,top:n},o)}},top:{get:()=>n,set:t=>{if(n===t)return;const o={left:r,top:n};n=t,e({left:r,top:n},o)}}})}_on(t,e,r){"global"===t&&window.addEventListener(e,r),"canvas"===t&&this._platform.on(e,r),this.listeners.push({type:t,eventName:e,handler:r})}_initEvents(){(()=>{this._on("canvas","selection:created",(t=>{this.focus(...t.selected)})),this._on("canvas","selection:updated",(t=>{this.focus(...t.selected)})),this._on("canvas","selection:cleared",(()=>{this.focus()}))})(),(()=>{let t;const e=[{combinationKeys:["alt"],onActivate:()=>{this._inbuiltStatus.cancelHandlerMirrorMove=!0},onDeactivate:()=>{this._inbuiltStatus.cancelHandlerMirrorMove=!1}},{key:"backspace",onActivate:()=>{this.remove()}}],r=()=>{var e;t&&(null===(e=t.onDeactivate)||void 0===e||e.call(t),t=void 0)},n=n=>{let o=n.key.toLowerCase();e.forEach((e=>{var i;const{key:a,combinationKeys:c=[]}=e;(a||0!==c.length)&&("keyup"===n.type&&(o=""),a&&a!==o||c.some((t=>!n[`${t}Key`]))?"keyup"===n.type&&r():t!==e&&(null===(i=null==t?void 0:t.onDeactivate)||void 0===i||i.call(t),t=e,null==t||t.onActivate()))}))};this._on("global","keydown",n.bind(this)),this._on("global","keyup",n.bind(this)),this._on("global","blur",r)})()}async enterEditing(t){if(!this.source||"path"!==this.source.type)throw Error("Please observe target path before editing.");this._initPlatformStatus(),this.target=await new Promise((t=>this.source.clone(t))),this._patchPath(this.target),t&&t(this.target),this.target[ln]=!0,this.target.set({selectable:!1,objectCaching:!1}),this._platform.add(this.target),this._platform.renderOnAddRemove=!1,this._initPathControlPoints(),this._initPathControlHandlers(),this._platform.renderOnAddRemove=!0,this._platform.renderAll(),this._initEvents()}leaveEditing(){}focus(...t){const e=this._platform,{preHandler:r,nextHandler:n,activePoint:o}=this.controllers,i=t[0],a=t=>{if(!t)return;t.item(0).set({fill:"#ffffff"});const{preHandler:r,nextHandler:n}=this.controllers;r&&(e.remove(r.point),e.remove(r.line)),n&&(e.remove(n.point),e.remove(n.line))},c=t=>{t.item(0).set({fill:"#29ca6e"});const{cur:r,pre:n,next:o}=this._getPointAroundPoints(t),{preHandler:i,nextHandler:a}=this.controllers;let c=!0;[{target:i,mirrorTarget:a,instruction:n,hidden:!(null==n?void 0:n.point)||!r||r.instruction[0]===pn.LINE},{target:a,mirrorTarget:i,instruction:o,hidden:!(null==o?void 0:o.point)||o.instruction[0]===pn.LINE}].forEach((({target:r,mirrorTarget:n,instruction:o,hidden:i})=>{r&&(i?this._observe(r.point,(()=>{})):(null==o?void 0:o.point)&&(r.point[un].instruction=o.instruction,r.point[un].instructionValueIdx=o.instructionValueIdx,this._observe(r.point,(({left:e,top:i})=>{const{x:a,y:s}=this._calcRelativeCrood({left:e,top:i});r.line.set({x1:t.left,y1:t.top,x2:r.point.left,y2:r.point.top}),o.instruction[o.instructionValueIdx]=a,o.instruction[o.instructionValueIdx+1]=s,this._inbuiltStatus.cancelHandlerMirrorMove?c=!1:c&&this.controllers.activeHandlerPoint&&n&&(n.point.set({left:2*t.left-r.point.left,top:2*t.top-r.point.top}),n.line.set({x1:t.left,y1:t.top,x2:n.point.left,y2:n.point.top})),r.point.setCoords()})),r.point.set(this._calcAbsolutePosition(o.point)),e.add(r.line,r.point)))})),c=void 0!==i&&void 0!==a&&i.point.left+a.point.left===2*t.left&&i.point.top+a.point.top===2*t.top,e.renderAll()},s=t=>{const e=[r,n].find((e=>(null==e?void 0:e.point)===t));e&&e.point.item(0).set({stroke:"#4b4b4b"}),this.controllers.activeHandlerPoint=t};(()=>{[r,n].forEach((t=>{t&&t.point.item(0).set({stroke:"#bebebe"})})),this.controllers.activeHandlerPoint=void 0})(),i?(i[un].type===fn.MAJOR_POINT&&(a(o),c(i),this.controllers.activePoint=i),i[un].type===fn.SUB_POINT&&s(i),e.setActiveObject(i)):(a(o),this.controllers.activePoint=void 0,e.discardActiveObject()),e.renderAll()}remove(t){var e,r;if(void 0===t&&(t=null!==(e=this.controllers.activeHandlerPoint)&&void 0!==e?e:this.controllers.activePoint),!t||!this.target)return;const n=this._platform,o=this.target.path;if(!o)return;const{type:i,instruction:a}=t[un];if(a){switch(i){case fn.MAJOR_POINT:{const t=this._splitPath(o),e=t.findIndex((t=>t.includes(a))),n=t[e].indexOf(a),i=Er(t[e]),c=i.slice(0,n),s=i.slice(n+1);if((null===(r=s[s.length-1])||void 0===r?void 0:r[0])===pn.CLOSE){s.pop();const r=s[s.length-1];if(0===n&&r&&we(r.slice(r.length-2),a.slice(a.length-2)))s.pop();else{const t=c[0];(null==t?void 0:t[0])===pn.START&&(t[0]=pn.LINE,we(t.slice(t.length-2),r.slice(r.length-2))&&c.shift())}s.push(...c),t.splice(e,1,s)}else t.splice(e,1,c,s);const l=s[0];l&&(l.splice(1,{[pn.START]:0,[pn.LINE]:0,[pn.BEZIER_CURVE]:4,[pn.QUADRATIC_CURCE]:2}[l[0]]),l[0]=pn.START),this.target.path=t.flat(1),this._initPathControlPoints();break}case fn.SUB_POINT:a.splice(1,{[pn.BEZIER_CURVE]:4,[pn.QUADRATIC_CURCE]:2}[a[0]]),a[0]=pn.LINE,this.focus(this.controllers.activePoint)}n.requestRenderAll()}}destroy(){}}return hn}));
