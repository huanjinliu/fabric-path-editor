!function(t,e){t&&!t.getElementById("livereloadscript")&&((e=t.createElement("script")).async=1,e.src="//"+(self.location.host||"localhost").split(":")[0]+":35729/livereload.js?snipver=1",e.id="livereloadscript",t.getElementsByTagName("head")[0].appendChild(e))}(self.document),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("fabric")):"function"==typeof define&&define.amd?define(["fabric"],e):(t="undefined"!=typeof globalThis?globalThis:t||self).FabricPathEditor=e(t.fabric)}(this,(function(t){"use strict";function e(t,e){return t===e||t!=t&&e!=e}function r(t,r){for(var n=t.length;n--;)if(e(t[n][0],r))return n;return-1}var n=Array.prototype.splice;function o(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}o.prototype.clear=function(){this.__data__=[],this.size=0},o.prototype.delete=function(t){var e=this.__data__,o=r(e,t);return!(o<0)&&(o==e.length-1?e.pop():n.call(e,o,1),--this.size,!0)},o.prototype.get=function(t){var e=this.__data__,n=r(e,t);return n<0?void 0:e[n][1]},o.prototype.has=function(t){return r(this.__data__,t)>-1},o.prototype.set=function(t,e){var n=this.__data__,o=r(n,t);return o<0?(++this.size,n.push([t,e])):n[o][1]=e,this};var i="object"==typeof global&&global&&global.Object===Object&&global,a="object"==typeof self&&self&&self.Object===Object&&self,c=i||a||Function("return this")(),s=c.Symbol,l=Object.prototype,u=l.hasOwnProperty,f=l.toString,p=s?s.toStringTag:void 0;var h=Object.prototype.toString;var v="[object Null]",b="[object Undefined]",d=s?s.toStringTag:void 0;function y(t){return null==t?void 0===t?b:v:d&&d in Object(t)?function(t){var e=u.call(t,p),r=t[p];try{t[p]=void 0;var n=!0}catch(t){}var o=f.call(t);return n&&(e?t[p]=r:delete t[p]),o}(t):function(t){return h.call(t)}(t)}function _(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}var g="[object AsyncFunction]",j="[object Function]",O="[object GeneratorFunction]",P="[object Proxy]";function A(t){if(!_(t))return!1;var e=y(t);return e==j||e==O||e==g||e==P}var m,x=c["__core-js_shared__"],w=(m=/[^.]+$/.exec(x&&x.keys&&x.keys.IE_PROTO||""))?"Symbol(src)_1."+m:"";var E=Function.prototype.toString;function I(t){if(null!=t){try{return E.call(t)}catch(t){}try{return t+""}catch(t){}}return""}var T=/^\[object .+?Constructor\]$/,S=Function.prototype,C=Object.prototype,R=S.toString,U=C.hasOwnProperty,M=RegExp("^"+R.call(U).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function N(t){return!(!_(t)||(e=t,w&&w in e))&&(A(t)?M:T).test(I(t));var e}function k(t,e){var r=function(t,e){return null==t?void 0:t[e]}(t,e);return N(r)?r:void 0}var B=k(c,"Map"),L=k(Object,"create");var z=Object.prototype.hasOwnProperty;var V=Object.prototype.hasOwnProperty;function D(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function H(t,e){var r,n,o=t.__data__;return("string"==(n=typeof(r=e))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==r:null===r)?o["string"==typeof e?"string":"hash"]:o.map}function F(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}D.prototype.clear=function(){this.__data__=L?L(null):{},this.size=0},D.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},D.prototype.get=function(t){var e=this.__data__;if(L){var r=e[t];return"__lodash_hash_undefined__"===r?void 0:r}return z.call(e,t)?e[t]:void 0},D.prototype.has=function(t){var e=this.__data__;return L?void 0!==e[t]:V.call(e,t)},D.prototype.set=function(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=L&&void 0===e?"__lodash_hash_undefined__":e,this},F.prototype.clear=function(){this.size=0,this.__data__={hash:new D,map:new(B||o),string:new D}},F.prototype.delete=function(t){var e=H(this,t).delete(t);return this.size-=e?1:0,e},F.prototype.get=function(t){return H(this,t).get(t)},F.prototype.has=function(t){return H(this,t).has(t)},F.prototype.set=function(t,e){var r=H(this,t),n=r.size;return r.set(t,e),this.size+=r.size==n?0:1,this};function $(t){var e=this.__data__=new o(t);this.size=e.size}$.prototype.clear=function(){this.__data__=new o,this.size=0},$.prototype.delete=function(t){var e=this.__data__,r=e.delete(t);return this.size=e.size,r},$.prototype.get=function(t){return this.__data__.get(t)},$.prototype.has=function(t){return this.__data__.has(t)},$.prototype.set=function(t,e){var r=this.__data__;if(r instanceof o){var n=r.__data__;if(!B||n.length<199)return n.push([t,e]),this.size=++r.size,this;r=this.__data__=new F(n)}return r.set(t,e),this.size=r.size,this};function J(t){var e=-1,r=null==t?0:t.length;for(this.__data__=new F;++e<r;)this.add(t[e])}function Q(t,e){for(var r=-1,n=null==t?0:t.length;++r<n;)if(e(t[r],r,t))return!0;return!1}J.prototype.add=J.prototype.push=function(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this},J.prototype.has=function(t){return this.__data__.has(t)};var W=1,Z=2;function q(t,e,r,n,o,i){var a=r&W,c=t.length,s=e.length;if(c!=s&&!(a&&s>c))return!1;var l=i.get(t),u=i.get(e);if(l&&u)return l==e&&u==t;var f=-1,p=!0,h=r&Z?new J:void 0;for(i.set(t,e),i.set(e,t);++f<c;){var v=t[f],b=e[f];if(n)var d=a?n(b,v,f,e,t,i):n(v,b,f,t,e,i);if(void 0!==d){if(d)continue;p=!1;break}if(h){if(!Q(e,(function(t,e){if(a=e,!h.has(a)&&(v===t||o(v,t,r,n,i)))return h.push(e);var a}))){p=!1;break}}else if(v!==b&&!o(v,b,r,n,i)){p=!1;break}}return i.delete(t),i.delete(e),p}var X=c.Uint8Array;function Y(t){var e=-1,r=Array(t.size);return t.forEach((function(t,n){r[++e]=[n,t]})),r}function G(t){var e=-1,r=Array(t.size);return t.forEach((function(t){r[++e]=t})),r}var K=1,tt=2,et="[object Boolean]",rt="[object Date]",nt="[object Error]",ot="[object Map]",it="[object Number]",at="[object RegExp]",ct="[object Set]",st="[object String]",lt="[object Symbol]",ut="[object ArrayBuffer]",ft="[object DataView]",pt=s?s.prototype:void 0,ht=pt?pt.valueOf:void 0;function vt(t,e){for(var r=-1,n=e.length,o=t.length;++r<n;)t[o+r]=e[r];return t}var bt=Array.isArray;function dt(t,e,r){var n=e(t);return bt(t)?n:vt(n,r(t))}function yt(){return[]}var _t=Object.prototype.propertyIsEnumerable,gt=Object.getOwnPropertySymbols,jt=gt?function(t){return null==t?[]:(t=Object(t),function(t,e){for(var r=-1,n=null==t?0:t.length,o=0,i=[];++r<n;){var a=t[r];e(a,r,t)&&(i[o++]=a)}return i}(gt(t),(function(e){return _t.call(t,e)})))}:yt;function Ot(t){return null!=t&&"object"==typeof t}function Pt(t){return Ot(t)&&"[object Arguments]"==y(t)}var At=Object.prototype,mt=At.hasOwnProperty,xt=At.propertyIsEnumerable,wt=Pt(function(){return arguments}())?Pt:function(t){return Ot(t)&&mt.call(t,"callee")&&!xt.call(t,"callee")};var Et="object"==typeof exports&&exports&&!exports.nodeType&&exports,It=Et&&"object"==typeof module&&module&&!module.nodeType&&module,Tt=It&&It.exports===Et?c.Buffer:void 0,St=(Tt?Tt.isBuffer:void 0)||function(){return!1},Ct=9007199254740991,Rt=/^(?:0|[1-9]\d*)$/;function Ut(t,e){var r=typeof t;return!!(e=null==e?Ct:e)&&("number"==r||"symbol"!=r&&Rt.test(t))&&t>-1&&t%1==0&&t<e}var Mt=9007199254740991;function Nt(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=Mt}var kt={};function Bt(t){return function(e){return t(e)}}kt["[object Float32Array]"]=kt["[object Float64Array]"]=kt["[object Int8Array]"]=kt["[object Int16Array]"]=kt["[object Int32Array]"]=kt["[object Uint8Array]"]=kt["[object Uint8ClampedArray]"]=kt["[object Uint16Array]"]=kt["[object Uint32Array]"]=!0,kt["[object Arguments]"]=kt["[object Array]"]=kt["[object ArrayBuffer]"]=kt["[object Boolean]"]=kt["[object DataView]"]=kt["[object Date]"]=kt["[object Error]"]=kt["[object Function]"]=kt["[object Map]"]=kt["[object Number]"]=kt["[object Object]"]=kt["[object RegExp]"]=kt["[object Set]"]=kt["[object String]"]=kt["[object WeakMap]"]=!1;var Lt="object"==typeof exports&&exports&&!exports.nodeType&&exports,zt=Lt&&"object"==typeof module&&module&&!module.nodeType&&module,Vt=zt&&zt.exports===Lt&&i.process,Dt=function(){try{var t=zt&&zt.require&&zt.require("util").types;return t||Vt&&Vt.binding&&Vt.binding("util")}catch(t){}}(),Ht=Dt&&Dt.isTypedArray,Ft=Ht?Bt(Ht):function(t){return Ot(t)&&Nt(t.length)&&!!kt[y(t)]},$t=Object.prototype.hasOwnProperty;function Jt(t,e){var r=bt(t),n=!r&&wt(t),o=!r&&!n&&St(t),i=!r&&!n&&!o&&Ft(t),a=r||n||o||i,c=a?function(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n}(t.length,String):[],s=c.length;for(var l in t)!e&&!$t.call(t,l)||a&&("length"==l||o&&("offset"==l||"parent"==l)||i&&("buffer"==l||"byteLength"==l||"byteOffset"==l)||Ut(l,s))||c.push(l);return c}var Qt=Object.prototype;function Wt(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||Qt)}function Zt(t,e){return function(r){return t(e(r))}}var qt=Zt(Object.keys,Object),Xt=Object.prototype.hasOwnProperty;function Yt(t){return null!=t&&Nt(t.length)&&!A(t)}function Gt(t){return Yt(t)?Jt(t):function(t){if(!Wt(t))return qt(t);var e=[];for(var r in Object(t))Xt.call(t,r)&&"constructor"!=r&&e.push(r);return e}(t)}function Kt(t){return dt(t,Gt,jt)}var te=1,ee=Object.prototype.hasOwnProperty;var re=k(c,"DataView"),ne=k(c,"Promise"),oe=k(c,"Set"),ie=k(c,"WeakMap"),ae="[object Map]",ce="[object Promise]",se="[object Set]",le="[object WeakMap]",ue="[object DataView]",fe=I(re),pe=I(B),he=I(ne),ve=I(oe),be=I(ie),de=y;(re&&de(new re(new ArrayBuffer(1)))!=ue||B&&de(new B)!=ae||ne&&de(ne.resolve())!=ce||oe&&de(new oe)!=se||ie&&de(new ie)!=le)&&(de=function(t){var e=y(t),r="[object Object]"==e?t.constructor:void 0,n=r?I(r):"";if(n)switch(n){case fe:return ue;case pe:return ae;case he:return ce;case ve:return se;case be:return le}return e});var ye=de,_e=1,ge="[object Arguments]",je="[object Array]",Oe="[object Object]",Pe=Object.prototype.hasOwnProperty;function Ae(t,r,n,o,i,a){var c=bt(t),s=bt(r),l=c?je:ye(t),u=s?je:ye(r),f=(l=l==ge?Oe:l)==Oe,p=(u=u==ge?Oe:u)==Oe,h=l==u;if(h&&St(t)){if(!St(r))return!1;c=!0,f=!1}if(h&&!f)return a||(a=new $),c||Ft(t)?q(t,r,n,o,i,a):function(t,r,n,o,i,a,c){switch(n){case ft:if(t.byteLength!=r.byteLength||t.byteOffset!=r.byteOffset)return!1;t=t.buffer,r=r.buffer;case ut:return!(t.byteLength!=r.byteLength||!a(new X(t),new X(r)));case et:case rt:case it:return e(+t,+r);case nt:return t.name==r.name&&t.message==r.message;case at:case st:return t==r+"";case ot:var s=Y;case ct:var l=o&K;if(s||(s=G),t.size!=r.size&&!l)return!1;var u=c.get(t);if(u)return u==r;o|=tt,c.set(t,r);var f=q(s(t),s(r),o,i,a,c);return c.delete(t),f;case lt:if(ht)return ht.call(t)==ht.call(r)}return!1}(t,r,l,n,o,i,a);if(!(n&_e)){var v=f&&Pe.call(t,"__wrapped__"),b=p&&Pe.call(r,"__wrapped__");if(v||b){var d=v?t.value():t,y=b?r.value():r;return a||(a=new $),i(d,y,n,o,a)}}return!!h&&(a||(a=new $),function(t,e,r,n,o,i){var a=r&te,c=Kt(t),s=c.length;if(s!=Kt(e).length&&!a)return!1;for(var l=s;l--;){var u=c[l];if(!(a?u in e:ee.call(e,u)))return!1}var f=i.get(t),p=i.get(e);if(f&&p)return f==e&&p==t;var h=!0;i.set(t,e),i.set(e,t);for(var v=a;++l<s;){var b=t[u=c[l]],d=e[u];if(n)var y=a?n(d,b,u,e,t,i):n(b,d,u,t,e,i);if(!(void 0===y?b===d||o(b,d,r,n,i):y)){h=!1;break}v||(v="constructor"==u)}if(h&&!v){var _=t.constructor,g=e.constructor;_==g||!("constructor"in t)||!("constructor"in e)||"function"==typeof _&&_ instanceof _&&"function"==typeof g&&g instanceof g||(h=!1)}return i.delete(t),i.delete(e),h}(t,r,n,o,i,a))}function me(t,e,r,n,o){return t===e||(null==t||null==e||!Ot(t)&&!Ot(e)?t!=t&&e!=e:Ae(t,e,r,n,me,o))}function xe(t,e){return me(t,e)}var we=function(){try{var t=k(Object,"defineProperty");return t({},"",{}),t}catch(t){}}();function Ee(t,e,r){"__proto__"==e&&we?we(t,e,{configurable:!0,enumerable:!0,value:r,writable:!0}):t[e]=r}var Ie=Object.prototype.hasOwnProperty;function Te(t,r,n){var o=t[r];Ie.call(t,r)&&e(o,n)&&(void 0!==n||r in t)||Ee(t,r,n)}function Se(t,e,r,n){var o=!r;r||(r={});for(var i=-1,a=e.length;++i<a;){var c=e[i],s=n?n(r[c],t[c],c,r,t):void 0;void 0===s&&(s=t[c]),o?Ee(r,c,s):Te(r,c,s)}return r}var Ce=Object.prototype.hasOwnProperty;function Re(t){if(!_(t))return function(t){var e=[];if(null!=t)for(var r in Object(t))e.push(r);return e}(t);var e=Wt(t),r=[];for(var n in t)("constructor"!=n||!e&&Ce.call(t,n))&&r.push(n);return r}function Ue(t){return Yt(t)?Jt(t,!0):Re(t)}var Me="object"==typeof exports&&exports&&!exports.nodeType&&exports,Ne=Me&&"object"==typeof module&&module&&!module.nodeType&&module,ke=Ne&&Ne.exports===Me?c.Buffer:void 0,Be=ke?ke.allocUnsafe:void 0;var Le=Zt(Object.getPrototypeOf,Object),ze=Object.getOwnPropertySymbols?function(t){for(var e=[];t;)vt(e,jt(t)),t=Le(t);return e}:yt;function Ve(t){return dt(t,Ue,ze)}var De=Object.prototype.hasOwnProperty;function He(t){var e=new t.constructor(t.byteLength);return new X(e).set(new X(t)),e}var Fe=/\w*$/;var $e=s?s.prototype:void 0,Je=$e?$e.valueOf:void 0;var Qe="[object Boolean]",We="[object Date]",Ze="[object Map]",qe="[object Number]",Xe="[object RegExp]",Ye="[object Set]",Ge="[object String]",Ke="[object Symbol]",tr="[object ArrayBuffer]",er="[object DataView]",rr="[object Float32Array]",nr="[object Float64Array]",or="[object Int8Array]",ir="[object Int16Array]",ar="[object Int32Array]",cr="[object Uint8Array]",sr="[object Uint8ClampedArray]",lr="[object Uint16Array]",ur="[object Uint32Array]";function fr(t,e,r){var n,o,i,a=t.constructor;switch(e){case tr:return He(t);case Qe:case We:return new a(+t);case er:return function(t,e){var r=e?He(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.byteLength)}(t,r);case rr:case nr:case or:case ir:case ar:case cr:case sr:case lr:case ur:return function(t,e){var r=e?He(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.length)}(t,r);case Ze:return new a;case qe:case Ge:return new a(t);case Xe:return(i=new(o=t).constructor(o.source,Fe.exec(o))).lastIndex=o.lastIndex,i;case Ye:return new a;case Ke:return n=t,Je?Object(Je.call(n)):{}}}var pr=Object.create,hr=function(){function t(){}return function(e){if(!_(e))return{};if(pr)return pr(e);t.prototype=e;var r=new t;return t.prototype=void 0,r}}();var vr=Dt&&Dt.isMap,br=vr?Bt(vr):function(t){return Ot(t)&&"[object Map]"==ye(t)};var dr=Dt&&Dt.isSet,yr=dr?Bt(dr):function(t){return Ot(t)&&"[object Set]"==ye(t)},_r=1,gr=2,jr=4,Or="[object Arguments]",Pr="[object Function]",Ar="[object GeneratorFunction]",mr="[object Object]",xr={};function wr(t,e,r,n,o,i){var a,c=e&_r,s=e&gr,l=e&jr;if(r&&(a=o?r(t,n,o,i):r(t)),void 0!==a)return a;if(!_(t))return t;var u=bt(t);if(u){if(a=function(t){var e=t.length,r=new t.constructor(e);return e&&"string"==typeof t[0]&&De.call(t,"index")&&(r.index=t.index,r.input=t.input),r}(t),!c)return function(t,e){var r=-1,n=t.length;for(e||(e=Array(n));++r<n;)e[r]=t[r];return e}(t,a)}else{var f=ye(t),p=f==Pr||f==Ar;if(St(t))return function(t,e){if(e)return t.slice();var r=t.length,n=Be?Be(r):new t.constructor(r);return t.copy(n),n}(t,c);if(f==mr||f==Or||p&&!o){if(a=s||p?{}:function(t){return"function"!=typeof t.constructor||Wt(t)?{}:hr(Le(t))}(t),!c)return s?function(t,e){return Se(t,ze(t),e)}(t,function(t,e){return t&&Se(e,Ue(e),t)}(a,t)):function(t,e){return Se(t,jt(t),e)}(t,function(t,e){return t&&Se(e,Gt(e),t)}(a,t))}else{if(!xr[f])return o?t:{};a=fr(t,f,c)}}i||(i=new $);var h=i.get(t);if(h)return h;i.set(t,a),yr(t)?t.forEach((function(n){a.add(wr(n,e,r,n,t,i))})):br(t)&&t.forEach((function(n,o){a.set(o,wr(n,e,r,o,t,i))}));var v=u?void 0:(l?s?Ve:Kt:s?Ue:Gt)(t);return function(t,e){for(var r=-1,n=null==t?0:t.length;++r<n&&!1!==e(t[r],r,t););}(v||t,(function(n,o){v&&(n=t[o=n]),Te(a,o,wr(n,e,r,o,t,i))})),a}xr[Or]=xr["[object Array]"]=xr["[object ArrayBuffer]"]=xr["[object DataView]"]=xr["[object Boolean]"]=xr["[object Date]"]=xr["[object Float32Array]"]=xr["[object Float64Array]"]=xr["[object Int8Array]"]=xr["[object Int16Array]"]=xr["[object Int32Array]"]=xr["[object Map]"]=xr["[object Number]"]=xr[mr]=xr["[object RegExp]"]=xr["[object Set]"]=xr["[object String]"]=xr["[object Symbol]"]=xr["[object Uint8Array]"]=xr["[object Uint8ClampedArray]"]=xr["[object Uint16Array]"]=xr["[object Uint32Array]"]=!0,xr["[object Error]"]=xr[Pr]=xr["[object WeakMap]"]=!1;function Er(t){return wr(t,5)}function Ir(t){return t}var Tr=Math.max;var Sr=we?function(t,e){return we(t,"toString",{configurable:!0,enumerable:!1,value:(r=e,function(){return r}),writable:!0});var r}:Ir,Cr=Sr,Rr=Date.now;var Ur,Mr,Nr,kr=(Ur=Cr,Mr=0,Nr=0,function(){var t=Rr(),e=16-(t-Nr);if(Nr=t,e>0){if(++Mr>=800)return arguments[0]}else Mr=0;return Ur.apply(void 0,arguments)});var Br=Object.prototype,Lr=Br.hasOwnProperty,zr=function(t,e){return kr(function(t,e,r){return e=Tr(void 0===e?t.length-1:e,0),function(){for(var n=arguments,o=-1,i=Tr(n.length-e,0),a=Array(i);++o<i;)a[o]=n[e+o];o=-1;for(var c=Array(e+1);++o<e;)c[o]=n[o];return c[e]=r(a),function(t,e,r){switch(r.length){case 0:return t.call(e);case 1:return t.call(e,r[0]);case 2:return t.call(e,r[0],r[1]);case 3:return t.call(e,r[0],r[1],r[2])}return t.apply(e,r)}(t,this,c)}}(t,e,Ir),t+"")}((function(t,r){t=Object(t);var n=-1,o=r.length,i=o>2?r[2]:void 0;for(i&&function(t,r,n){if(!_(n))return!1;var o=typeof r;return!!("number"==o?Yt(n)&&Ut(r,n.length):"string"==o&&r in n)&&e(n[r],t)}(r[0],r[1],i)&&(o=1);++n<o;)for(var a=r[n],c=Ue(a),s=-1,l=c.length;++s<l;){var u=c[s],f=t[u];(void 0===f||e(f,Br[u])&&!Lr.call(t,u))&&(t[u]=a[u])}return t})),Vr=/\s/;var Dr=/^\s+/;function Hr(t){return t?t.slice(0,function(t){for(var e=t.length;e--&&Vr.test(t.charAt(e)););return e}(t)+1).replace(Dr,""):t}var Fr="[object Symbol]";function $r(t){return"symbol"==typeof t||Ot(t)&&y(t)==Fr}var Jr=NaN,Qr=/^[-+]0x[0-9a-f]+$/i,Wr=/^0b[01]+$/i,Zr=/^0o[0-7]+$/i,qr=parseInt;function Xr(t){if("number"==typeof t)return t;if($r(t))return Jr;if(_(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=_(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=Hr(t);var r=Wr.test(t);return r||Zr.test(t)?qr(t.slice(2),r?2:8):Qr.test(t)?Jr:+t}var Yr=1/0,Gr=17976931348623157e292;function Kr(t){var e=function(t){return t?(t=Xr(t))===Yr||t===-Yr?(t<0?-1:1)*Gr:t==t?t:0:0===t?t:0}(t),r=e%1;return e==e?r?e-r:e:0}var tn=1/0,en=s?s.prototype:void 0,rn=en?en.toString:void 0;function nn(t){if("string"==typeof t)return t;if(bt(t))return function(t,e){for(var r=-1,n=null==t?0:t.length,o=Array(n);++r<n;)o[r]=e(t[r],r,t);return o}(t,nn)+"";if($r(t))return rn?rn.call(t):"";var e=t+"";return"0"==e&&1/t==-tn?"-0":e}function on(t){return null==t?"":nn(t)}var an=c.isFinite,cn=Math.min;var sn=function(t){var e=Math[t];return function(t,r){if(t=Xr(t),(r=null==r?0:cn(Kr(r),292))&&an(t)){var n=(on(t)+"e").split("e");return+((n=(on(e(n[0]+"e"+(+n[1]+r)))+"e").split("e"))[0]+"e"+(+n[1]-r))}return e(t)}}("round");const ln=Symbol("fabric-path-editor-symbol"),un=Symbol("fabric-path-editor-controller-info");var fn,pn;!function(t){t.MAJOR_POINT="major-point",t.SUB_POINT="sub-point"}(fn||(fn={})),function(t){t.START="M",t.LINE="L",t.QUADRATIC_CURCE="Q",t.BEZIER_CURVE="C",t.CLOSE="z"}(pn||(pn={}));const hn=[pn.QUADRATIC_CURCE,pn.BEZIER_CURVE];class vn{constructor(t,e={}){this._options={},this.source=null,this.target=null,this.controllers={points:[]},this.listeners=[],this._inbuiltStatus={cancelHandlerMirrorMove:!1},this._storePlatformStatus=null,this._platform=t,this._options=zr(e,this._options)}observe(t){this.source=t}static transformPath(t,e,r=!0){const{translate:n,scale:o,rotate:i}=e,a=r?t.path:Er(t.path);return null==a||a.forEach(((t,e)=>{const[,...r]=t;for(let t=0;t<r.length;t+=2){let r=a[e][t+1],c=a[e][t+2];void 0!==o&&(r*=o.x,c*=o.y),void 0!==i&&(r=Math.cos(i*Math.PI/180)*r-Math.sin(i*Math.PI/180)*c,c=Math.sin(i*Math.PI/180)*r+Math.cos(i*Math.PI/180)*c),void 0!==n&&(r+=n.x,c+=n.y),a[e][t+1]=r,a[e][t+2]=c}})),a}static initializePath(e,r,n=[1,0,0,1,0,0]){var o;const i=e.left,a=e.top;null===(o=e.path)||void 0===o||o.forEach((t=>{const[,...e]=t;for(let r=0;r<e.length;r+=2)t[r+1]=sn(t[r+1],3),t[r+2]=sn(t[r+2],3)}));const c=new t.fabric.Path(t.fabric.util.joinPath(e.path)).getCenterPoint();e.initialize(r);const s=new t.fabric.Path(r).getCenterPoint(),l=t.fabric.util.transformPoint(new t.fabric.Point(s.x-c.x,s.y-c.y),n);e.set({left:i+l.x,top:a+l.y}),e.setCoords()}_patchPath(e){if(!e.path)return;vn.transformPath(e,{translate:{x:-e.pathOffset.x,y:-e.pathOffset.y}});const r=this._splitPath(e.path);for(const t of r){if(t[t.length-1][0]===pn.CLOSE){const e=t[0].slice(t[0].length-2),r=t[t.length-2].slice(t[t.length-2].length-2);t[0]!==t[t.length-2]&&r[0]===e[0]&&r[1]===e[1]||t.splice(t.length-1,0,[pn.LINE,e[0],e[1]])}}e.path=r.flat(1),e.pathOffset=new t.fabric.Point(0,0)}_initPlatformStatus(){var t;if(!this._platform)return;const e=this._platform;this._storePlatformStatus={canvasSelection:null!==(t=e.selection)&&void 0!==t&&t,objectSelections:new WeakMap(e._objects.map((t=>{var e;return[t,null===(e=t.selectable)||void 0===e||e]})))},e.selection=!1,e.preserveObjectStacking=!0,e.controlsAboveOverlay=!0,e.discardActiveObject(),e.forEachObject((t=>{t.set({selectable:!1})}))}_splitPath(t){return t.reduce(((t,e,r,n)=>e?(e[0]===pn.START&&t[t.length-1].length&&t.push([]),t[t.length-1].push(e),e[0]===pn.CLOSE&&r!==n.length-1&&t.push([]),t):t),[[]])}_getPointInstructions(t){var e;const r=t[un].instruction,n=this.target.path,o=this._splitPath(n).find((t=>t.includes(r))),i=o.indexOf(r);let a=o[i-1],c=o[i+1];return(null===(e=o[o.length-1])||void 0===e?void 0:e[0])===pn.CLOSE&&!a&&(a=o[o.length-2]),c&&c[0]===pn.CLOSE&&(c=o[0]),{path:o,cur:r,pre:null!=a?a:null,next:null!=c?c:null}}_getPointAroundPoints(t){const{path:e,cur:r,pre:n,next:o}=this._getPointInstructions(t),i={instruction:r,instructionValueIdx:r.length-2,point:{x:r[r.length-2],y:r[r.length-1]},pointType:fn.MAJOR_POINT};let a,c;switch(r[0]){case pn.START:if(n)if(hn.includes(n[0]))a={instruction:n,instructionValueIdx:n.length-4,point:{x:n[n.length-4],y:n[n.length-3]},pointType:fn.SUB_POINT};else{const t=e[2%(e.length-1)];a={instruction:t,instructionValueIdx:t.length-2,point:{x:t[t.length-2],y:t[t.length-1]},pointType:fn.MAJOR_POINT}}break;case pn.LINE:n&&(a={instruction:n,instructionValueIdx:n.length-2,point:{x:n[n.length-2],y:n[n.length-1]},pointType:fn.MAJOR_POINT});break;case pn.QUADRATIC_CURCE:a={instruction:r,instructionValueIdx:1,point:{x:r[1],y:r[2]},pointType:fn.SUB_POINT};break;case pn.BEZIER_CURVE:a={instruction:r,instructionValueIdx:3,point:{x:r[3],y:r[4]},pointType:fn.SUB_POINT}}return o&&(c={instruction:o,instructionValueIdx:1,point:{x:o[1],y:o[2]},pointType:hn.includes(o[0])?fn.SUB_POINT:fn.MAJOR_POINT}),{cur:i,pre:a,next:c}}_calcAbsolutePosition(e){const r=t.fabric.util.transformPoint(new t.fabric.Point(e.x,e.y),this.source.calcOwnMatrix());return{left:r.x,top:r.y}}_calcRelativeCrood(e){return t.fabric.util.transformPoint(new t.fabric.Point(e.left,e.top),t.fabric.util.invertTransform(this.source.calcOwnMatrix()))}_initPathControlPoints(){var e;const r=this._platform,n=this.target;if(!r||!n)return;const o=this.controllers.points;o.length&&r.remove(...o);const i=[];null===(e=this._splitPath(n.path))||void 0===e||e.forEach((e=>{e[0],e.forEach(((r,n)=>{var a,c;const s=r;if(s[0]===pn.CLOSE)return;if((null===(a=e[n+1])||void 0===a?void 0:a[0])===pn.CLOSE)return;const[l,u]=s.slice(s.length-2),f=null!==(c=o.pop())&&void 0!==c?c:new t.fabric.Group([new t.fabric.Circle({strokeWidth:4,radius:6,fill:"#ffffff",stroke:"#4b4b4b",originX:"center",originY:"center"})],{originX:"center",originY:"center",hasBorders:!1,hasControls:!1});f[ln]=!0,f[un]={type:fn.MAJOR_POINT,instruction:s,instructionValueIdx:s.length-2},this._observe(f,(({left:t,top:e},r)=>{const n=this._calcRelativeCrood({left:t,top:e});this._calcRelativeCrood(r);const{path:o}=this._getPointInstructions(f),{preHandler:i,nextHandler:a}=this.controllers,c=n.x-s[s.length-2],l=n.y-s[s.length-1];i&&i.point.set({left:i.point.left+c,top:i.point.top+l}),a&&a.point.set({left:a.point.left+c,top:a.point.top+l}),s[s.length-2]=n.x,s[s.length-1]=n.y;const u=o[o.length-2];u&&s!==u&&u[0]!==pn.CLOSE&&o[0]===s&&o[o.length-1][0]===pn.CLOSE&&(u[u.length-2]=n.x,u[u.length-1]=n.y),f.setCoords()})),f.set(this._calcAbsolutePosition({x:l,y:u})),i.push(f)}))})),r.add(...i),this.controllers.points=i}_initPathControlHandlers(){return["pre","next"].forEach((e=>{const r=new t.fabric.Group([new t.fabric.Circle({radius:4,stroke:"#bebebe",strokeWidth:2,fill:"#bebebe",originX:"center",originY:"center"})],{originX:"center",originY:"center",hasBorders:!1,hasControls:!1});r[ln]=!0,r[un]={type:fn.SUB_POINT};const n=new t.fabric.Line([0,0,0,0],{stroke:"#bebebe",strokeWidth:1,strokeDashArray:[4,3],strokeUniform:!0,selectable:!1,evented:!1,originX:"center",originY:"center"});this.controllers[`${e}Handler`]={point:r,line:n}})),this.controllers}_observe(t,e){let{left:r=0,top:n=0}=t;Object.defineProperties(t,{left:{get:()=>r,set:t=>{if(r===t)return;const o={left:r,top:n};r=t,e({left:r,top:n},o)}},top:{get:()=>n,set:t=>{if(n===t)return;const o={left:r,top:n};n=t,e({left:r,top:n},o)}}})}_on(t,e,r){"global"===t&&window.addEventListener(e,r),"canvas"===t&&this._platform.on(e,r),this.listeners.push({type:t,eventName:e,handler:r})}_initEvents(){(()=>{this._on("canvas","selection:created",(t=>{this.focus(...t.selected)})),this._on("canvas","selection:updated",(t=>{this.focus(...t.selected)})),this._on("canvas","selection:cleared",(()=>{this.focus()}))})(),(()=>{let t;const e=[{combinationKeys:["alt"],onActivate:()=>{this._inbuiltStatus.cancelHandlerMirrorMove=!0},onDeactivate:()=>{this._inbuiltStatus.cancelHandlerMirrorMove=!1}},{key:"backspace",onActivate:()=>{this.remove()}}],r=()=>{var e;t&&(null===(e=t.onDeactivate)||void 0===e||e.call(t),t=void 0)},n=n=>{let o=n.key.toLowerCase();e.forEach((e=>{var i;const{key:a,combinationKeys:c=[]}=e;(a||0!==c.length)&&("keyup"===n.type&&(o=""),a&&a!==o||c.some((t=>!n[`${t}Key`]))?"keyup"===n.type&&r():t!==e&&(null===(i=null==t?void 0:t.onDeactivate)||void 0===i||i.call(t),t=e,null==t||t.onActivate()))}))};this._on("global","keydown",n.bind(this)),this._on("global","keyup",n.bind(this)),this._on("global","blur",r)})(),(()=>{this._on("canvas","mouse:dblclick",(t=>{var e,r;const n=t.target;if((null===(e=n[un])||void 0===e?void 0:e.type)===fn.MAJOR_POINT){const{pre:t,next:e}=this._getPointAroundPoints(n);[t,e].every((t=>!t||(null==t?void 0:t.pointType)===fn.SUB_POINT))?this.transferToLine(n,"both"):this.transferToCurce(n)}if((null===(r=n[un])||void 0===r?void 0:r.type)===fn.SUB_POINT){const{cur:t}=this._getPointInstructions(n);if(t[0]===pn.BEZIER_CURVE)return;t[0]=pn.BEZIER_CURVE,t.splice(1,0,t[t.length-4],t[t.length-3])}this._updatePointHandlers()}))})()}async enterEditing(t){if(!this.source||"path"!==this.source.type)throw Error("Please observe target path before editing.");this._initPlatformStatus(),this.target=await new Promise((t=>this.source.clone(t))),this._patchPath(this.target),t&&t(this.target),this.target[ln]=!0,this.target.set({selectable:!1,objectCaching:!1}),this._platform.add(this.target),this._platform.renderOnAddRemove=!1,this._initPathControlPoints(),this._initPathControlHandlers(),this._platform.renderOnAddRemove=!0,this._platform.renderAll(),this._initEvents(),this.focus(this.controllers.points[0])}leaveEditing(){}_updatePointHandlers(){const t=this._platform,{preHandler:e,nextHandler:r,activePoint:n}=this.controllers;if(e&&t.remove(e.point,e.line),r&&t.remove(r.point,r.line),!n)return;let o=!0;const{pre:i,next:a}=this._getPointAroundPoints(n);[i,a].forEach(((i,a)=>{if(!i)return;const{point:c,pointType:s,instruction:l,instructionValueIdx:u}=i,f=[e,r][a],p=[r,e][a];f&&(s===fn.SUB_POINT?c&&(f.point[un].instruction=l,f.point[un].instructionValueIdx=u,this._observe(f.point,(({left:t,top:e})=>{const{x:r,y:i}=this._calcRelativeCrood({left:t,top:e});f.line.set({x1:n.left,y1:n.top,x2:f.point.left,y2:f.point.top}),l[u]=r,l[u+1]=i,this._inbuiltStatus.cancelHandlerMirrorMove?o=!1:o&&this.controllers.activeHandlerPoint&&p&&(p.point.set({left:2*n.left-f.point.left,top:2*n.top-f.point.top}),p.line.set({x1:n.left,y1:n.top,x2:p.point.left,y2:p.point.top})),f.point.setCoords()})),f.point.set(this._calcAbsolutePosition(c)),t.add(f.line,f.point)):this._observe(f.point,(()=>{})))})),o=void 0!==e&&void 0!==r&&e.point.left+r.point.left===2*n.left&&e.point.top+r.point.top===2*n.top}focus(...t){const e=this._platform,{preHandler:r,nextHandler:n,activePoint:o}=this.controllers,i=t[0],a=t=>{const e=[r,n].find((e=>(null==e?void 0:e.point)===t));e&&e.point.item(0).set({stroke:"#4b4b4b"}),this.controllers.activeHandlerPoint=t};(()=>{[r,n].forEach((t=>{t&&t.point.item(0).set({stroke:"#bebebe"})})),this.controllers.activeHandlerPoint=void 0})(),i?(i[un].type===fn.MAJOR_POINT&&(null==o||o.item(0).set({fill:"#ffffff"}),this.controllers.activePoint=i,i.item(0).set({fill:"#29ca6e"}),this._updatePointHandlers()),i[un].type===fn.SUB_POINT&&a(i),e.setActiveObject(i)):(null==o||o.item(0).set({fill:"#ffffff"}),this.controllers.activePoint=void 0,e.discardActiveObject(),this._updatePointHandlers()),e.renderAll()}remove(t){var e,r;if(void 0===t&&(t=null!==(e=this.controllers.activeHandlerPoint)&&void 0!==e?e:this.controllers.activePoint),!t||!this.target)return;const n=this._platform,o=this.target.path;if(!o)return;const{type:i,instruction:a}=t[un];if(!a)return;const{preHandler:c}=this.controllers;switch(i){case fn.MAJOR_POINT:{const t=this._splitPath(o),e=t.findIndex((t=>t.includes(a))),n=t[e].indexOf(a),i=Er(t[e]),c=i.slice(0,n),s=i.slice(n+1);if((null===(r=s[s.length-1])||void 0===r?void 0:r[0])===pn.CLOSE){s.pop();const r=s[s.length-1];if(0===n&&r&&xe(r.slice(r.length-2),a.slice(a.length-2)))s.pop();else{const t=c[0];(null==t?void 0:t[0])===pn.START&&(t[0]=pn.LINE,xe(t.slice(t.length-2),r.slice(r.length-2))&&c.shift())}s.push(...c),t.splice(e,1,s)}else t.splice(e,1,c,s);const l=s[0];l&&(l.splice(1,{[pn.START]:0,[pn.LINE]:0,[pn.BEZIER_CURVE]:4,[pn.QUADRATIC_CURCE]:2}[l[0]]),l[0]=pn.START),this.target.path=t.flat(1),this._initPathControlPoints();break}case fn.SUB_POINT:const e=this.controllers.activePoint;this.transferToLine(e,t===(null==c?void 0:c.point)?"pre":"next"),this.focus(e)}n.requestRenderAll()}transferToLine(t,e){if(!this.controllers.points.includes(t))return;const{cur:r,next:n,pre:o}=this._getPointInstructions(t);if("pre"===e||"both"===e){const t=r[0]===pn.START?o:r;t&&(t.splice(1,{[pn.BEZIER_CURVE]:4,[pn.QUADRATIC_CURCE]:2}[t[0]]),t[0]=pn.LINE)}"next"!==e&&"both"!==e||n&&(n.splice(1,{[pn.BEZIER_CURVE]:4,[pn.QUADRATIC_CURCE]:2}[n[0]]),n[0]=pn.LINE),this._platform.requestRenderAll()}transferToCurce(t){var e;if(!this.controllers.points.includes(t))return;const{cur:r,pre:n,next:o}=this._getPointAroundPoints(t),i=((null!=o?o:r).point.x+(null!=n?n:r).point.x)/2,a=((null!=o?o:r).point.y+(null!=n?n:r).point.y)/2;if(n){const e={x:r.point.x+n.point.x-i,y:r.point.y+n.point.y-a};if(n.pointType===fn.MAJOR_POINT){const n=this._getPointInstructions(t),o=r.instruction[0]===pn.START?n.pre:n.cur;o&&(o[0]=pn.QUADRATIC_CURCE,o.splice(1,0,e.x,e.y))}}if(o){const t={x:r.point.x+o.point.x-i,y:r.point.y+o.point.y-a};o.pointType===fn.MAJOR_POINT&&(o.instruction[0]=pn.QUADRATIC_CURCE,null===(e=o.instruction)||void 0===e||e.splice(1,0,t.x,t.y))}}destroy(){}}return vn}));
