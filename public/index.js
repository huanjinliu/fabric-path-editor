!function(t,e){t&&!t.getElementById("livereloadscript")&&((e=t.createElement("script")).async=1,e.src="//"+(self.location.host||"localhost").split(":")[0]+":35729/livereload.js?snipver=1",e.id="livereloadscript",t.getElementsByTagName("head")[0].appendChild(e))}(self.document),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("fabric"),require("bezier-js")):"function"==typeof define&&define.amd?define(["fabric","bezier-js"],e):(t="undefined"!=typeof globalThis?globalThis:t||self).FabricPathEditor=e(t.fabric,t.bezierJs)}(this,(function(t,e){"use strict";function n(t,e){return t===e||t!=t&&e!=e}function r(t,e){for(var r=t.length;r--;)if(n(t[r][0],e))return r;return-1}var o=Array.prototype.splice;function i(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}i.prototype.clear=function(){this.__data__=[],this.size=0},i.prototype.delete=function(t){var e=this.__data__,n=r(e,t);return!(n<0)&&(n==e.length-1?e.pop():o.call(e,n,1),--this.size,!0)},i.prototype.get=function(t){var e=this.__data__,n=r(e,t);return n<0?void 0:e[n][1]},i.prototype.has=function(t){return r(this.__data__,t)>-1},i.prototype.set=function(t,e){var n=this.__data__,o=r(n,t);return o<0?(++this.size,n.push([t,e])):n[o][1]=e,this};var s="object"==typeof global&&global&&global.Object===Object&&global,a="object"==typeof self&&self&&self.Object===Object&&self,c=s||a||Function("return this")(),l=c.Symbol,u=Object.prototype,h=u.hasOwnProperty,f=u.toString,p=l?l.toStringTag:void 0;var d=Object.prototype.toString;var v="[object Null]",b="[object Undefined]",_=l?l.toStringTag:void 0;function y(t){return null==t?void 0===t?b:v:_&&_ in Object(t)?function(t){var e=h.call(t,p),n=t[p];try{t[p]=void 0;var r=!0}catch(t){}var o=f.call(t);return r&&(e?t[p]=n:delete t[p]),o}(t):function(t){return d.call(t)}(t)}function g(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}var j="[object AsyncFunction]",P="[object Function]",m="[object GeneratorFunction]",A="[object Proxy]";function x(t){if(!g(t))return!1;var e=y(t);return e==P||e==m||e==j||e==A}var O,S=c["__core-js_shared__"],E=(O=/[^.]+$/.exec(S&&S.keys&&S.keys.IE_PROTO||""))?"Symbol(src)_1."+O:"";var C=Function.prototype.toString;function w(t){if(null!=t){try{return C.call(t)}catch(t){}try{return t+""}catch(t){}}return""}var I=/^\[object .+?Constructor\]$/,T=Function.prototype,R=Object.prototype,U=T.toString,k=R.hasOwnProperty,M=RegExp("^"+U.call(k).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function N(t){return!(!g(t)||(e=t,E&&E in e))&&(x(t)?M:I).test(w(t));var e}function B(t,e){var n=function(t,e){return null==t?void 0:t[e]}(t,e);return N(n)?n:void 0}var L=B(c,"Map"),z=B(Object,"create");var D=Object.prototype.hasOwnProperty;var V=Object.prototype.hasOwnProperty;function F(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function Q(t,e){var n,r,o=t.__data__;return("string"==(r=typeof(n=e))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==n:null===n)?o["string"==typeof e?"string":"hash"]:o.map}function H(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}F.prototype.clear=function(){this.__data__=z?z(null):{},this.size=0},F.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},F.prototype.get=function(t){var e=this.__data__;if(z){var n=e[t];return"__lodash_hash_undefined__"===n?void 0:n}return D.call(e,t)?e[t]:void 0},F.prototype.has=function(t){var e=this.__data__;return z?void 0!==e[t]:V.call(e,t)},F.prototype.set=function(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=z&&void 0===e?"__lodash_hash_undefined__":e,this},H.prototype.clear=function(){this.size=0,this.__data__={hash:new F,map:new(L||i),string:new F}},H.prototype.delete=function(t){var e=Q(this,t).delete(t);return this.size-=e?1:0,e},H.prototype.get=function(t){return Q(this,t).get(t)},H.prototype.has=function(t){return Q(this,t).has(t)},H.prototype.set=function(t,e){var n=Q(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this};function X(t){var e=this.__data__=new i(t);this.size=e.size}X.prototype.clear=function(){this.__data__=new i,this.size=0},X.prototype.delete=function(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n},X.prototype.get=function(t){return this.__data__.get(t)},X.prototype.has=function(t){return this.__data__.has(t)},X.prototype.set=function(t,e){var n=this.__data__;if(n instanceof i){var r=n.__data__;if(!L||r.length<199)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new H(r)}return n.set(t,e),this.size=n.size,this};function Y(t){var e=-1,n=null==t?0:t.length;for(this.__data__=new H;++e<n;)this.add(t[e])}function $(t,e){for(var n=-1,r=null==t?0:t.length;++n<r;)if(e(t[n],n,t))return!0;return!1}Y.prototype.add=Y.prototype.push=function(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this},Y.prototype.has=function(t){return this.__data__.has(t)};var J=1,K=2;function W(t,e,n,r,o,i){var s=n&J,a=t.length,c=e.length;if(a!=c&&!(s&&c>a))return!1;var l=i.get(t),u=i.get(e);if(l&&u)return l==e&&u==t;var h=-1,f=!0,p=n&K?new Y:void 0;for(i.set(t,e),i.set(e,t);++h<a;){var d=t[h],v=e[h];if(r)var b=s?r(v,d,h,e,t,i):r(d,v,h,t,e,i);if(void 0!==b){if(b)continue;f=!1;break}if(p){if(!$(e,(function(t,e){if(s=e,!p.has(s)&&(d===t||o(d,t,n,r,i)))return p.push(e);var s}))){f=!1;break}}else if(d!==v&&!o(d,v,n,r,i)){f=!1;break}}return i.delete(t),i.delete(e),f}var Z=c.Uint8Array;function G(t){var e=-1,n=Array(t.size);return t.forEach((function(t,r){n[++e]=[r,t]})),n}function q(t){var e=-1,n=Array(t.size);return t.forEach((function(t){n[++e]=t})),n}var tt=1,et=2,nt="[object Boolean]",rt="[object Date]",ot="[object Error]",it="[object Map]",st="[object Number]",at="[object RegExp]",ct="[object Set]",lt="[object String]",ut="[object Symbol]",ht="[object ArrayBuffer]",ft="[object DataView]",pt=l?l.prototype:void 0,dt=pt?pt.valueOf:void 0;function vt(t,e){for(var n=-1,r=e.length,o=t.length;++n<r;)t[o+n]=e[n];return t}var bt=Array.isArray;function _t(t,e,n){var r=e(t);return bt(t)?r:vt(r,n(t))}function yt(){return[]}var gt=Object.prototype.propertyIsEnumerable,jt=Object.getOwnPropertySymbols,Pt=jt?function(t){return null==t?[]:(t=Object(t),function(t,e){for(var n=-1,r=null==t?0:t.length,o=0,i=[];++n<r;){var s=t[n];e(s,n,t)&&(i[o++]=s)}return i}(jt(t),(function(e){return gt.call(t,e)})))}:yt;function mt(t){return null!=t&&"object"==typeof t}function At(t){return mt(t)&&"[object Arguments]"==y(t)}var xt=Object.prototype,Ot=xt.hasOwnProperty,St=xt.propertyIsEnumerable,Et=At(function(){return arguments}())?At:function(t){return mt(t)&&Ot.call(t,"callee")&&!St.call(t,"callee")};var Ct="object"==typeof exports&&exports&&!exports.nodeType&&exports,wt=Ct&&"object"==typeof module&&module&&!module.nodeType&&module,It=wt&&wt.exports===Ct?c.Buffer:void 0,Tt=(It?It.isBuffer:void 0)||function(){return!1},Rt=9007199254740991,Ut=/^(?:0|[1-9]\d*)$/;function kt(t,e){var n=typeof t;return!!(e=null==e?Rt:e)&&("number"==n||"symbol"!=n&&Ut.test(t))&&t>-1&&t%1==0&&t<e}var Mt=9007199254740991;function Nt(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=Mt}var Bt={};function Lt(t){return function(e){return t(e)}}Bt["[object Float32Array]"]=Bt["[object Float64Array]"]=Bt["[object Int8Array]"]=Bt["[object Int16Array]"]=Bt["[object Int32Array]"]=Bt["[object Uint8Array]"]=Bt["[object Uint8ClampedArray]"]=Bt["[object Uint16Array]"]=Bt["[object Uint32Array]"]=!0,Bt["[object Arguments]"]=Bt["[object Array]"]=Bt["[object ArrayBuffer]"]=Bt["[object Boolean]"]=Bt["[object DataView]"]=Bt["[object Date]"]=Bt["[object Error]"]=Bt["[object Function]"]=Bt["[object Map]"]=Bt["[object Number]"]=Bt["[object Object]"]=Bt["[object RegExp]"]=Bt["[object Set]"]=Bt["[object String]"]=Bt["[object WeakMap]"]=!1;var zt="object"==typeof exports&&exports&&!exports.nodeType&&exports,Dt=zt&&"object"==typeof module&&module&&!module.nodeType&&module,Vt=Dt&&Dt.exports===zt&&s.process,Ft=function(){try{var t=Dt&&Dt.require&&Dt.require("util").types;return t||Vt&&Vt.binding&&Vt.binding("util")}catch(t){}}(),Qt=Ft&&Ft.isTypedArray,Ht=Qt?Lt(Qt):function(t){return mt(t)&&Nt(t.length)&&!!Bt[y(t)]},Xt=Object.prototype.hasOwnProperty;function Yt(t,e){var n=bt(t),r=!n&&Et(t),o=!n&&!r&&Tt(t),i=!n&&!r&&!o&&Ht(t),s=n||r||o||i,a=s?function(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}(t.length,String):[],c=a.length;for(var l in t)!e&&!Xt.call(t,l)||s&&("length"==l||o&&("offset"==l||"parent"==l)||i&&("buffer"==l||"byteLength"==l||"byteOffset"==l)||kt(l,c))||a.push(l);return a}var $t=Object.prototype;function Jt(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||$t)}function Kt(t,e){return function(n){return t(e(n))}}var Wt=Kt(Object.keys,Object),Zt=Object.prototype.hasOwnProperty;function Gt(t){return null!=t&&Nt(t.length)&&!x(t)}function qt(t){return Gt(t)?Yt(t):function(t){if(!Jt(t))return Wt(t);var e=[];for(var n in Object(t))Zt.call(t,n)&&"constructor"!=n&&e.push(n);return e}(t)}function te(t){return _t(t,qt,Pt)}var ee=1,ne=Object.prototype.hasOwnProperty;var re=B(c,"DataView"),oe=B(c,"Promise"),ie=B(c,"Set"),se=B(c,"WeakMap"),ae="[object Map]",ce="[object Promise]",le="[object Set]",ue="[object WeakMap]",he="[object DataView]",fe=w(re),pe=w(L),de=w(oe),ve=w(ie),be=w(se),_e=y;(re&&_e(new re(new ArrayBuffer(1)))!=he||L&&_e(new L)!=ae||oe&&_e(oe.resolve())!=ce||ie&&_e(new ie)!=le||se&&_e(new se)!=ue)&&(_e=function(t){var e=y(t),n="[object Object]"==e?t.constructor:void 0,r=n?w(n):"";if(r)switch(r){case fe:return he;case pe:return ae;case de:return ce;case ve:return le;case be:return ue}return e});var ye=_e,ge=1,je="[object Arguments]",Pe="[object Array]",me="[object Object]",Ae=Object.prototype.hasOwnProperty;function xe(t,e,r,o,i,s){var a=bt(t),c=bt(e),l=a?Pe:ye(t),u=c?Pe:ye(e),h=(l=l==je?me:l)==me,f=(u=u==je?me:u)==me,p=l==u;if(p&&Tt(t)){if(!Tt(e))return!1;a=!0,h=!1}if(p&&!h)return s||(s=new X),a||Ht(t)?W(t,e,r,o,i,s):function(t,e,r,o,i,s,a){switch(r){case ft:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case ht:return!(t.byteLength!=e.byteLength||!s(new Z(t),new Z(e)));case nt:case rt:case st:return n(+t,+e);case ot:return t.name==e.name&&t.message==e.message;case at:case lt:return t==e+"";case it:var c=G;case ct:var l=o&tt;if(c||(c=q),t.size!=e.size&&!l)return!1;var u=a.get(t);if(u)return u==e;o|=et,a.set(t,e);var h=W(c(t),c(e),o,i,s,a);return a.delete(t),h;case ut:if(dt)return dt.call(t)==dt.call(e)}return!1}(t,e,l,r,o,i,s);if(!(r&ge)){var d=h&&Ae.call(t,"__wrapped__"),v=f&&Ae.call(e,"__wrapped__");if(d||v){var b=d?t.value():t,_=v?e.value():e;return s||(s=new X),i(b,_,r,o,s)}}return!!p&&(s||(s=new X),function(t,e,n,r,o,i){var s=n&ee,a=te(t),c=a.length;if(c!=te(e).length&&!s)return!1;for(var l=c;l--;){var u=a[l];if(!(s?u in e:ne.call(e,u)))return!1}var h=i.get(t),f=i.get(e);if(h&&f)return h==e&&f==t;var p=!0;i.set(t,e),i.set(e,t);for(var d=s;++l<c;){var v=t[u=a[l]],b=e[u];if(r)var _=s?r(b,v,u,e,t,i):r(v,b,u,t,e,i);if(!(void 0===_?v===b||o(v,b,n,r,i):_)){p=!1;break}d||(d="constructor"==u)}if(p&&!d){var y=t.constructor,g=e.constructor;y==g||!("constructor"in t)||!("constructor"in e)||"function"==typeof y&&y instanceof y&&"function"==typeof g&&g instanceof g||(p=!1)}return i.delete(t),i.delete(e),p}(t,e,r,o,i,s))}function Oe(t,e,n,r,o){return t===e||(null==t||null==e||!mt(t)&&!mt(e)?t!=t&&e!=e:xe(t,e,n,r,Oe,o))}function Se(t,e){return Oe(t,e)}var Ee=function(){try{var t=B(Object,"defineProperty");return t({},"",{}),t}catch(t){}}();function Ce(t,e,n){"__proto__"==e&&Ee?Ee(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}var we=Object.prototype.hasOwnProperty;function Ie(t,e,r){var o=t[e];we.call(t,e)&&n(o,r)&&(void 0!==r||e in t)||Ce(t,e,r)}function Te(t,e,n,r){var o=!n;n||(n={});for(var i=-1,s=e.length;++i<s;){var a=e[i],c=r?r(n[a],t[a],a,n,t):void 0;void 0===c&&(c=t[a]),o?Ce(n,a,c):Ie(n,a,c)}return n}var Re=Object.prototype.hasOwnProperty;function Ue(t){if(!g(t))return function(t){var e=[];if(null!=t)for(var n in Object(t))e.push(n);return e}(t);var e=Jt(t),n=[];for(var r in t)("constructor"!=r||!e&&Re.call(t,r))&&n.push(r);return n}function ke(t){return Gt(t)?Yt(t,!0):Ue(t)}var Me="object"==typeof exports&&exports&&!exports.nodeType&&exports,Ne=Me&&"object"==typeof module&&module&&!module.nodeType&&module,Be=Ne&&Ne.exports===Me?c.Buffer:void 0,Le=Be?Be.allocUnsafe:void 0;var ze=Kt(Object.getPrototypeOf,Object),De=Object.getOwnPropertySymbols?function(t){for(var e=[];t;)vt(e,Pt(t)),t=ze(t);return e}:yt;function Ve(t){return _t(t,ke,De)}var Fe=Object.prototype.hasOwnProperty;function Qe(t){var e=new t.constructor(t.byteLength);return new Z(e).set(new Z(t)),e}var He=/\w*$/;var Xe=l?l.prototype:void 0,Ye=Xe?Xe.valueOf:void 0;var $e="[object Boolean]",Je="[object Date]",Ke="[object Map]",We="[object Number]",Ze="[object RegExp]",Ge="[object Set]",qe="[object String]",tn="[object Symbol]",en="[object ArrayBuffer]",nn="[object DataView]",rn="[object Float32Array]",on="[object Float64Array]",sn="[object Int8Array]",an="[object Int16Array]",cn="[object Int32Array]",ln="[object Uint8Array]",un="[object Uint8ClampedArray]",hn="[object Uint16Array]",fn="[object Uint32Array]";function pn(t,e,n){var r,o,i,s=t.constructor;switch(e){case en:return Qe(t);case $e:case Je:return new s(+t);case nn:return function(t,e){var n=e?Qe(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}(t,n);case rn:case on:case sn:case an:case cn:case ln:case un:case hn:case fn:return function(t,e){var n=e?Qe(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)}(t,n);case Ke:return new s;case We:case qe:return new s(t);case Ze:return(i=new(o=t).constructor(o.source,He.exec(o))).lastIndex=o.lastIndex,i;case Ge:return new s;case tn:return r=t,Ye?Object(Ye.call(r)):{}}}var dn=Object.create,vn=function(){function t(){}return function(e){if(!g(e))return{};if(dn)return dn(e);t.prototype=e;var n=new t;return t.prototype=void 0,n}}();var bn=Ft&&Ft.isMap,_n=bn?Lt(bn):function(t){return mt(t)&&"[object Map]"==ye(t)};var yn=Ft&&Ft.isSet,gn=yn?Lt(yn):function(t){return mt(t)&&"[object Set]"==ye(t)},jn=1,Pn=2,mn=4,An="[object Arguments]",xn="[object Function]",On="[object GeneratorFunction]",Sn="[object Object]",En={};function Cn(t,e,n,r,o,i){var s,a=e&jn,c=e&Pn,l=e&mn;if(n&&(s=o?n(t,r,o,i):n(t)),void 0!==s)return s;if(!g(t))return t;var u=bt(t);if(u){if(s=function(t){var e=t.length,n=new t.constructor(e);return e&&"string"==typeof t[0]&&Fe.call(t,"index")&&(n.index=t.index,n.input=t.input),n}(t),!a)return function(t,e){var n=-1,r=t.length;for(e||(e=Array(r));++n<r;)e[n]=t[n];return e}(t,s)}else{var h=ye(t),f=h==xn||h==On;if(Tt(t))return function(t,e){if(e)return t.slice();var n=t.length,r=Le?Le(n):new t.constructor(n);return t.copy(r),r}(t,a);if(h==Sn||h==An||f&&!o){if(s=c||f?{}:function(t){return"function"!=typeof t.constructor||Jt(t)?{}:vn(ze(t))}(t),!a)return c?function(t,e){return Te(t,De(t),e)}(t,function(t,e){return t&&Te(e,ke(e),t)}(s,t)):function(t,e){return Te(t,Pt(t),e)}(t,function(t,e){return t&&Te(e,qt(e),t)}(s,t))}else{if(!En[h])return o?t:{};s=pn(t,h,a)}}i||(i=new X);var p=i.get(t);if(p)return p;i.set(t,s),gn(t)?t.forEach((function(r){s.add(Cn(r,e,n,r,t,i))})):_n(t)&&t.forEach((function(r,o){s.set(o,Cn(r,e,n,o,t,i))}));var d=u?void 0:(l?c?Ve:te:c?ke:qt)(t);return function(t,e){for(var n=-1,r=null==t?0:t.length;++n<r&&!1!==e(t[n],n,t););}(d||t,(function(r,o){d&&(r=t[o=r]),Ie(s,o,Cn(r,e,n,o,t,i))})),s}En[An]=En["[object Array]"]=En["[object ArrayBuffer]"]=En["[object DataView]"]=En["[object Boolean]"]=En["[object Date]"]=En["[object Float32Array]"]=En["[object Float64Array]"]=En["[object Int8Array]"]=En["[object Int16Array]"]=En["[object Int32Array]"]=En["[object Map]"]=En["[object Number]"]=En[Sn]=En["[object RegExp]"]=En["[object Set]"]=En["[object String]"]=En["[object Symbol]"]=En["[object Uint8Array]"]=En["[object Uint8ClampedArray]"]=En["[object Uint16Array]"]=En["[object Uint32Array]"]=!0,En["[object Error]"]=En[xn]=En["[object WeakMap]"]=!1;function wn(t){return Cn(t,5)}function In(t){return t}var Tn=Math.max;var Rn=Ee?function(t,e){return Ee(t,"toString",{configurable:!0,enumerable:!1,value:(n=e,function(){return n}),writable:!0});var n}:In,Un=Rn,kn=Date.now;var Mn,Nn,Bn,Ln=(Mn=Un,Nn=0,Bn=0,function(){var t=kn(),e=16-(t-Bn);if(Bn=t,e>0){if(++Nn>=800)return arguments[0]}else Nn=0;return Mn.apply(void 0,arguments)});var zn=Object.prototype,Dn=zn.hasOwnProperty,Vn=function(t,e){return Ln(function(t,e,n){return e=Tn(void 0===e?t.length-1:e,0),function(){for(var r=arguments,o=-1,i=Tn(r.length-e,0),s=Array(i);++o<i;)s[o]=r[e+o];o=-1;for(var a=Array(e+1);++o<e;)a[o]=r[o];return a[e]=n(s),function(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}(t,this,a)}}(t,e,In),t+"")}((function(t,e){t=Object(t);var r=-1,o=e.length,i=o>2?e[2]:void 0;for(i&&function(t,e,r){if(!g(r))return!1;var o=typeof e;return!!("number"==o?Gt(r)&&kt(e,r.length):"string"==o&&e in r)&&n(r[e],t)}(e[0],e[1],i)&&(o=1);++r<o;)for(var s=e[r],a=ke(s),c=-1,l=a.length;++c<l;){var u=a[c],h=t[u];(void 0===h||n(h,zn[u])&&!Dn.call(t,u))&&(t[u]=s[u])}return t})),Fn=/\s/;var Qn=/^\s+/;function Hn(t){return t?t.slice(0,function(t){for(var e=t.length;e--&&Fn.test(t.charAt(e)););return e}(t)+1).replace(Qn,""):t}var Xn="[object Symbol]";function Yn(t){return"symbol"==typeof t||mt(t)&&y(t)==Xn}var $n=NaN,Jn=/^[-+]0x[0-9a-f]+$/i,Kn=/^0b[01]+$/i,Wn=/^0o[0-7]+$/i,Zn=parseInt;function Gn(t){if("number"==typeof t)return t;if(Yn(t))return $n;if(g(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=g(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=Hn(t);var n=Kn.test(t);return n||Wn.test(t)?Zn(t.slice(2),n?2:8):Jn.test(t)?$n:+t}var qn=1/0,tr=17976931348623157e292;function er(t){var e=function(t){return t?(t=Gn(t))===qn||t===-qn?(t<0?-1:1)*tr:t==t?t:0:0===t?t:0}(t),n=e%1;return e==e?n?e-n:e:0}var nr=1/0,rr=l?l.prototype:void 0,or=rr?rr.toString:void 0;function ir(t){if("string"==typeof t)return t;if(bt(t))return function(t,e){for(var n=-1,r=null==t?0:t.length,o=Array(r);++n<r;)o[n]=e(t[n],n,t);return o}(t,ir)+"";if(Yn(t))return or?or.call(t):"";var e=t+"";return"0"==e&&1/t==-nr?"-0":e}function sr(t){return null==t?"":ir(t)}var ar=c.isFinite,cr=Math.min;var lr=function(t){var e=Math[t];return function(t,n){if(t=Gn(t),(n=null==n?0:cr(er(n),292))&&ar(t)){var r=(sr(t)+"e").split("e");return+((r=(sr(e(r[0]+"e"+(+r[1]+n)))+"e").split("e"))[0]+"e"+(+r[1]-n))}return e(t)}}("round");const ur=Symbol("fabric-path-editor-symbol"),hr=Symbol("fabric-path-editor-record-info");var fr,pr;!function(t){t.BACKGROUND="background",t.MAJOR_POINT="major-point",t.SUB_POINT="sub-point",t.SPLIT_POINT="split-point"}(fr||(fr={})),function(t){t.START="M",t.LINE="L",t.QUADRATIC_CURCE="Q",t.BEZIER_CURVE="C",t.CLOSE="z"}(pr||(pr={}));const dr=[pr.QUADRATIC_CURCE,pr.BEZIER_CURVE];class vr{constructor(t,e={}){this._options={},this.source=null,this.target=null,this.controllers={points:[],handlers:[],activePoints:[]},this.listeners=[],this.records={undo:[],redo:[]},this._inbuiltStatus={cancelSelectEvent:!1,extraActions:!0,autoPathMerge:!1,awaitAdd:!1},this._storePlatformStatus=null,this._updateStyle=()=>{const{points:t,handlers:e,activePoints:n,activeHandlerPoint:r}=this.controllers;t.forEach((t=>{n.includes(t)?t.item(0).set({fill:"#29ca6e"}):t.item(0).set({fill:"#ffffff"})})),e.forEach((t=>{t.point===r?t.point.item(0).set({stroke:"#4b4b4b"}):t.point.item(0).set({stroke:"#bebebe"})}))},this._platform=t,this._options=Vn(e,this._options)}observe(t){this.source=t}static transformPath(t,e,n=!0){const{translate:r,scale:o,rotate:i}=e,s=n?t.path:wn(t.path);return null==s||s.forEach(((t,e)=>{const[,...n]=t;for(let t=0;t<n.length;t+=2){let n=s[e][t+1],a=s[e][t+2];void 0!==o&&(n*=o.x,a*=o.y),void 0!==i&&(n=Math.cos(i*Math.PI/180)*n-Math.sin(i*Math.PI/180)*a,a=Math.sin(i*Math.PI/180)*n+Math.cos(i*Math.PI/180)*a),void 0!==r&&(n+=r.x,a+=r.y),s[e][t+1]=n,s[e][t+2]=a}})),s}static initializePath(e,n,r=[1,0,0,1,0,0]){var o;const i=e.left,s=e.top;null===(o=e.path)||void 0===o||o.forEach((t=>{const[,...e]=t;for(let n=0;n<e.length;n+=2)t[n+1]=lr(t[n+1],3),t[n+2]=lr(t[n+2],3)}));const a=new t.fabric.Path(t.fabric.util.joinPath(e.path)).getCenterPoint();e.initialize(n);const c=new t.fabric.Path(n).getCenterPoint(),l=t.fabric.util.transformPoint(new t.fabric.Point(c.x-a.x,c.y-a.y),r);e.set({left:i+l.x,top:s+l.y}),e.setCoords()}static convertQuadraticToCubic(t,e){const n=Array.from({length:2}).map(((t,n)=>({x:e[2*n+1],y:e[2*n+2]}))),[r,o]=n,i={x:2/3*r.x+1/3*t.x,y:2/3*r.y+1/3*t.y},s={x:2/3*r.x+1/3*o.x,y:2/3*r.y+1/3*o.y},a=o;return["C",i.x,i.y,s.x,s.y,a.x,a.y]}_toRelativeCrood(t,e){const[n,,,,r,o]=this._platform.viewportTransform;return{x:(t-r)/n,y:(e-o)/n}}_patchPath(e){if(!e.path)return;vr.transformPath(e,{translate:{x:-e.pathOffset.x,y:-e.pathOffset.y}});const n=this._splitPath(e.path);for(const t of n){t[0][0]!==pr.START&&(t[0]=[pr.START,...t[0].slice(t[0].length-2)]);if(t[t.length-1][0]===pr.CLOSE){const e=t[0].slice(t[0].length-2),n=t[t.length-2].slice(t[t.length-2].length-2);t[0]!==t[t.length-2]&&n[0]===e[0]&&n[1]===e[1]||t.splice(t.length-1,0,[pr.LINE,e[0],e[1]])}}e.path=n.flat(1),e.pathOffset=new t.fabric.Point(0,0)}_initBackground(){if(!this._platform)return;const e=new t.fabric.StaticCanvas(null,{width:20,height:20});e.add(new t.fabric.Rect({width:20,height:20,fill:"transparent",stroke:"#f1f1f1",strokeWidth:.5,strokeDashArray:[4,2]})),e.renderAll();const n=new t.fabric.Rect({width:this._platform.getWidth(),height:this._platform.getHeight(),fill:new t.fabric.Pattern({source:e.getElement(),repeat:"repeat"}),objectCaching:!1,selectable:!1});n[ur]=!0,n[hr]={type:fr.BACKGROUND},this._platform.add(n)}_initPlatformStatus(){var t;if(!this._platform)return;const e=this._platform;this._storePlatformStatus={canvasSelection:null!==(t=e.selection)&&void 0!==t&&t,objectSelections:new WeakMap(e._objects.map((t=>{var e;return[t,null===(e=t.selectable)||void 0===e||e]})))},e.selection=!0,e.preserveObjectStacking=!0,e.controlsAboveOverlay=!0,e.discardActiveObject(),e.forEachObject((t=>{t.set({selectable:!1})}))}_splitPath(t){return t.reduce(((t,e,n,r)=>e?(e[0]===pr.START&&t[t.length-1].length&&t.push([]),t[t.length-1].push(e),e[0]===pr.CLOSE&&n!==r.length-1&&t.push([]),t):t),[[]])}_splitCurve(n,r){2===n.length&&n.splice(1,0,{x:(n[1].x+n[0].x)/2,y:(n[1].y+n[0].y)/2});const o=new e.Bezier(n),{t:i}=o.project(r),s=o.split(i),a=new t.fabric.Path(s.left.toSVG()+s.right.toSVG()).path;return{pre:a[1],next:a[3]}}_getAroundInstructions(t){var e;const n=this.target.path,r=this._splitPath(n),o=r.find((e=>e.includes(t))),i=o.indexOf(t);let s=o[i-1],a=o[i+1];return(null===(e=o[o.length-1])||void 0===e?void 0:e[0])===pr.CLOSE&&!s&&(s=o[o.length-2]),a&&a[0]===pr.CLOSE&&(a=o[0]),{path:o,paths:r,cur:t,pre:null!=s?s:null,next:null!=a?a:null}}_getInstructionMajorPoint(t){return this.controllers.points.find((e=>e[hr].instruction===t))}_getAroundPoints(t){const{path:e,cur:n,pre:r,next:o}=this._getAroundInstructions(t[hr].instruction),i={instruction:n,instructionValueIdx:n.length-2,point:{x:n[n.length-2],y:n[n.length-1]},pointType:fr.MAJOR_POINT};let s,a;switch(n[0]){case pr.START:if(r)if(dr.includes(r[0]))s={instruction:r,instructionValueIdx:r.length-4,point:{x:r[r.length-4],y:r[r.length-3]},pointType:fr.SUB_POINT};else{const t=e[2%(e.length-1)];s={instruction:t,instructionValueIdx:t.length-2,point:{x:t[t.length-2],y:t[t.length-1]},pointType:fr.MAJOR_POINT}}break;case pr.LINE:r&&(s={instruction:r,instructionValueIdx:r.length-2,point:{x:r[r.length-2],y:r[r.length-1]},pointType:fr.MAJOR_POINT});break;case pr.QUADRATIC_CURCE:s={instruction:n,instructionValueIdx:1,point:{x:n[1],y:n[2]},pointType:fr.SUB_POINT};break;case pr.BEZIER_CURVE:s={instruction:n,instructionValueIdx:3,point:{x:n[3],y:n[4]},pointType:fr.SUB_POINT}}return o&&(a={instruction:o,instructionValueIdx:1,point:{x:o[1],y:o[2]},pointType:dr.includes(o[0])?fr.SUB_POINT:fr.MAJOR_POINT}),{cur:i,pre:s,next:a}}_updatePathInstruction(t,e){t.splice(0,t.length,...e)}_insertPathInstruction(t,e){var n;const r=null===(n=this.target)||void 0===n?void 0:n.path;if(r){const n=r.indexOf(t);r.splice(n+1,0,e)}}_calcAbsolutePosition(e){const n=t.fabric.util.transformPoint(new t.fabric.Point(e.x,e.y),this.source.calcOwnMatrix());return{left:n.x,top:n.y}}_calcRelativeCrood(e){return t.fabric.util.transformPoint(new t.fabric.Point(e.left,e.top),t.fabric.util.invertTransform(this.source.calcOwnMatrix()))}_initPathControlPoints(e=!1){var n;const r=this._platform,o=this.target;if(!r||!o)return;const{points:i,activePoints:s}=this.controllers;this._inbuiltStatus.cancelSelectEvent=!0,r.discardActiveObject(),r.remove(...i);const a=[];null===(n=this._splitPath(o.path))||void 0===n||n.forEach((e=>{e.forEach(((n,r)=>{var o;const s=n;if(s[0]===pr.CLOSE)return;if((null===(o=e[r+1])||void 0===o?void 0:o[0])===pr.CLOSE)return;const[c,l]=s.slice(s.length-2),u=i.pop();u&&this._observe(u,(()=>{}));const h=null!=u?u:new t.fabric.Group([new t.fabric.Circle({strokeWidth:4,radius:6,fill:"#ffffff",stroke:"#4b4b4b",originX:"center",originY:"center"})],{originX:"center",originY:"center",hasBorders:!1,hasControls:!1});h[ur]=!0,h[hr]={type:fr.MAJOR_POINT,instruction:s,instructionValueIdx:s.length-2},h.set(this._calcAbsolutePosition({x:c,y:l})),a.push(h)}))})),r.add(...a),this.controllers.points=a,this.controllers.activePoints=s.filter((t=>a.includes(t))),this._inbuiltStatus.cancelSelectEvent=!1,e||this._fire("update")}_createPathControlHandler(){const e=new t.fabric.Group([new t.fabric.Circle({radius:4,stroke:"#bebebe",strokeWidth:2,fill:"#bebebe",originX:"center",originY:"center"})],{originX:"center",originY:"center",hasBorders:!1,hasControls:!1});e[ur]=!0,e[hr]={type:fr.SUB_POINT};return{point:e,line:new t.fabric.Line([0,0,0,0],{stroke:"#bebebe",strokeWidth:1,strokeDashArray:[4,3],strokeUniform:!0,selectable:!1,evented:!1,originX:"center",originY:"center"})}}_reversePath(t){const e=[];let n=!1;for(let r=t.length-1;r>=0;r--){const o=t[r],i=t[r-1],s=null==i?void 0:i.slice(i.length-2);switch(r===t.length-1&&(o[0]===pr.CLOSE?e.push([pr.START,...s]):e.push([pr.START,...o.slice(o.length-2)])),o[0]){case pr.START:n&&e.push([pr.CLOSE]);break;case pr.LINE:e.push([pr.LINE,...s]);break;case pr.QUADRATIC_CURCE:e.push([pr.QUADRATIC_CURCE,o[1],o[2],...s]);break;case pr.BEZIER_CURVE:e.push([pr.BEZIER_CURVE,o[3],o[4],o[1],o[2],...s]);break;case pr.CLOSE:n=!0}}return e}_mergePath(t,e){const n=this.target.path,r=this._splitPath(n),o=t[hr],i=e[hr];let s,a,c;for(let t=0;t<r.length;){const e=r[t];if(s&&a)break;e.includes(o.instruction)&&(s=e),e.includes(i.instruction)&&(a=e),e!==s&&e!==a?t++:r.splice(t,1)}void 0!==s&&void 0!==a&&(s===a?(s.push([pr.CLOSE]),c=s):(o.instruction===s[0]&&(s=this._reversePath(s)),i.instruction===a[a.length-1]&&(a=this._reversePath(a)),a.shift(),c=s.concat(a)),r.push(c),this.target.path=r.flat(1),this._initPathControlPoints())}_observe(t,e){let{left:n=0,top:r=0}=t;Object.defineProperties(t,{left:{get:()=>n,set:t=>{if(n===t)return;const o={left:n,top:r};n=t,e({left:n,top:r},o)}},top:{get:()=>r,set:t=>{if(r===t)return;const o={left:n,top:r};r=t,e({left:n,top:r},o)}}})}_fire(t){this.target&&(this.target.set({backgroundColor:"rgba(255, 125, 125, 0.8)"}),"update"===t&&this._updatePath())}_on(t,e,n){"global"===t&&window.addEventListener(e,n),"canvas"===t&&this._platform.on(e,n),this.listeners.push({type:t,eventName:e,handler:n})}_initEvents(){this._on("canvas","mouse:move",(t=>{})),(()=>{this._on("canvas","selection:created",(t=>{this._inbuiltStatus.cancelSelectEvent||this.focus(...t.selected)})),this._on("canvas","selection:updated",(t=>{this._inbuiltStatus.cancelSelectEvent||this.focus(...t.selected)})),this._on("canvas","selection:cleared",(()=>{this._inbuiltStatus.cancelSelectEvent||this.focus()}))})(),(()=>{let t;const e=[{combinationKeys:["alt"],onActivate:()=>{this._inbuiltStatus.extraActions=!1,this._inbuiltStatus.awaitAdd=!0},onDeactivate:()=>{this._inbuiltStatus.extraActions=!0,this._inbuiltStatus.awaitAdd=!1}},{combinationKeys:["ctrl"],onActivate:()=>{this._inbuiltStatus.autoPathMerge=!0},onDeactivate:()=>{this._inbuiltStatus.autoPathMerge=!1}},{key:"backspace",onActivate:()=>{const{handlers:t,activeHandlerPoint:e,activePoints:n}=this.controllers;if(e){const n=null==t?void 0:t.find((t=>t.point===e));n&&(this._inbuiltStatus.cancelSelectEvent=!0,this.transferToLine(n.belong,n.belongPosition),this._updatePointHandlers(),this._updateStyle(),this._inbuiltStatus.cancelSelectEvent=!1)}else this.remove(...n)}},{key:"z",combinationKeys:["ctrl"],onActivate:()=>{if(this.records.undo.length>1){let t=this.records.undo.pop();t&&(this.records.redo.push(t),t=this.records.undo[this.records.undo.length-1],t&&this._initializePath(t.path,t.left,t.top))}}},{key:"z",combinationKeys:["ctrl","shift"],onActivate:()=>{let t=this.records.redo.pop();t&&(this.records.undo.push(t),this._initializePath(t.path,t.left,t.top))}}],n=n=>{var r;let o=n.key.toLowerCase();const i=e.filter((t=>{const{key:e,combinationKeys:r=[]}=t;return("keyup"!==n.type||e!==o)&&(!(!e&&0===r.length)&&!(e&&e!==o||r.some((t=>!n[`${t}Key`]))))}));i.sort(((t,e)=>{var n,r,o,i;return t.key&&!e.key?-1:(null!==(r=null===(n=e.combinationKeys)||void 0===n?void 0:n.length)&&void 0!==r?r:0)-(null!==(i=null===(o=t.combinationKeys)||void 0===o?void 0:o.length)&&void 0!==i?i:0)}));const s=i[0];t!==s&&(null===(r=null==t?void 0:t.onDeactivate)||void 0===r||r.call(t),t=s,null==t||t.onActivate())};this._on("global","keydown",n.bind(this)),this._on("global","keyup",n.bind(this)),this._on("global","blur",(()=>{var e;t&&(null===(e=t.onDeactivate)||void 0===e||e.call(t),t=void 0)}))})(),(()=>{this._on("canvas","mouse:dblclick",(t=>{var e,n;const r=t.target;if((null===(e=r[hr])||void 0===e?void 0:e.type)===fr.MAJOR_POINT){const{pre:t,next:e}=this._getAroundPoints(r);[t,e].every((t=>!t||(null==t?void 0:t.pointType)===fr.SUB_POINT))?this.transferToLine(r,"both"):this.transferToCurce(r)}if((null===(n=r[hr])||void 0===n?void 0:n.type)===fr.SUB_POINT){const{cur:t,pre:e}=this._getAroundInstructions(r[hr].instruction);if(t[0]===pr.BEZIER_CURVE)return;t[0]=pr.BEZIER_CURVE,this._updatePathInstruction(t,vr.convertQuadraticToCubic({x:e[e.length-2],y:e[e.length-1]},t))}this._updatePointHandlers()}))})(),(()=>{let t,e,n=[];this._on("canvas","mouse:down",(()=>{const{activePoint:e,points:r}=this.controllers;if(!e)return;const{pre:o,next:i}=this._getAroundInstructions(e[hr].instruction);o&&i||(t=e,n=r.filter((t=>{if(t===e)return!1;const{pre:n,next:r}=this._getAroundInstructions(t[hr].instruction);return!n||!r})))})),this._on("canvas","mouse:move",(r=>{t&&(e=void 0,n.forEach((t=>{this._inbuiltStatus.autoPathMerge&&t.containsPoint(r.pointer)?(t.scale(1.2),e=t):t.scale(1)})))})),this._on("canvas","mouse:up",(()=>{t&&e&&this._mergePath(t,e),t=void 0,e=void 0,n.forEach((t=>t.scale(1))),n.length=0}))})(),(()=>{let e,n,r;this._on("canvas","mouse:down:before",(r=>{var o;const{e:i}=r;if(this.target&&this._inbuiltStatus.awaitAdd&&(null===(o=r.target[hr])||void 0===o?void 0:o.type)===fr.BACKGROUND){const{activePoint:r}=this.controllers;if(!r)return;const{paths:o,path:s,pre:a,cur:c,next:l}=this._getAroundInstructions(r[hr].instruction);if(a&&l)return;const{x:u,y:h}=this._toRelativeCrood(i.offsetX,i.offsetY),f=t.fabric.util.transformPoint(new t.fabric.Point(u,h),t.fabric.util.invertTransform(this.source.calcOwnMatrix()));a||(e=[pr.START,f.x,f.y],n=c,c[0]=pr.LINE,s.unshift(e)),l||(e=[pr.LINE,f.x,f.y],n=e,s.push(e)),this.target.path=o.flat(1),this._initPathControlPoints()}})),this._on("canvas","mouse:down",(()=>{e&&(r=this._getInstructionMajorPoint(e),r&&(this.focus(r),this._platform.selection=!1))})),this._on("canvas","mouse:move",(e=>{const{e:o}=e;if(r&&n){if(r.containsPoint(e.pointer)&&n[0]!==pr.QUADRATIC_CURCE)return;const{x:i,y:s}=this._toRelativeCrood(o.offsetX,o.offsetY),a=t.fabric.util.transformPoint(new t.fabric.Point(i,s),t.fabric.util.invertTransform(this.source.calcOwnMatrix()));n[0]===pr.QUADRATIC_CURCE?(n[1]=a.x,n[2]=a.y):(n[0]=pr.QUADRATIC_CURCE,n.splice(1,0,a.x,a.y)),this._updatePointHandlers()}})),this._on("canvas","mouse:up",(()=>{e=void 0,n=void 0,r=void 0,this._platform.selection=!0,this._fire("update")}))})(),(()=>{this._on("canvas","object:modified",(()=>{this._fire("update")}))})()}async enterEditing(t){if(!this.source||"path"!==this.source.type)throw Error("Please observe target path before editing.");this._initBackground(),this._initPlatformStatus(),this.target=await new Promise((t=>this.source.clone(t))),this._patchPath(this.target),t&&t(this.target),this.target[ur]=!0,this.target.set({selectable:!1,evented:!1,objectCaching:!1}),this._platform.add(this.target),this._platform.renderOnAddRemove=!1,this._initPathControlPoints(),this._platform.renderOnAddRemove=!0,this._platform.renderAll(),this._initEvents(),this.focus(this.controllers.points[0])}_initializePath(t,e,n){this.target&&(this.target.initialize(t),this.target.set({left:e,top:n}).setCoords(),this._initPathControlPoints(!0),this._platform.renderAll())}_updatePath(e){if(!this.target)return;const n=null!=e?e:t.fabric.util.joinPath(this.target.path),r=this.records.undo[this.records.undo.length-1];if(r){const e=new t.fabric.Path(r.path).getCenterPoint(),o=this.target.path;this.target.initialize(n),this.target.path=o;const i=this.target.getCenterPoint(),s=t.fabric.util.transformPoint(new t.fabric.Point(i.x-e.x,i.y-e.y),[1,0,0,1,0,0]);this.target.set({left:r.left+s.x,top:r.top+s.y}),this.target.setCoords()}this.records.redo.length=0,this.records.undo.push({left:this.target.left,top:this.target.top,path:t.fabric.util.joinPath(this.target.path)})}updatePath(t){this._updatePath(t),this._initPathControlPoints(!0),this._platform.renderAll()}leaveEditing(){}_updatePointHandlers(){const t=this._platform,{activePoint:e}=this.controllers;if(!e)return t.remove(...this.controllers.handlers.map((t=>[t.point,t.line])).flat(1)),this.controllers.handlers=[],void(this.controllers.activeHandlerPoint=void 0);const{pre:n,cur:r,next:o}=this._getAroundInstructions(e[hr].instruction),i=[];[r[0]===pr.START&&n?this._getAroundInstructions(n).pre:n,r,o].map(((t,e)=>{var o;if(!t)return;const s=this._getInstructionMajorPoint(t);if(!s)return;const a=this._getAroundPoints(s);a.pre&&i.push({item:a.pre,belong:s,belongPosition:"pre",hidden:0===e||2===e&&t[0]===pr.QUADRATIC_CURCE}),a.next&&i.push({item:a.next,belong:s,belongPosition:"next",hidden:2===e||0===e&&(null===(o=r[0]===pr.START?n:r)||void 0===o?void 0:o[0])===pr.QUADRATIC_CURCE})}));const s=i.map((({item:t,belong:e,belongPosition:n,hidden:r})=>{var o;if(!t)return;const{point:i,pointType:s,instruction:a,instructionValueIdx:c}=t;if(!i)return;if(s!==fr.SUB_POINT)return;const l=null!==(o=this.controllers.handlers.find((t=>t.belong===e&&t.belongPosition===n)))&&void 0!==o?o:this._createPathControlHandler();return l.belong=e,l.belongPosition=n,l.hidden=r,l.point[hr].instruction=a,l.point[hr].instructionValueIdx=c,l.point.set({visible:!r}),l.line.set({visible:!r}),this._observe(l.point,(({left:t,top:n})=>{const{x:r,y:o}=this._calcRelativeCrood({left:t,top:n});l.line.set({x1:e.left,y1:e.top,x2:l.point.left,y2:l.point.top}),a[c]=r,a[c+1]=o,this._inbuiltStatus.extraActions?this.controllers.activeHandlerPoint&&l.mirror&&!l.mirror.hidden&&(l.mirror.point.set({left:2*e.left-l.point.left,top:2*e.top-l.point.top}),l.mirror.line.set({x1:e.left,y1:e.top,x2:l.mirror.point.left,y2:l.mirror.point.top})):(l.mirror&&(l.mirror.mirror=void 0),l.mirror=void 0),l.point.setCoords()})),l.point.set(this._calcAbsolutePosition(i)),l}));for(const t of s)if("pre"===(null==t?void 0:t.belongPosition)){const e=t.belong;if(!e)continue;const n=s.find((t=>(null==t?void 0:t.belong)===e&&"next"===(null==t?void 0:t.belongPosition)));void 0!==t&&void 0!==n&&t.point.left+n.point.left===2*e.left&&t.point.top+n.point.top===2*e.top&&(t.mirror=n,n.mirror=t)}t.remove(...this.controllers.handlers.filter((t=>!s.includes(t))).map((t=>[t.point,t.line])).flat(1)),this.controllers.handlers=s.filter(Boolean),s.every((t=>(null==t?void 0:t.point)!==this.controllers.activeHandlerPoint))&&(this.controllers.activeHandlerPoint=void 0),t.add(...this.controllers.handlers.filter((t=>void 0===t.point.canvas)).map((t=>[t.point,t.line])).flat(1))}move(t,e){const{left:n,top:r}=e,o=t.group,{scaleX:i,scaleY:s}=t,{scaleX:a,scaleY:c}=o?{scaleX:1/o.scaleX,scaleY:1/o.scaleY}:{scaleX:1,scaleY:1};t.set({scaleX:a,scaleY:c});const l=t[hr].instruction,u=this._calcRelativeCrood({left:n,top:r}),h=u.x-l[l.length-2],f=u.y-l[l.length-1],{path:p}=this._getAroundInstructions(t[hr].instruction),{handlers:d}=this.controllers;l[l.length-2]=u.x,l[l.length-1]=u.y;const{pre:v,next:b}=this._getAroundPoints(t);[[v,"pre"],[b,"next"]].forEach((([e,o])=>{if((null==e?void 0:e.pointType)===fr.SUB_POINT){const{instruction:l,instructionValueIdx:p,point:v}=e,b={left:v.x+h-u.x,top:v.y+f-u.y};b.left*=i/a,b.top*=s/c,l[p]=u.x+b.left,l[p+1]=u.y+b.top;const _=null==d?void 0:d.find((e=>e.belong===t&&e.belongPosition===o));_&&(this._inbuiltStatus.extraActions?_.point.set(this._calcAbsolutePosition({x:l[p],y:l[p+1]})):_.line.set({x1:n,y1:r,x2:_.point.left,y2:_.point.top}))}}));const _=p[p.length-2];_&&l!==_&&_[0]!==pr.CLOSE&&p[0]===l&&p[p.length-1][0]===pr.CLOSE&&(_[_.length-2]=u.x,_[_.length-1]=u.y),t.setCoords()}focus(...e){const n=this._platform,{handlers:r}=this.controllers;this._inbuiltStatus.cancelSelectEvent=!0,e=e.filter((t=>void 0!==t[hr])),n.discardActiveObject();const o=e=>{this._observe(e,(()=>{e._objects.forEach((e=>{var n;if((null===(n=e[hr])||void 0===n?void 0:n.type)!==fr.MAJOR_POINT)return;const r=e,o=t.fabric.util.qrDecompose(r.calcTransformMatrix()),i=o.translateX,s=o.translateY;this.move(r,{left:i,top:s})}))}))},i=t=>{this._observe(t,(({left:e,top:n})=>{t.group||this.move(t,{left:e,top:n})}))},s=[],a=[];if(e.length)if(e.forEach((t=>{if(t[hr].type===fr.MAJOR_POINT&&s.push(t),t[hr].type===fr.SUB_POINT){const e=r.find((e=>e.point===t));s.push(e.belong),a.push(t)}})),e.length>1){const r=new t.fabric.ActiveSelection(e,{canvas:n,lockScalingFlip:!0,lockRotation:!0,originX:"center",originY:"center"});n.setActiveObject(r),o(r)}else n.setActiveObject(e[0]),i(s[0]);this.controllers.activePoints=s,this.controllers.activePoint=1===s.length?s[0]:void 0,this.controllers.activeHandlerPoint=1===a.length?a[0]:void 0,this._updatePointHandlers(),this._updateStyle(),n.renderAll(),this._inbuiltStatus.cancelSelectEvent=!1}remove(...t){if(!this.target)return;if(0===(t=t.filter((t=>t[hr].type===fr.MAJOR_POINT&&void 0!==t[hr].instruction))).length)return;const e=this._platform,n=this.target.path;if(!n)return;let r=this._splitPath(n);t.forEach((t=>{var e;const{instruction:n}=t[hr];if(!n)return;const o=r.findIndex((t=>t.includes(n))),i=r[o],s=i.indexOf(n),a=i.slice(0,s),c=i.slice(s+1);if((null===(e=c[c.length-1])||void 0===e?void 0:e[0])===pr.CLOSE){c.pop();const t=c[c.length-1];if(0===s&&t&&Se(t.slice(t.length-2),n.slice(n.length-2)))c.pop();else{const e=a[0];(null==e?void 0:e[0])===pr.START&&(e[0]=pr.LINE,Se(e.slice(e.length-2),t.slice(t.length-2))&&a.shift())}c.push(...a),r.splice(o,1,c)}else 1===a.length&&a[0][0]===pr.START?r.splice(o,1,c):r.splice(o,1,a,c);n[0]!==pr.START&&c.unshift(wn(n));const l=c[0];l&&(l.splice(1,{[pr.START]:0,[pr.LINE]:0,[pr.BEZIER_CURVE]:4,[pr.QUADRATIC_CURCE]:2}[l[0]]),l[0]=pr.START)})),this.target.path=r.flat(1),this._initPathControlPoints(),this.focus(),e.requestRenderAll()}transferToLine(t,e){if(!this.controllers.points.includes(t))return;const{cur:n,next:r,pre:o}=this._getAroundInstructions(t[hr].instruction);if("pre"===e||"both"===e){const t=n[0]===pr.START?o:n;t&&(t.splice(1,{[pr.BEZIER_CURVE]:4,[pr.QUADRATIC_CURCE]:2}[t[0]]),t[0]=pr.LINE)}"next"!==e&&"both"!==e||r&&(r.splice(1,{[pr.BEZIER_CURVE]:4,[pr.QUADRATIC_CURCE]:2}[r[0]]),r[0]=pr.LINE),this._platform.requestRenderAll()}transferToCurce(t){if(!this.controllers.points.includes(t))return;const{cur:e,pre:n,next:r}=this._getAroundInstructions(t[hr].instruction);if(!n&&!r)return;const o=e[0]===pr.START&&n?this._getAroundInstructions(n).pre:n;if(o&&r){const t=[o,e,r].map((t=>({x:t[t.length-2],y:t[t.length-1]}))),i=this._splitCurve(t,t[1]),s=e[0]===pr.START?n:e;s&&!dr.includes(s[0])&&this._updatePathInstruction(s,i.pre),r&&!dr.includes(r[0])&&this._updatePathInstruction(r,i.next)}else{const t={x:e[e.length-2],y:e[e.length-1]},i=null!=r?r:o,s={x:i[i.length-2],y:i[i.length-1]},a=Math.sqrt(Math.pow(t.x-s.x,2)+Math.pow(t.y-s.y,2)),c={x:t.x+(s.y-t.y)/a*(a/3),y:t.y+(s.x-t.x)/a*(a/3)};if(o){const r=e[0]===pr.START?n:e;this._updatePathInstruction(r,[pr.QUADRATIC_CURCE,c.x,c.y,t.x,t.y])}else r&&this._updatePathInstruction(r,[pr.QUADRATIC_CURCE,c.x,c.y,s.x,s.y])}}destroy(){}}return vr}));
