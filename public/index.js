!function(t,e){t&&!t.getElementById("livereloadscript")&&((e=t.createElement("script")).async=1,e.src="//"+(self.location.host||"localhost").split(":")[0]+":35729/livereload.js?snipver=1",e.id="livereloadscript",t.getElementsByTagName("head")[0].appendChild(e))}(self.document),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("fabric")):"function"==typeof define&&define.amd?define(["fabric"],e):(t="undefined"!=typeof globalThis?globalThis:t||self).FabricPathEditor=e(t.fabric)}(this,(function(e){"use strict";const{abs:n,cos:r,sin:i,acos:o,atan2:s,sqrt:c,pow:a}=Math;function u(t){return t<0?-a(-t,1/3):a(t,1/3)}const l=Math.PI,f=2*l,h=l/2,p=Number.MAX_SAFE_INTEGER||9007199254740991,y=Number.MIN_SAFE_INTEGER||-9007199254740991,d={x:0,y:0,z:0},v={Tvalues:[-.06405689286260563,.06405689286260563,-.1911188674736163,.1911188674736163,-.3150426796961634,.3150426796961634,-.4337935076260451,.4337935076260451,-.5454214713888396,.5454214713888396,-.6480936519369755,.6480936519369755,-.7401241915785544,.7401241915785544,-.820001985973903,.820001985973903,-.8864155270044011,.8864155270044011,-.9382745520027328,.9382745520027328,-.9747285559713095,.9747285559713095,-.9951872199970213,.9951872199970213],Cvalues:[.12793819534675216,.12793819534675216,.1258374563468283,.1258374563468283,.12167047292780339,.12167047292780339,.1155056680537256,.1155056680537256,.10744427011596563,.10744427011596563,.09761865210411388,.09761865210411388,.08619016153195327,.08619016153195327,.0733464814110803,.0733464814110803,.05929858491543678,.05929858491543678,.04427743881741981,.04427743881741981,.028531388628933663,.028531388628933663,.0123412297999872,.0123412297999872],arcfn:function(t,e){const n=e(t);let r=n.x*n.x+n.y*n.y;return void 0!==n.z&&(r+=n.z*n.z),c(r)},compute:function(t,e,n){if(0===t)return e[0].t=0,e[0];const r=e.length-1;if(1===t)return e[r].t=1,e[r];const i=1-t;let o=e;if(0===r)return e[0].t=t,e[0];if(1===r){const e={x:i*o[0].x+t*o[1].x,y:i*o[0].y+t*o[1].y,t:t};return n&&(e.z=i*o[0].z+t*o[1].z),e}if(r<4){let e,s,c,a=i*i,u=t*t,l=0;2===r?(o=[o[0],o[1],o[2],d],e=a,s=i*t*2,c=u):3===r&&(e=a*i,s=a*t*3,c=i*u*3,l=t*u);const f={x:e*o[0].x+s*o[1].x+c*o[2].x+l*o[3].x,y:e*o[0].y+s*o[1].y+c*o[2].y+l*o[3].y,t:t};return n&&(f.z=e*o[0].z+s*o[1].z+c*o[2].z+l*o[3].z),f}const s=JSON.parse(JSON.stringify(e));for(;s.length>1;){for(let e=0;e<s.length-1;e++)s[e]={x:s[e].x+(s[e+1].x-s[e].x)*t,y:s[e].y+(s[e+1].y-s[e].y)*t},void 0!==s[e].z&&(s[e].z=s[e].z+(s[e+1].z-s[e].z)*t);s.splice(s.length-1,1)}return s[0].t=t,s[0]},computeWithRatios:function(t,e,n,r){const i=1-t,o=n,s=e;let c,a=o[0],u=o[1],l=o[2],f=o[3];return a*=i,u*=t,2===s.length?(c=a+u,{x:(a*s[0].x+u*s[1].x)/c,y:(a*s[0].y+u*s[1].y)/c,z:!!r&&(a*s[0].z+u*s[1].z)/c,t:t}):(a*=i,u*=2*i,l*=t*t,3===s.length?(c=a+u+l,{x:(a*s[0].x+u*s[1].x+l*s[2].x)/c,y:(a*s[0].y+u*s[1].y+l*s[2].y)/c,z:!!r&&(a*s[0].z+u*s[1].z+l*s[2].z)/c,t:t}):(a*=i,u*=1.5*i,l*=3*i,f*=t*t*t,4===s.length?(c=a+u+l+f,{x:(a*s[0].x+u*s[1].x+l*s[2].x+f*s[3].x)/c,y:(a*s[0].y+u*s[1].y+l*s[2].y+f*s[3].y)/c,z:!!r&&(a*s[0].z+u*s[1].z+l*s[2].z+f*s[3].z)/c,t:t}):void 0))},derive:function(t,e){const n=[];for(let r=t,i=r.length,o=i-1;i>1;i--,o--){const t=[];for(let n,i=0;i<o;i++)n={x:o*(r[i+1].x-r[i].x),y:o*(r[i+1].y-r[i].y)},e&&(n.z=o*(r[i+1].z-r[i].z)),t.push(n);n.push(t),r=t}return n},between:function(t,e,n){return e<=t&&t<=n||v.approximately(t,e)||v.approximately(t,n)},approximately:function(t,e,r){return n(t-e)<=(r||1e-6)},length:function(t){const e=v.Tvalues.length;let n=0;for(let r,i=0;i<e;i++)r=.5*v.Tvalues[i]+.5,n+=v.Cvalues[i]*v.arcfn(r,t);return.5*n},map:function(t,e,n,r,i){return r+(i-r)*((t-e)/(n-e))},lerp:function(t,e,n){const r={x:e.x+t*(n.x-e.x),y:e.y+t*(n.y-e.y)};return void 0!==e.z&&void 0!==n.z&&(r.z=e.z+t*(n.z-e.z)),r},pointToString:function(t){let e=t.x+"/"+t.y;return void 0!==t.z&&(e+="/"+t.z),e},pointsToString:function(t){return"["+t.map(v.pointToString).join(", ")+"]"},copy:function(t){return JSON.parse(JSON.stringify(t))},angle:function(t,e,n){const r=e.x-t.x,i=e.y-t.y,o=n.x-t.x,c=n.y-t.y;return s(r*c-i*o,r*o+i*c)},round:function(t,e){const n=""+t,r=n.indexOf(".");return parseFloat(n.substring(0,r+1+e))},dist:function(t,e){const n=t.x-e.x,r=t.y-e.y;return c(n*n+r*r)},closest:function(t,e){let n,r,i=a(2,63);return t.forEach((function(t,o){r=v.dist(e,t),r<i&&(i=r,n=o)})),{mdist:i,mpos:n}},abcratio:function(t,e){if(2!==e&&3!==e)return!1;if(void 0===t)t=.5;else if(0===t||1===t)return t;const r=a(t,e)+a(1-t,e);return n((r-1)/r)},projectionratio:function(t,e){if(2!==e&&3!==e)return!1;if(void 0===t)t=.5;else if(0===t||1===t)return t;const n=a(1-t,e);return n/(a(t,e)+n)},lli8:function(t,e,n,r,i,o,s,c){const a=(t-n)*(o-c)-(e-r)*(i-s);return 0!=a&&{x:((t*r-e*n)*(i-s)-(t-n)*(i*c-o*s))/a,y:((t*r-e*n)*(o-c)-(e-r)*(i*c-o*s))/a}},lli4:function(t,e,n,r){const i=t.x,o=t.y,s=e.x,c=e.y,a=n.x,u=n.y,l=r.x,f=r.y;return v.lli8(i,o,s,c,a,u,l,f)},lli:function(t,e){return v.lli4(t,t.c,e,e.c)},makeline:function(t,e){return new w(t.x,t.y,(t.x+e.x)/2,(t.y+e.y)/2,e.x,e.y)},findbbox:function(t){let e=p,n=p,r=y,i=y;return t.forEach((function(t){const o=t.bbox();e>o.x.min&&(e=o.x.min),n>o.y.min&&(n=o.y.min),r<o.x.max&&(r=o.x.max),i<o.y.max&&(i=o.y.max)})),{x:{min:e,mid:(e+r)/2,max:r,size:r-e},y:{min:n,mid:(n+i)/2,max:i,size:i-n}}},shapeintersections:function(t,e,n,r,i){if(!v.bboxoverlap(e,r))return[];const o=[],s=[t.startcap,t.forward,t.back,t.endcap],c=[n.startcap,n.forward,n.back,n.endcap];return s.forEach((function(e){e.virtual||c.forEach((function(r){if(r.virtual)return;const s=e.intersects(r,i);s.length>0&&(s.c1=e,s.c2=r,s.s1=t,s.s2=n,o.push(s))}))})),o},makeshape:function(t,e,n){const r=e.points.length,i=t.points.length,o=v.makeline(e.points[r-1],t.points[0]),s=v.makeline(t.points[i-1],e.points[0]),c={startcap:o,forward:t,back:e,endcap:s,bbox:v.findbbox([o,t,e,s]),intersections:function(t){return v.shapeintersections(c,c.bbox,t,t.bbox,n)}};return c},getminmax:function(t,e,n){if(!n)return{min:0,max:0};let r,i,o=p,s=y;-1===n.indexOf(0)&&(n=[0].concat(n)),-1===n.indexOf(1)&&n.push(1);for(let c=0,a=n.length;c<a;c++)r=n[c],i=t.get(r),i[e]<o&&(o=i[e]),i[e]>s&&(s=i[e]);return{min:o,mid:(o+s)/2,max:s,size:s-o}},align:function(t,e){const n=e.p1.x,o=e.p1.y,c=-s(e.p2.y-o,e.p2.x-n);return t.map((function(t){return{x:(t.x-n)*r(c)-(t.y-o)*i(c),y:(t.x-n)*i(c)+(t.y-o)*r(c)}}))},roots:function(t,e){e=e||{p1:{x:0,y:0},p2:{x:1,y:0}};const n=t.length-1,i=v.align(t,e),s=function(t){return 0<=t&&t<=1};if(2===n){const t=i[0].y,e=i[1].y,n=i[2].y,r=t-2*e+n;if(0!==r){const i=-c(e*e-t*n),o=-t+e;return[-(i+o)/r,-(-i+o)/r].filter(s)}return e!==n&&0===r?[(2*e-n)/(2*e-2*n)].filter(s):[]}const a=i[0].y,l=i[1].y,h=i[2].y;let p=3*l-a-3*h+i[3].y,y=3*a-6*l+3*h,d=-3*a+3*l,x=a;if(v.approximately(p,0)){if(v.approximately(y,0))return v.approximately(d,0)?[]:[-x/d].filter(s);const t=c(d*d-4*y*x),e=2*y;return[(t-d)/e,(-d-t)/e].filter(s)}y/=p,d/=p,x/=p;const b=(3*d-y*y)/3,g=b/3,_=(2*y*y*y-9*y*d+27*x)/27,m=_/2,j=m*m+g*g*g;let z,O,A,w,P;if(j<0){const t=-b/3,e=c(t*t*t),n=-_/(2*e),i=o(n<-1?-1:n>1?1:n),a=2*u(e);return A=a*r(i/3)-y/3,w=a*r((i+f)/3)-y/3,P=a*r((i+2*f)/3)-y/3,[A,w,P].filter(s)}if(0===j)return z=m<0?u(-m):-u(m),A=2*z-y/3,w=-z-y/3,[A,w].filter(s);{const t=c(j);return z=u(-m+t),O=u(m+t),[z-O-y/3].filter(s)}},droots:function(t){if(3===t.length){const e=t[0],n=t[1],r=t[2],i=e-2*n+r;if(0!==i){const t=-c(n*n-e*r),o=-e+n;return[-(t+o)/i,-(-t+o)/i]}return n!==r&&0===i?[(2*n-r)/(2*(n-r))]:[]}if(2===t.length){const e=t[0],n=t[1];return e!==n?[e/(e-n)]:[]}return[]},curvature:function(t,e,r,i,o){let s,u,l,f,h=0,p=0;const y=v.compute(t,e),d=v.compute(t,r),x=y.x*y.x+y.y*y.y;if(i?(s=c(a(y.y*d.z-d.y*y.z,2)+a(y.z*d.x-d.z*y.x,2)+a(y.x*d.y-d.x*y.y,2)),u=a(x+y.z*y.z,1.5)):(s=y.x*d.y-y.y*d.x,u=a(x,1.5)),0===s||0===u)return{k:0,r:0};if(h=s/u,p=u/s,!o){const o=v.curvature(t-.001,e,r,i,!0).k,s=v.curvature(t+.001,e,r,i,!0).k;f=(s-h+(h-o))/2,l=(n(s-h)+n(h-o))/2}return{k:h,r:p,dk:f,adk:l}},inflections:function(t){if(t.length<4)return[];const e=v.align(t,{p1:t[0],p2:t.slice(-1)[0]}),n=e[2].x*e[1].y,r=e[3].x*e[1].y,i=e[1].x*e[2].y,o=18*(-3*n+2*r+3*i-e[3].x*e[2].y),s=18*(3*n-r-3*i),c=18*(i-n);if(v.approximately(o,0)){if(!v.approximately(s,0)){let t=-c/s;if(0<=t&&t<=1)return[t]}return[]}const a=2*o;if(v.approximately(a,0))return[];const u=s*s-4*o*c;if(u<0)return[];const l=Math.sqrt(u);return[(l-s)/a,-(s+l)/a].filter((function(t){return 0<=t&&t<=1}))},bboxoverlap:function(t,e){const r=["x","y"],i=r.length;for(let o,s,c,a,u=0;u<i;u++)if(o=r[u],s=t[o].mid,c=e[o].mid,a=(t[o].size+e[o].size)/2,n(s-c)>=a)return!1;return!0},expandbox:function(t,e){e.x.min<t.x.min&&(t.x.min=e.x.min),e.y.min<t.y.min&&(t.y.min=e.y.min),e.z&&e.z.min<t.z.min&&(t.z.min=e.z.min),e.x.max>t.x.max&&(t.x.max=e.x.max),e.y.max>t.y.max&&(t.y.max=e.y.max),e.z&&e.z.max>t.z.max&&(t.z.max=e.z.max),t.x.mid=(t.x.min+t.x.max)/2,t.y.mid=(t.y.min+t.y.max)/2,t.z&&(t.z.mid=(t.z.min+t.z.max)/2),t.x.size=t.x.max-t.x.min,t.y.size=t.y.max-t.y.min,t.z&&(t.z.size=t.z.max-t.z.min)},pairiteration:function(t,e,n){const r=t.bbox(),i=e.bbox(),o=1e5,s=n||.5;if(r.x.size+r.y.size<s&&i.x.size+i.y.size<s)return[(o*(t._t1+t._t2)/2|0)/o+"/"+(o*(e._t1+e._t2)/2|0)/o];let c=t.split(.5),a=e.split(.5),u=[{left:c.left,right:a.left},{left:c.left,right:a.right},{left:c.right,right:a.right},{left:c.right,right:a.left}];u=u.filter((function(t){return v.bboxoverlap(t.left.bbox(),t.right.bbox())}));let l=[];return 0===u.length||(u.forEach((function(t){l=l.concat(v.pairiteration(t.left,t.right,s))})),l=l.filter((function(t,e){return l.indexOf(t)===e}))),l},getccenter:function(t,e,n){const o=e.x-t.x,c=e.y-t.y,a=n.x-e.x,u=n.y-e.y,l=o*r(h)-c*i(h),p=o*i(h)+c*r(h),y=a*r(h)-u*i(h),d=a*i(h)+u*r(h),x=(t.x+e.x)/2,b=(t.y+e.y)/2,g=(e.x+n.x)/2,_=(e.y+n.y)/2,m=x+l,j=b+p,z=g+y,O=_+d,A=v.lli8(x,b,m,j,g,_,z,O),w=v.dist(A,t);let P,E=s(t.y-A.y,t.x-A.x),I=s(e.y-A.y,e.x-A.x),T=s(n.y-A.y,n.x-A.x);return E<T?((E>I||I>T)&&(E+=f),E>T&&(P=T,T=E,E=P)):T<I&&I<E?(P=T,T=E,E=P):T+=f,A.s=E,A.e=T,A.r=w,A},numberSort:function(t,e){return t-e}};class x{constructor(t){this.curves=[],this._3d=!1,t&&(this.curves=t,this._3d=this.curves[0]._3d)}valueOf(){return this.toString()}toString(){return"["+this.curves.map((function(t){return v.pointsToString(t.points)})).join(", ")+"]"}addCurve(t){this.curves.push(t),this._3d=this._3d||t._3d}length(){return this.curves.map((function(t){return t.length()})).reduce((function(t,e){return t+e}))}curve(t){return this.curves[t]}bbox(){const t=this.curves;for(var e=t[0].bbox(),n=1;n<t.length;n++)v.expandbox(e,t[n].bbox());return e}offset(t){const e=[];return this.curves.forEach((function(n){e.push(...n.offset(t))})),new x(e)}}const{abs:b,min:g,max:_,cos:m,sin:j,acos:z,sqrt:O}=Math,A=Math.PI;class w{constructor(t){let e=t&&t.forEach?t:Array.from(arguments).slice(),n=!1;if("object"==typeof e[0]){n=e.length;const t=[];e.forEach((function(e){["x","y","z"].forEach((function(n){void 0!==e[n]&&t.push(e[n])}))})),e=t}let r=!1;const i=e.length;if(n){if(n>4){if(1!==arguments.length)throw new Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");r=!0}}else if(6!==i&&8!==i&&9!==i&&12!==i&&1!==arguments.length)throw new Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");const o=this._3d=!r&&(9===i||12===i)||t&&t[0]&&void 0!==t[0].z,s=this.points=[];for(let t=0,n=o?3:2;t<i;t+=n){var c={x:e[t],y:e[t+1]};o&&(c.z=e[t+2]),s.push(c)}const a=this.order=s.length-1,u=this.dims=["x","y"];o&&u.push("z"),this.dimlen=u.length;const l=v.align(s,{p1:s[0],p2:s[a]}),f=v.dist(s[0],s[a]);this._linear=l.reduce(((t,e)=>t+b(e.y)),0)<f/50,this._lut=[],this._t1=0,this._t2=1,this.update()}static quadraticFromPoints(t,e,n,r){if(void 0===r&&(r=.5),0===r)return new w(e,e,n);if(1===r)return new w(t,e,e);const i=w.getABC(2,t,e,n,r);return new w(t,i.A,n)}static cubicFromPoints(t,e,n,r,i){void 0===r&&(r=.5);const o=w.getABC(3,t,e,n,r);void 0===i&&(i=v.dist(e,o.C));const s=i*(1-r)/r,c=v.dist(t,n),a=(n.x-t.x)/c,u=(n.y-t.y)/c,l=i*a,f=i*u,h=s*a,p=s*u,y=e.x-l,d=e.y-f,x=e.x+h,b=e.y+p,g=o.A,_=g.x+(y-g.x)/(1-r),m=g.y+(d-g.y)/(1-r),j=g.x+(x-g.x)/r,z=g.y+(b-g.y)/r,O={x:t.x+(_-t.x)/r,y:t.y+(m-t.y)/r},A={x:n.x+(j-n.x)/(1-r),y:n.y+(z-n.y)/(1-r)};return new w(t,O,A,n)}static getUtils(){return v}getUtils(){return w.getUtils()}static get PolyBezier(){return x}valueOf(){return this.toString()}toString(){return v.pointsToString(this.points)}toSVG(){if(this._3d)return!1;const t=this.points,e=["M",t[0].x,t[0].y,2===this.order?"Q":"C"];for(let n=1,r=t.length;n<r;n++)e.push(t[n].x),e.push(t[n].y);return e.join(" ")}setRatios(t){if(t.length!==this.points.length)throw new Error("incorrect number of ratio values");this.ratios=t,this._lut=[]}verify(){const t=this.coordDigest();t!==this._print&&(this._print=t,this.update())}coordDigest(){return this.points.map((function(t,e){return""+e+t.x+t.y+(t.z?t.z:0)})).join("")}update(){this._lut=[],this.dpoints=v.derive(this.points,this._3d),this.computedirection()}computedirection(){const t=this.points,e=v.angle(t[0],t[this.order],t[1]);this.clockwise=e>0}length(){return v.length(this.derivative.bind(this))}static getABC(t=2,e,n,r,i=.5){const o=v.projectionratio(i,t),s=1-o,c={x:o*e.x+s*r.x,y:o*e.y+s*r.y},a=v.abcratio(i,t);return{A:{x:n.x+(n.x-c.x)/a,y:n.y+(n.y-c.y)/a},B:n,C:c,S:e,E:r}}getABC(t,e){e=e||this.get(t);let n=this.points[0],r=this.points[this.order];return w.getABC(this.order,n,e,r,t)}getLUT(t){if(this.verify(),t=t||100,this._lut.length===t+1)return this._lut;this._lut=[],t++,this._lut=[];for(let e,n,r=0;r<t;r++)n=r/(t-1),e=this.compute(n),e.t=n,this._lut.push(e);return this._lut}on(e,n){n=n||5;const r=this.getLUT(),i=[];for(let t,o=0,s=0;o<r.length;o++)t=r[o],v.dist(t,e)<n&&(i.push(t),s+=o/r.length);return!!i.length&&(t/=i.length)}project(t){const e=this.getLUT(),n=e.length-1,r=v.closest(e,t),i=r.mpos,o=(i-1)/n,s=(i+1)/n,c=.1/n;let a,u=r.mdist,l=o,f=l;u+=1;for(let e;l<s+c;l+=c)a=this.compute(l),e=v.dist(t,a),e<u&&(u=e,f=l);return f=f<0?0:f>1?1:f,a=this.compute(f),a.t=f,a.d=u,a}get(t){return this.compute(t)}point(t){return this.points[t]}compute(t){return this.ratios?v.computeWithRatios(t,this.points,this.ratios,this._3d):v.compute(t,this.points,this._3d,this.ratios)}raise(){const t=this.points,e=[t[0]],n=t.length;for(let r,i,o=1;o<n;o++)r=t[o],i=t[o-1],e[o]={x:(n-o)/n*r.x+o/n*i.x,y:(n-o)/n*r.y+o/n*i.y};return e[n]=t[n-1],new w(e)}derivative(t){return v.compute(t,this.dpoints[0],this._3d)}dderivative(t){return v.compute(t,this.dpoints[1],this._3d)}align(){let t=this.points;return new w(v.align(t,{p1:t[0],p2:t[t.length-1]}))}curvature(t){return v.curvature(t,this.dpoints[0],this.dpoints[1],this._3d)}inflections(){return v.inflections(this.points)}normal(t){return this._3d?this.__normal3(t):this.__normal2(t)}__normal2(t){const e=this.derivative(t),n=O(e.x*e.x+e.y*e.y);return{t:t,x:-e.y/n,y:e.x/n}}__normal3(t){const e=this.derivative(t),n=this.derivative(t+.01),r=O(e.x*e.x+e.y*e.y+e.z*e.z),i=O(n.x*n.x+n.y*n.y+n.z*n.z);e.x/=r,e.y/=r,e.z/=r,n.x/=i,n.y/=i,n.z/=i;const o={x:n.y*e.z-n.z*e.y,y:n.z*e.x-n.x*e.z,z:n.x*e.y-n.y*e.x},s=O(o.x*o.x+o.y*o.y+o.z*o.z);o.x/=s,o.y/=s,o.z/=s;const c=[o.x*o.x,o.x*o.y-o.z,o.x*o.z+o.y,o.x*o.y+o.z,o.y*o.y,o.y*o.z-o.x,o.x*o.z-o.y,o.y*o.z+o.x,o.z*o.z];return{t:t,x:c[0]*e.x+c[1]*e.y+c[2]*e.z,y:c[3]*e.x+c[4]*e.y+c[5]*e.z,z:c[6]*e.x+c[7]*e.y+c[8]*e.z}}hull(t){let e=this.points,n=[],r=[],i=0;for(r[i++]=e[0],r[i++]=e[1],r[i++]=e[2],3===this.order&&(r[i++]=e[3]);e.length>1;){n=[];for(let o,s=0,c=e.length-1;s<c;s++)o=v.lerp(t,e[s],e[s+1]),r[i++]=o,n.push(o);e=n}return r}split(t,e){if(0===t&&e)return this.split(e).left;if(1===e)return this.split(t).right;const n=this.hull(t),r={left:2===this.order?new w([n[0],n[3],n[5]]):new w([n[0],n[4],n[7],n[9]]),right:2===this.order?new w([n[5],n[4],n[2]]):new w([n[9],n[8],n[6],n[3]]),span:n};return r.left._t1=v.map(0,0,1,this._t1,this._t2),r.left._t2=v.map(t,0,1,this._t1,this._t2),r.right._t1=v.map(t,0,1,this._t1,this._t2),r.right._t2=v.map(1,0,1,this._t1,this._t2),e?(e=v.map(e,t,1,0,1),r.right.split(e).left):r}extrema(){const t={};let e=[];return this.dims.forEach(function(n){let r=function(t){return t[n]},i=this.dpoints[0].map(r);t[n]=v.droots(i),3===this.order&&(i=this.dpoints[1].map(r),t[n]=t[n].concat(v.droots(i))),t[n]=t[n].filter((function(t){return t>=0&&t<=1})),e=e.concat(t[n].sort(v.numberSort))}.bind(this)),t.values=e.sort(v.numberSort).filter((function(t,n){return e.indexOf(t)===n})),t}bbox(){const t=this.extrema(),e={};return this.dims.forEach(function(n){e[n]=v.getminmax(this,n,t[n])}.bind(this)),e}overlaps(t){const e=this.bbox(),n=t.bbox();return v.bboxoverlap(e,n)}offset(t,e){if(void 0!==e){const n=this.get(t),r=this.normal(t),i={c:n,n:r,x:n.x+r.x*e,y:n.y+r.y*e};return this._3d&&(i.z=n.z+r.z*e),i}if(this._linear){const e=this.normal(0),n=this.points.map((function(n){const r={x:n.x+t*e.x,y:n.y+t*e.y};return n.z&&e.z&&(r.z=n.z+t*e.z),r}));return[new w(n)]}return this.reduce().map((function(e){return e._linear?e.offset(t)[0]:e.scale(t)}))}simple(){if(3===this.order){const t=v.angle(this.points[0],this.points[3],this.points[1]),e=v.angle(this.points[0],this.points[3],this.points[2]);if(t>0&&e<0||t<0&&e>0)return!1}const t=this.normal(0),e=this.normal(1);let n=t.x*e.x+t.y*e.y;return this._3d&&(n+=t.z*e.z),b(z(n))<A/3}reduce(){let t,e,n=0,r=0,i=.01,o=[],s=[],c=this.extrema().values;for(-1===c.indexOf(0)&&(c=[0].concat(c)),-1===c.indexOf(1)&&c.push(1),n=c[0],t=1;t<c.length;t++)r=c[t],e=this.split(n,r),e._t1=n,e._t2=r,o.push(e),n=r;return o.forEach((function(t){for(n=0,r=0;r<=1;)for(r=n+i;r<=1.01;r+=i)if(e=t.split(n,r),!e.simple()){if(r-=i,b(n-r)<i)return[];e=t.split(n,r),e._t1=v.map(n,0,1,t._t1,t._t2),e._t2=v.map(r,0,1,t._t1,t._t2),s.push(e),n=r;break}n<1&&(e=t.split(n,1),e._t1=v.map(n,0,1,t._t1,t._t2),e._t2=t._t2,s.push(e))})),s}translate(t,e,n){n="number"==typeof n?n:e;const r=this.order;let i=this.points.map(((t,i)=>(1-i/r)*e+i/r*n));return new w(this.points.map(((e,n)=>({x:e.x+t.x*i[n],y:e.y+t.y*i[n]}))))}scale(t){const e=this.order;let n=!1;if("function"==typeof t&&(n=t),n&&2===e)return this.raise().scale(n);const r=this.clockwise,i=this.points;if(this._linear)return this.translate(this.normal(0),n?n(0):t,n?n(1):t);const o=n?n(0):t,s=n?n(1):t,c=[this.offset(0,10),this.offset(1,10)],a=[],u=v.lli4(c[0],c[0].c,c[1],c[1].c);if(!u)throw new Error("cannot scale this curve. Try reducing it first.");return[0,1].forEach((function(t){const n=a[t*e]=v.copy(i[t*e]);n.x+=(t?s:o)*c[t].n.x,n.y+=(t?s:o)*c[t].n.y})),n?([0,1].forEach((function(o){if(2!==e||!o){var s=i[o+1],c={x:s.x-u.x,y:s.y-u.y},l=n?n((o+1)/e):t;n&&!r&&(l=-l);var f=O(c.x*c.x+c.y*c.y);c.x/=f,c.y/=f,a[o+1]={x:s.x+l*c.x,y:s.y+l*c.y}}})),new w(a)):([0,1].forEach((t=>{if(2===e&&t)return;const n=a[t*e],r=this.derivative(t),o={x:n.x+r.x,y:n.y+r.y};a[t+1]=v.lli4(n,o,u,i[t+1])})),new w(a))}outline(t,e,n,r){if(e=void 0===e?t:e,this._linear){const i=this.normal(0),o=this.points[0],s=this.points[this.points.length-1];let c,a,u;void 0===n&&(n=t,r=e),c={x:o.x+i.x*t,y:o.y+i.y*t},u={x:s.x+i.x*n,y:s.y+i.y*n},a={x:(c.x+u.x)/2,y:(c.y+u.y)/2};const l=[c,a,u];c={x:o.x-i.x*e,y:o.y-i.y*e},u={x:s.x-i.x*r,y:s.y-i.y*r},a={x:(c.x+u.x)/2,y:(c.y+u.y)/2};const f=[u,a,c],h=v.makeline(f[2],l[0]),p=v.makeline(l[2],f[0]),y=[h,new w(l),p,new w(f)];return new x(y)}const i=this.reduce(),o=i.length,s=[];let c,a=[],u=0,l=this.length();const f=void 0!==n&&void 0!==r;function h(t,e,n,r,i){return function(o){const s=r/n,c=(r+i)/n,a=e-t;return v.map(o,0,1,t+s*a,t+c*a)}}i.forEach((function(i){const o=i.length();f?(s.push(i.scale(h(t,n,l,u,o))),a.push(i.scale(h(-e,-r,l,u,o)))):(s.push(i.scale(t)),a.push(i.scale(-e))),u+=o})),a=a.map((function(t){return c=t.points,c[3]?t.points=[c[3],c[2],c[1],c[0]]:t.points=[c[2],c[1],c[0]],t})).reverse();const p=s[0].points[0],y=s[o-1].points[s[o-1].points.length-1],d=a[o-1].points[a[o-1].points.length-1],b=a[0].points[0],g=v.makeline(d,p),_=v.makeline(y,b),m=[g].concat(s).concat([_]).concat(a);return new x(m)}outlineshapes(t,e,n){e=e||t;const r=this.outline(t,e).curves,i=[];for(let t=1,e=r.length;t<e/2;t++){const o=v.makeshape(r[t],r[e-t],n);o.startcap.virtual=t>1,o.endcap.virtual=t<e/2-1,i.push(o)}return i}intersects(t,e){return t?t.p1&&t.p2?this.lineIntersects(t):(t instanceof w&&(t=t.reduce()),this.curveintersects(this.reduce(),t,e)):this.selfintersects(e)}lineIntersects(t){const e=g(t.p1.x,t.p2.x),n=g(t.p1.y,t.p2.y),r=_(t.p1.x,t.p2.x),i=_(t.p1.y,t.p2.y);return v.roots(this.points,t).filter((t=>{var o=this.get(t);return v.between(o.x,e,r)&&v.between(o.y,n,i)}))}selfintersects(t){const e=this.reduce(),n=e.length-2,r=[];for(let i,o,s,c=0;c<n;c++)o=e.slice(c,c+1),s=e.slice(c+2),i=this.curveintersects(o,s,t),r.push(...i);return r}curveintersects(t,e,n){const r=[];t.forEach((function(t){e.forEach((function(e){t.overlaps(e)&&r.push({left:t,right:e})}))}));let i=[];return r.forEach((function(t){const e=v.pairiteration(t.left,t.right,n);e.length>0&&(i=i.concat(e))})),i}arcs(t){return t=t||.5,this._iterate(t,[])}_error(t,e,n,r){const i=(r-n)/4,o=this.get(n+i),s=this.get(r-i),c=v.dist(t,e),a=v.dist(t,o),u=v.dist(t,s);return b(a-c)+b(u-c)}_iterate(t,e){let n,r=0,i=1;do{n=0,i=1;let o,s,c,a,u,l=this.get(r),f=!1,h=!1,p=i,y=1;do{if(h=f,a=c,p=(r+i)/2,o=this.get(p),s=this.get(i),c=v.getccenter(l,o,s),c.interval={start:r,end:i},f=this._error(c,l,r,i)<=t,u=h&&!f,u||(y=i),f){if(i>=1){if(c.interval.end=y=1,a=c,i>1){let t={x:c.x+c.r*m(c.e),y:c.y+c.r*j(c.e)};c.e+=v.angle({x:c.x,y:c.y},t,this.get(1))}break}i+=(i-r)/2}else i=p}while(!u&&n++<100);if(n>=100)break;a=a||c,e.push(a),r=y}while(i<1);return e}}function P(t,e){return t===e||t!=t&&e!=e}function E(t,e){for(var n=t.length;n--;)if(P(t[n][0],e))return n;return-1}var I=Array.prototype.splice;function T(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}T.prototype.clear=function(){this.__data__=[],this.size=0},T.prototype.delete=function(t){var e=this.__data__,n=E(e,t);return!(n<0)&&(n==e.length-1?e.pop():I.call(e,n,1),--this.size,!0)},T.prototype.get=function(t){var e=this.__data__,n=E(e,t);return n<0?void 0:e[n][1]},T.prototype.has=function(t){return E(this.__data__,t)>-1},T.prototype.set=function(t,e){var n=this.__data__,r=E(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this};var S="object"==typeof global&&global&&global.Object===Object&&global,C="object"==typeof self&&self&&self.Object===Object&&self,R=S||C||Function("return this")(),U=R.Symbol,k=Object.prototype,M=k.hasOwnProperty,B=k.toString,N=U?U.toStringTag:void 0;var L=Object.prototype.toString;var D="[object Null]",V="[object Undefined]",F=U?U.toStringTag:void 0;function H(t){return null==t?void 0===t?V:D:F&&F in Object(t)?function(t){var e=M.call(t,N),n=t[N];try{t[N]=void 0;var r=!0}catch(t){}var i=B.call(t);return r&&(e?t[N]=n:delete t[N]),i}(t):function(t){return L.call(t)}(t)}function Q(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}var J="[object AsyncFunction]",$="[object Function]",q="[object GeneratorFunction]",W="[object Proxy]";function G(t){if(!Q(t))return!1;var e=H(t);return e==$||e==q||e==J||e==W}var Z,X=R["__core-js_shared__"],Y=(Z=/[^.]+$/.exec(X&&X.keys&&X.keys.IE_PROTO||""))?"Symbol(src)_1."+Z:"";var K=Function.prototype.toString;function tt(t){if(null!=t){try{return K.call(t)}catch(t){}try{return t+""}catch(t){}}return""}var et=/^\[object .+?Constructor\]$/,nt=Function.prototype,rt=Object.prototype,it=nt.toString,ot=rt.hasOwnProperty,st=RegExp("^"+it.call(ot).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function ct(t){return!(!Q(t)||(e=t,Y&&Y in e))&&(G(t)?st:et).test(tt(t));var e}function at(t,e){var n=function(t,e){return null==t?void 0:t[e]}(t,e);return ct(n)?n:void 0}var ut=at(R,"Map"),lt=at(Object,"create");var ft=Object.prototype.hasOwnProperty;var ht=Object.prototype.hasOwnProperty;function pt(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function yt(t,e){var n,r,i=t.__data__;return("string"==(r=typeof(n=e))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==n:null===n)?i["string"==typeof e?"string":"hash"]:i.map}function dt(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}pt.prototype.clear=function(){this.__data__=lt?lt(null):{},this.size=0},pt.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},pt.prototype.get=function(t){var e=this.__data__;if(lt){var n=e[t];return"__lodash_hash_undefined__"===n?void 0:n}return ft.call(e,t)?e[t]:void 0},pt.prototype.has=function(t){var e=this.__data__;return lt?void 0!==e[t]:ht.call(e,t)},pt.prototype.set=function(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=lt&&void 0===e?"__lodash_hash_undefined__":e,this},dt.prototype.clear=function(){this.size=0,this.__data__={hash:new pt,map:new(ut||T),string:new pt}},dt.prototype.delete=function(t){var e=yt(this,t).delete(t);return this.size-=e?1:0,e},dt.prototype.get=function(t){return yt(this,t).get(t)},dt.prototype.has=function(t){return yt(this,t).has(t)},dt.prototype.set=function(t,e){var n=yt(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this};function vt(t){var e=this.__data__=new T(t);this.size=e.size}vt.prototype.clear=function(){this.__data__=new T,this.size=0},vt.prototype.delete=function(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n},vt.prototype.get=function(t){return this.__data__.get(t)},vt.prototype.has=function(t){return this.__data__.has(t)},vt.prototype.set=function(t,e){var n=this.__data__;if(n instanceof T){var r=n.__data__;if(!ut||r.length<199)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new dt(r)}return n.set(t,e),this.size=n.size,this};function xt(t){var e=-1,n=null==t?0:t.length;for(this.__data__=new dt;++e<n;)this.add(t[e])}function bt(t,e){for(var n=-1,r=null==t?0:t.length;++n<r;)if(e(t[n],n,t))return!0;return!1}xt.prototype.add=xt.prototype.push=function(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this},xt.prototype.has=function(t){return this.__data__.has(t)};var gt=1,_t=2;function mt(t,e,n,r,i,o){var s=n&gt,c=t.length,a=e.length;if(c!=a&&!(s&&a>c))return!1;var u=o.get(t),l=o.get(e);if(u&&l)return u==e&&l==t;var f=-1,h=!0,p=n&_t?new xt:void 0;for(o.set(t,e),o.set(e,t);++f<c;){var y=t[f],d=e[f];if(r)var v=s?r(d,y,f,e,t,o):r(y,d,f,t,e,o);if(void 0!==v){if(v)continue;h=!1;break}if(p){if(!bt(e,(function(t,e){if(s=e,!p.has(s)&&(y===t||i(y,t,n,r,o)))return p.push(e);var s}))){h=!1;break}}else if(y!==d&&!i(y,d,n,r,o)){h=!1;break}}return o.delete(t),o.delete(e),h}var jt=R.Uint8Array;function zt(t){var e=-1,n=Array(t.size);return t.forEach((function(t,r){n[++e]=[r,t]})),n}function Ot(t){var e=-1,n=Array(t.size);return t.forEach((function(t){n[++e]=t})),n}var At=1,wt=2,Pt="[object Boolean]",Et="[object Date]",It="[object Error]",Tt="[object Map]",St="[object Number]",Ct="[object RegExp]",Rt="[object Set]",Ut="[object String]",kt="[object Symbol]",Mt="[object ArrayBuffer]",Bt="[object DataView]",Nt=U?U.prototype:void 0,Lt=Nt?Nt.valueOf:void 0;function Dt(t,e){for(var n=-1,r=e.length,i=t.length;++n<r;)t[i+n]=e[n];return t}var Vt=Array.isArray;function Ft(t,e,n){var r=e(t);return Vt(t)?r:Dt(r,n(t))}function Ht(){return[]}var Qt=Object.prototype.propertyIsEnumerable,Jt=Object.getOwnPropertySymbols,$t=Jt?function(t){return null==t?[]:(t=Object(t),function(t,e){for(var n=-1,r=null==t?0:t.length,i=0,o=[];++n<r;){var s=t[n];e(s,n,t)&&(o[i++]=s)}return o}(Jt(t),(function(e){return Qt.call(t,e)})))}:Ht;function qt(t){return null!=t&&"object"==typeof t}function Wt(t){return qt(t)&&"[object Arguments]"==H(t)}var Gt=Object.prototype,Zt=Gt.hasOwnProperty,Xt=Gt.propertyIsEnumerable,Yt=Wt(function(){return arguments}())?Wt:function(t){return qt(t)&&Zt.call(t,"callee")&&!Xt.call(t,"callee")};var Kt="object"==typeof exports&&exports&&!exports.nodeType&&exports,te=Kt&&"object"==typeof module&&module&&!module.nodeType&&module,ee=te&&te.exports===Kt?R.Buffer:void 0,ne=(ee?ee.isBuffer:void 0)||function(){return!1},re=9007199254740991,ie=/^(?:0|[1-9]\d*)$/;function oe(t,e){var n=typeof t;return!!(e=null==e?re:e)&&("number"==n||"symbol"!=n&&ie.test(t))&&t>-1&&t%1==0&&t<e}var se=9007199254740991;function ce(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=se}var ae={};function ue(t){return function(e){return t(e)}}ae["[object Float32Array]"]=ae["[object Float64Array]"]=ae["[object Int8Array]"]=ae["[object Int16Array]"]=ae["[object Int32Array]"]=ae["[object Uint8Array]"]=ae["[object Uint8ClampedArray]"]=ae["[object Uint16Array]"]=ae["[object Uint32Array]"]=!0,ae["[object Arguments]"]=ae["[object Array]"]=ae["[object ArrayBuffer]"]=ae["[object Boolean]"]=ae["[object DataView]"]=ae["[object Date]"]=ae["[object Error]"]=ae["[object Function]"]=ae["[object Map]"]=ae["[object Number]"]=ae["[object Object]"]=ae["[object RegExp]"]=ae["[object Set]"]=ae["[object String]"]=ae["[object WeakMap]"]=!1;var le="object"==typeof exports&&exports&&!exports.nodeType&&exports,fe=le&&"object"==typeof module&&module&&!module.nodeType&&module,he=fe&&fe.exports===le&&S.process,pe=function(){try{var t=fe&&fe.require&&fe.require("util").types;return t||he&&he.binding&&he.binding("util")}catch(t){}}(),ye=pe&&pe.isTypedArray,de=ye?ue(ye):function(t){return qt(t)&&ce(t.length)&&!!ae[H(t)]},ve=Object.prototype.hasOwnProperty;function xe(t,e){var n=Vt(t),r=!n&&Yt(t),i=!n&&!r&&ne(t),o=!n&&!r&&!i&&de(t),s=n||r||i||o,c=s?function(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}(t.length,String):[],a=c.length;for(var u in t)!e&&!ve.call(t,u)||s&&("length"==u||i&&("offset"==u||"parent"==u)||o&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||oe(u,a))||c.push(u);return c}var be=Object.prototype;function ge(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||be)}function _e(t,e){return function(n){return t(e(n))}}var me=_e(Object.keys,Object),je=Object.prototype.hasOwnProperty;function ze(t){return null!=t&&ce(t.length)&&!G(t)}function Oe(t){return ze(t)?xe(t):function(t){if(!ge(t))return me(t);var e=[];for(var n in Object(t))je.call(t,n)&&"constructor"!=n&&e.push(n);return e}(t)}function Ae(t){return Ft(t,Oe,$t)}var we=1,Pe=Object.prototype.hasOwnProperty;var Ee=at(R,"DataView"),Ie=at(R,"Promise"),Te=at(R,"Set"),Se=at(R,"WeakMap"),Ce="[object Map]",Re="[object Promise]",Ue="[object Set]",ke="[object WeakMap]",Me="[object DataView]",Be=tt(Ee),Ne=tt(ut),Le=tt(Ie),De=tt(Te),Ve=tt(Se),Fe=H;(Ee&&Fe(new Ee(new ArrayBuffer(1)))!=Me||ut&&Fe(new ut)!=Ce||Ie&&Fe(Ie.resolve())!=Re||Te&&Fe(new Te)!=Ue||Se&&Fe(new Se)!=ke)&&(Fe=function(t){var e=H(t),n="[object Object]"==e?t.constructor:void 0,r=n?tt(n):"";if(r)switch(r){case Be:return Me;case Ne:return Ce;case Le:return Re;case De:return Ue;case Ve:return ke}return e});var He=Fe,Qe=1,Je="[object Arguments]",$e="[object Array]",qe="[object Object]",We=Object.prototype.hasOwnProperty;function Ge(t,e,n,r,i,o){var s=Vt(t),c=Vt(e),a=s?$e:He(t),u=c?$e:He(e),l=(a=a==Je?qe:a)==qe,f=(u=u==Je?qe:u)==qe,h=a==u;if(h&&ne(t)){if(!ne(e))return!1;s=!0,l=!1}if(h&&!l)return o||(o=new vt),s||de(t)?mt(t,e,n,r,i,o):function(t,e,n,r,i,o,s){switch(n){case Bt:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case Mt:return!(t.byteLength!=e.byteLength||!o(new jt(t),new jt(e)));case Pt:case Et:case St:return P(+t,+e);case It:return t.name==e.name&&t.message==e.message;case Ct:case Ut:return t==e+"";case Tt:var c=zt;case Rt:var a=r&At;if(c||(c=Ot),t.size!=e.size&&!a)return!1;var u=s.get(t);if(u)return u==e;r|=wt,s.set(t,e);var l=mt(c(t),c(e),r,i,o,s);return s.delete(t),l;case kt:if(Lt)return Lt.call(t)==Lt.call(e)}return!1}(t,e,a,n,r,i,o);if(!(n&Qe)){var p=l&&We.call(t,"__wrapped__"),y=f&&We.call(e,"__wrapped__");if(p||y){var d=p?t.value():t,v=y?e.value():e;return o||(o=new vt),i(d,v,n,r,o)}}return!!h&&(o||(o=new vt),function(t,e,n,r,i,o){var s=n&we,c=Ae(t),a=c.length;if(a!=Ae(e).length&&!s)return!1;for(var u=a;u--;){var l=c[u];if(!(s?l in e:Pe.call(e,l)))return!1}var f=o.get(t),h=o.get(e);if(f&&h)return f==e&&h==t;var p=!0;o.set(t,e),o.set(e,t);for(var y=s;++u<a;){var d=t[l=c[u]],v=e[l];if(r)var x=s?r(v,d,l,e,t,o):r(d,v,l,t,e,o);if(!(void 0===x?d===v||i(d,v,n,r,o):x)){p=!1;break}y||(y="constructor"==l)}if(p&&!y){var b=t.constructor,g=e.constructor;b==g||!("constructor"in t)||!("constructor"in e)||"function"==typeof b&&b instanceof b&&"function"==typeof g&&g instanceof g||(p=!1)}return o.delete(t),o.delete(e),p}(t,e,n,r,i,o))}function Ze(t,e,n,r,i){return t===e||(null==t||null==e||!qt(t)&&!qt(e)?t!=t&&e!=e:Ge(t,e,n,r,Ze,i))}function Xe(t,e){return Ze(t,e)}var Ye=function(){try{var t=at(Object,"defineProperty");return t({},"",{}),t}catch(t){}}();function Ke(t,e,n){"__proto__"==e&&Ye?Ye(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}var tn=Object.prototype.hasOwnProperty;function en(t,e,n){var r=t[e];tn.call(t,e)&&P(r,n)&&(void 0!==n||e in t)||Ke(t,e,n)}function nn(t,e,n,r){var i=!n;n||(n={});for(var o=-1,s=e.length;++o<s;){var c=e[o],a=r?r(n[c],t[c],c,n,t):void 0;void 0===a&&(a=t[c]),i?Ke(n,c,a):en(n,c,a)}return n}var rn=Object.prototype.hasOwnProperty;function on(t){if(!Q(t))return function(t){var e=[];if(null!=t)for(var n in Object(t))e.push(n);return e}(t);var e=ge(t),n=[];for(var r in t)("constructor"!=r||!e&&rn.call(t,r))&&n.push(r);return n}function sn(t){return ze(t)?xe(t,!0):on(t)}var cn="object"==typeof exports&&exports&&!exports.nodeType&&exports,an=cn&&"object"==typeof module&&module&&!module.nodeType&&module,un=an&&an.exports===cn?R.Buffer:void 0,ln=un?un.allocUnsafe:void 0;var fn=_e(Object.getPrototypeOf,Object),hn=Object.getOwnPropertySymbols?function(t){for(var e=[];t;)Dt(e,$t(t)),t=fn(t);return e}:Ht;function pn(t){return Ft(t,sn,hn)}var yn=Object.prototype.hasOwnProperty;function dn(t){var e=new t.constructor(t.byteLength);return new jt(e).set(new jt(t)),e}var vn=/\w*$/;var xn=U?U.prototype:void 0,bn=xn?xn.valueOf:void 0;var gn="[object Boolean]",_n="[object Date]",mn="[object Map]",jn="[object Number]",zn="[object RegExp]",On="[object Set]",An="[object String]",wn="[object Symbol]",Pn="[object ArrayBuffer]",En="[object DataView]",In="[object Float32Array]",Tn="[object Float64Array]",Sn="[object Int8Array]",Cn="[object Int16Array]",Rn="[object Int32Array]",Un="[object Uint8Array]",kn="[object Uint8ClampedArray]",Mn="[object Uint16Array]",Bn="[object Uint32Array]";function Nn(t,e,n){var r,i,o,s=t.constructor;switch(e){case Pn:return dn(t);case gn:case _n:return new s(+t);case En:return function(t,e){var n=e?dn(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}(t,n);case In:case Tn:case Sn:case Cn:case Rn:case Un:case kn:case Mn:case Bn:return function(t,e){var n=e?dn(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)}(t,n);case mn:return new s;case jn:case An:return new s(t);case zn:return(o=new(i=t).constructor(i.source,vn.exec(i))).lastIndex=i.lastIndex,o;case On:return new s;case wn:return r=t,bn?Object(bn.call(r)):{}}}var Ln=Object.create,Dn=function(){function t(){}return function(e){if(!Q(e))return{};if(Ln)return Ln(e);t.prototype=e;var n=new t;return t.prototype=void 0,n}}();var Vn=pe&&pe.isMap,Fn=Vn?ue(Vn):function(t){return qt(t)&&"[object Map]"==He(t)};var Hn=pe&&pe.isSet,Qn=Hn?ue(Hn):function(t){return qt(t)&&"[object Set]"==He(t)},Jn=1,$n=2,qn=4,Wn="[object Arguments]",Gn="[object Function]",Zn="[object GeneratorFunction]",Xn="[object Object]",Yn={};function Kn(t,e,n,r,i,o){var s,c=e&Jn,a=e&$n,u=e&qn;if(n&&(s=i?n(t,r,i,o):n(t)),void 0!==s)return s;if(!Q(t))return t;var l=Vt(t);if(l){if(s=function(t){var e=t.length,n=new t.constructor(e);return e&&"string"==typeof t[0]&&yn.call(t,"index")&&(n.index=t.index,n.input=t.input),n}(t),!c)return function(t,e){var n=-1,r=t.length;for(e||(e=Array(r));++n<r;)e[n]=t[n];return e}(t,s)}else{var f=He(t),h=f==Gn||f==Zn;if(ne(t))return function(t,e){if(e)return t.slice();var n=t.length,r=ln?ln(n):new t.constructor(n);return t.copy(r),r}(t,c);if(f==Xn||f==Wn||h&&!i){if(s=a||h?{}:function(t){return"function"!=typeof t.constructor||ge(t)?{}:Dn(fn(t))}(t),!c)return a?function(t,e){return nn(t,hn(t),e)}(t,function(t,e){return t&&nn(e,sn(e),t)}(s,t)):function(t,e){return nn(t,$t(t),e)}(t,function(t,e){return t&&nn(e,Oe(e),t)}(s,t))}else{if(!Yn[f])return i?t:{};s=Nn(t,f,c)}}o||(o=new vt);var p=o.get(t);if(p)return p;o.set(t,s),Qn(t)?t.forEach((function(r){s.add(Kn(r,e,n,r,t,o))})):Fn(t)&&t.forEach((function(r,i){s.set(i,Kn(r,e,n,i,t,o))}));var y=l?void 0:(u?a?pn:Ae:a?sn:Oe)(t);return function(t,e){for(var n=-1,r=null==t?0:t.length;++n<r&&!1!==e(t[n],n,t););}(y||t,(function(r,i){y&&(r=t[i=r]),en(s,i,Kn(r,e,n,i,t,o))})),s}Yn[Wn]=Yn["[object Array]"]=Yn["[object ArrayBuffer]"]=Yn["[object DataView]"]=Yn["[object Boolean]"]=Yn["[object Date]"]=Yn["[object Float32Array]"]=Yn["[object Float64Array]"]=Yn["[object Int8Array]"]=Yn["[object Int16Array]"]=Yn["[object Int32Array]"]=Yn["[object Map]"]=Yn["[object Number]"]=Yn[Xn]=Yn["[object RegExp]"]=Yn["[object Set]"]=Yn["[object String]"]=Yn["[object Symbol]"]=Yn["[object Uint8Array]"]=Yn["[object Uint8ClampedArray]"]=Yn["[object Uint16Array]"]=Yn["[object Uint32Array]"]=!0,Yn["[object Error]"]=Yn[Gn]=Yn["[object WeakMap]"]=!1;function tr(t){return Kn(t,5)}function er(t){return t}var nr=Math.max;var rr=Ye?function(t,e){return Ye(t,"toString",{configurable:!0,enumerable:!1,value:(n=e,function(){return n}),writable:!0});var n}:er,ir=rr,or=Date.now;var sr,cr,ar,ur=(sr=ir,cr=0,ar=0,function(){var t=or(),e=16-(t-ar);if(ar=t,e>0){if(++cr>=800)return arguments[0]}else cr=0;return sr.apply(void 0,arguments)});var lr=Object.prototype,fr=lr.hasOwnProperty,hr=function(t,e){return ur(function(t,e,n){return e=nr(void 0===e?t.length-1:e,0),function(){for(var r=arguments,i=-1,o=nr(r.length-e,0),s=Array(o);++i<o;)s[i]=r[e+i];i=-1;for(var c=Array(e+1);++i<e;)c[i]=r[i];return c[e]=n(s),function(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}(t,this,c)}}(t,e,er),t+"")}((function(t,e){t=Object(t);var n=-1,r=e.length,i=r>2?e[2]:void 0;for(i&&function(t,e,n){if(!Q(n))return!1;var r=typeof e;return!!("number"==r?ze(n)&&oe(e,n.length):"string"==r&&e in n)&&P(n[e],t)}(e[0],e[1],i)&&(r=1);++n<r;)for(var o=e[n],s=sn(o),c=-1,a=s.length;++c<a;){var u=s[c],l=t[u];(void 0===l||P(l,lr[u])&&!fr.call(t,u))&&(t[u]=o[u])}return t})),pr=/\s/;var yr=/^\s+/;function dr(t){return t?t.slice(0,function(t){for(var e=t.length;e--&&pr.test(t.charAt(e)););return e}(t)+1).replace(yr,""):t}var vr="[object Symbol]";function xr(t){return"symbol"==typeof t||qt(t)&&H(t)==vr}var br=NaN,gr=/^[-+]0x[0-9a-f]+$/i,_r=/^0b[01]+$/i,mr=/^0o[0-7]+$/i,jr=parseInt;function zr(t){if("number"==typeof t)return t;if(xr(t))return br;if(Q(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=Q(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=dr(t);var n=_r.test(t);return n||mr.test(t)?jr(t.slice(2),n?2:8):gr.test(t)?br:+t}var Or=1/0,Ar=17976931348623157e292;function wr(t){var e=function(t){return t?(t=zr(t))===Or||t===-Or?(t<0?-1:1)*Ar:t==t?t:0:0===t?t:0}(t),n=e%1;return e==e?n?e-n:e:0}var Pr=1/0,Er=U?U.prototype:void 0,Ir=Er?Er.toString:void 0;function Tr(t){if("string"==typeof t)return t;if(Vt(t))return function(t,e){for(var n=-1,r=null==t?0:t.length,i=Array(r);++n<r;)i[n]=e(t[n],n,t);return i}(t,Tr)+"";if(xr(t))return Ir?Ir.call(t):"";var e=t+"";return"0"==e&&1/t==-Pr?"-0":e}function Sr(t){return null==t?"":Tr(t)}var Cr=R.isFinite,Rr=Math.min;var Ur=function(t){var e=Math[t];return function(t,n){if(t=zr(t),(n=null==n?0:Rr(wr(n),292))&&Cr(t)){var r=(Sr(t)+"e").split("e");return+((r=(Sr(e(r[0]+"e"+(+r[1]+n)))+"e").split("e"))[0]+"e"+(+r[1]-n))}return e(t)}}("round");const kr=Symbol("fabric-path-editor-symbol"),Mr=Symbol("fabric-path-editor-controller-info");var Br,Nr;!function(t){t.MAJOR_POINT="major-point",t.SUB_POINT="sub-point"}(Br||(Br={})),function(t){t.START="M",t.LINE="L",t.QUADRATIC_CURCE="Q",t.BEZIER_CURVE="C",t.CLOSE="z"}(Nr||(Nr={}));const Lr=[Nr.QUADRATIC_CURCE,Nr.BEZIER_CURVE];class Dr{constructor(t,e={}){this._options={},this.source=null,this.target=null,this.controllers={points:[]},this.listeners=[],this._inbuiltStatus={cancelHandlerMirrorMove:!1},this._storePlatformStatus=null,this._platform=t,this._options=hr(e,this._options)}observe(t){this.source=t}static transformPath(t,e,n=!0){const{translate:r,scale:i,rotate:o}=e,s=n?t.path:tr(t.path);return null==s||s.forEach(((t,e)=>{const[,...n]=t;for(let t=0;t<n.length;t+=2){let n=s[e][t+1],c=s[e][t+2];void 0!==i&&(n*=i.x,c*=i.y),void 0!==o&&(n=Math.cos(o*Math.PI/180)*n-Math.sin(o*Math.PI/180)*c,c=Math.sin(o*Math.PI/180)*n+Math.cos(o*Math.PI/180)*c),void 0!==r&&(n+=r.x,c+=r.y),s[e][t+1]=n,s[e][t+2]=c}})),s}static initializePath(t,n,r=[1,0,0,1,0,0]){var i;const o=t.left,s=t.top;null===(i=t.path)||void 0===i||i.forEach((t=>{const[,...e]=t;for(let n=0;n<e.length;n+=2)t[n+1]=Ur(t[n+1],3),t[n+2]=Ur(t[n+2],3)}));const c=new e.fabric.Path(e.fabric.util.joinPath(t.path)).getCenterPoint();t.initialize(n);const a=new e.fabric.Path(n).getCenterPoint(),u=e.fabric.util.transformPoint(new e.fabric.Point(a.x-c.x,a.y-c.y),r);t.set({left:o+u.x,top:s+u.y}),t.setCoords()}static convertQuadraticToCubic(t,e){const n=Array.from({length:2}).map(((t,n)=>({x:e[2*n+1],y:e[2*n+2]}))),[r,i]=n,o={x:2/3*r.x+1/3*t.x,y:2/3*r.y+1/3*t.y},s={x:2/3*r.x+1/3*i.x,y:2/3*r.y+1/3*i.y},c=i;return["C",o.x,o.y,s.x,s.y,c.x,c.y]}_patchPath(t){if(!t.path)return;Dr.transformPath(t,{translate:{x:-t.pathOffset.x,y:-t.pathOffset.y}});const n=this._splitPath(t.path);for(const t of n){if(t[t.length-1][0]===Nr.CLOSE){const e=t[0].slice(t[0].length-2),n=t[t.length-2].slice(t[t.length-2].length-2);t[0]!==t[t.length-2]&&n[0]===e[0]&&n[1]===e[1]||t.splice(t.length-1,0,[Nr.LINE,e[0],e[1]])}}t.path=n.flat(1),t.pathOffset=new e.fabric.Point(0,0)}_initPlatformStatus(){var t;if(!this._platform)return;const e=this._platform;this._storePlatformStatus={canvasSelection:null!==(t=e.selection)&&void 0!==t&&t,objectSelections:new WeakMap(e._objects.map((t=>{var e;return[t,null===(e=t.selectable)||void 0===e||e]})))},e.selection=!1,e.preserveObjectStacking=!0,e.controlsAboveOverlay=!0,e.discardActiveObject(),e.forEachObject((t=>{t.set({selectable:!1})}))}_splitPath(t){return t.reduce(((t,e,n,r)=>e?(e[0]===Nr.START&&t[t.length-1].length&&t.push([]),t[t.length-1].push(e),e[0]===Nr.CLOSE&&n!==r.length-1&&t.push([]),t):t),[[]])}_getAroundInstructions(t){var e;const n=this.target.path,r=this._splitPath(n).find((e=>e.includes(t))),i=r.indexOf(t);let o=r[i-1],s=r[i+1];return(null===(e=r[r.length-1])||void 0===e?void 0:e[0])===Nr.CLOSE&&!o&&(o=r[r.length-2]),s&&s[0]===Nr.CLOSE&&(s=r[0]),{path:r,cur:t,pre:null!=o?o:null,next:null!=s?s:null}}_getInstructionMajorPoint(t){return this.controllers.points.find((e=>e[Mr].instruction===t))}_getAroundPoints(t){const{path:e,cur:n,pre:r,next:i}=this._getAroundInstructions(t[Mr].instruction),o={instruction:n,instructionValueIdx:n.length-2,point:{x:n[n.length-2],y:n[n.length-1]},pointType:Br.MAJOR_POINT};let s,c;switch(n[0]){case Nr.START:if(r)if(Lr.includes(r[0]))s={instruction:r,instructionValueIdx:r.length-4,point:{x:r[r.length-4],y:r[r.length-3]},pointType:Br.SUB_POINT};else{const t=e[2%(e.length-1)];s={instruction:t,instructionValueIdx:t.length-2,point:{x:t[t.length-2],y:t[t.length-1]},pointType:Br.MAJOR_POINT}}break;case Nr.LINE:r&&(s={instruction:r,instructionValueIdx:r.length-2,point:{x:r[r.length-2],y:r[r.length-1]},pointType:Br.MAJOR_POINT});break;case Nr.QUADRATIC_CURCE:s={instruction:n,instructionValueIdx:1,point:{x:n[1],y:n[2]},pointType:Br.SUB_POINT};break;case Nr.BEZIER_CURVE:s={instruction:n,instructionValueIdx:3,point:{x:n[3],y:n[4]},pointType:Br.SUB_POINT}}return i&&(c={instruction:i,instructionValueIdx:1,point:{x:i[1],y:i[2]},pointType:Lr.includes(i[0])?Br.SUB_POINT:Br.MAJOR_POINT}),{cur:o,pre:s,next:c}}_updatePathInstruction(t,e){t.splice(0,t.length,...e)}_calcAbsolutePosition(t){const n=e.fabric.util.transformPoint(new e.fabric.Point(t.x,t.y),this.source.calcOwnMatrix());return{left:n.x,top:n.y}}_calcRelativeCrood(t){return e.fabric.util.transformPoint(new e.fabric.Point(t.left,t.top),e.fabric.util.invertTransform(this.source.calcOwnMatrix()))}_initPathControlPoints(){var t;const n=this._platform,r=this.target;if(!n||!r)return;const i=this.controllers.points;i.length&&n.remove(...i);const o=[];null===(t=this._splitPath(r.path))||void 0===t||t.forEach((t=>{t.forEach(((n,r)=>{var s,c;const a=n;if(a[0]===Nr.CLOSE)return;if((null===(s=t[r+1])||void 0===s?void 0:s[0])===Nr.CLOSE)return;const[u,l]=a.slice(a.length-2),f=null!==(c=i.pop())&&void 0!==c?c:new e.fabric.Group([new e.fabric.Circle({strokeWidth:4,radius:6,fill:"#ffffff",stroke:"#4b4b4b",originX:"center",originY:"center"})],{originX:"center",originY:"center",hasBorders:!1,hasControls:!1});f[kr]=!0,f[Mr]={type:Br.MAJOR_POINT,instruction:a,instructionValueIdx:a.length-2},this._observe(f,(({left:t,top:e},n)=>{const r=this._calcRelativeCrood({left:t,top:e});this._calcRelativeCrood(n);const{path:i}=this._getAroundInstructions(f[Mr].instruction),{handlers:o}=this.controllers,s=r.x-a[a.length-2],c=r.y-a[a.length-1],u=null==o?void 0:o.find((t=>t.belong===f&&"pre"===t.belongPosition));u&&u.point.set({left:u.point.left+s,top:u.point.top+c});const l=null==o?void 0:o.find((t=>t.belong===f&&"next"===t.belongPosition));l&&l.point.set({left:l.point.left+s,top:l.point.top+c}),a[a.length-2]=r.x,a[a.length-1]=r.y;const h=i[i.length-2];h&&a!==h&&h[0]!==Nr.CLOSE&&i[0]===a&&i[i.length-1][0]===Nr.CLOSE&&(h[h.length-2]=r.x,h[h.length-1]=r.y),f.setCoords()})),f.set(this._calcAbsolutePosition({x:u,y:l})),o.push(f)}))})),n.add(...o),this.controllers.points=o}_createPathControlHandler(){const t=new e.fabric.Group([new e.fabric.Circle({radius:4,stroke:"#bebebe",strokeWidth:2,fill:"#bebebe",originX:"center",originY:"center"})],{originX:"center",originY:"center",hasBorders:!1,hasControls:!1});t[kr]=!0,t[Mr]={type:Br.SUB_POINT};return{point:t,line:new e.fabric.Line([0,0,0,0],{stroke:"#bebebe",strokeWidth:1,strokeDashArray:[4,3],strokeUniform:!0,selectable:!1,evented:!1,originX:"center",originY:"center"})}}_observe(t,e){let{left:n=0,top:r=0}=t;Object.defineProperties(t,{left:{get:()=>n,set:t=>{if(n===t)return;const i={left:n,top:r};n=t,e({left:n,top:r},i)}},top:{get:()=>r,set:t=>{if(r===t)return;const i={left:n,top:r};r=t,e({left:n,top:r},i)}}})}_on(t,e,n){"global"===t&&window.addEventListener(e,n),"canvas"===t&&this._platform.on(e,n),this.listeners.push({type:t,eventName:e,handler:n})}_initEvents(){(()=>{this._on("canvas","selection:created",(t=>{this.focus(...t.selected)})),this._on("canvas","selection:updated",(t=>{this.focus(...t.selected)})),this._on("canvas","selection:cleared",(()=>{this.focus()}))})(),(()=>{let t;const e=[{combinationKeys:["alt"],onActivate:()=>{this._inbuiltStatus.cancelHandlerMirrorMove=!0},onDeactivate:()=>{this._inbuiltStatus.cancelHandlerMirrorMove=!1}},{key:"backspace",onActivate:()=>{this.remove()}}],n=()=>{var e;t&&(null===(e=t.onDeactivate)||void 0===e||e.call(t),t=void 0)},r=r=>{let i=r.key.toLowerCase();e.forEach((e=>{var o;const{key:s,combinationKeys:c=[]}=e;(s||0!==c.length)&&("keyup"===r.type&&(i=""),s&&s!==i||c.some((t=>!r[`${t}Key`]))?"keyup"===r.type&&n():t!==e&&(null===(o=null==t?void 0:t.onDeactivate)||void 0===o||o.call(t),t=e,null==t||t.onActivate()))}))};this._on("global","keydown",r.bind(this)),this._on("global","keyup",r.bind(this)),this._on("global","blur",n)})(),(()=>{this._on("canvas","mouse:dblclick",(t=>{var e,n;const r=t.target;if((null===(e=r[Mr])||void 0===e?void 0:e.type)===Br.MAJOR_POINT){const{pre:t,next:e}=this._getAroundPoints(r);[t,e].every((t=>!t||(null==t?void 0:t.pointType)===Br.SUB_POINT))?this.transferToLine(r,"both"):this.transferToCurce(r)}if((null===(n=r[Mr])||void 0===n?void 0:n.type)===Br.SUB_POINT){const{cur:t,pre:e}=this._getAroundInstructions(r[Mr].instruction);if(t[0]===Nr.BEZIER_CURVE)return;t[0]=Nr.BEZIER_CURVE,this._updatePathInstruction(t,Dr.convertQuadraticToCubic({x:e[e.length-2],y:e[e.length-1]},t))}this._updatePointHandlers()}))})()}async enterEditing(t){if(!this.source||"path"!==this.source.type)throw Error("Please observe target path before editing.");this._initPlatformStatus(),this.target=await new Promise((t=>this.source.clone(t))),this._patchPath(this.target),t&&t(this.target),this.target[kr]=!0,this.target.set({selectable:!1,objectCaching:!1}),this._platform.add(this.target),this._platform.renderOnAddRemove=!1,this._initPathControlPoints(),this._platform.renderOnAddRemove=!0,this._platform.renderAll(),this._initEvents(),this.focus(this.controllers.points[0])}leaveEditing(){}_updatePointHandlers(){const t=this._platform,{handlers:e=[],activePoint:n}=this.controllers;if(t.remove(...e.map((t=>[t.point,t.line])).flat(1)),!n)return;const{pre:r,cur:i,next:o}=this._getAroundInstructions(n[Mr].instruction),s=[];[i[0]===Nr.START&&r?this._getAroundInstructions(r).pre:r,i,o].map(((t,e,n)=>{var o;if(!t)return;const c=this._getInstructionMajorPoint(t);if(!c)return;const a=this._getAroundPoints(c);a.pre&&s.push({item:a.pre,belong:c,belongPosition:"pre",hidden:0===e||2===e&&t[0]===Nr.QUADRATIC_CURCE}),a.next&&s.push({item:a.next,belong:c,belongPosition:"next",hidden:2===e||0===e&&(null===(o=i[0]===Nr.START?r:i)||void 0===o?void 0:o[0])===Nr.QUADRATIC_CURCE})}));const c=s.map((({item:e,belong:n,belongPosition:r,hidden:i})=>{if(!e)return;const{point:o,pointType:s,instruction:c,instructionValueIdx:a}=e;if(!o)return;if(s!==Br.SUB_POINT)return;const u=this._createPathControlHandler();return u.belong=n,u.belongPosition=r,u.point[Mr].instruction=c,u.point[Mr].instructionValueIdx=a,i&&(u.point.set({visible:!1}),u.line.set({visible:!1})),this._observe(u.point,(({left:t,top:e})=>{const{x:r,y:i}=this._calcRelativeCrood({left:t,top:e});u.line.set({x1:n.left,y1:n.top,x2:u.point.left,y2:u.point.top}),c[a]=r,c[a+1]=i,this._inbuiltStatus.cancelHandlerMirrorMove?(u.mirror&&(u.mirror.mirror=void 0),u.mirror=void 0):this.controllers.activeHandlerPoint&&u.mirror&&(u.mirror.point.set({left:2*n.left-u.point.left,top:2*n.top-u.point.top}),u.mirror.line.set({x1:n.left,y1:n.top,x2:u.mirror.point.left,y2:u.mirror.point.top})),u.point.setCoords()})),u.point.set(this._calcAbsolutePosition(o)),t.add(u.line,u.point),u}));for(const t of c)if("pre"===(null==t?void 0:t.belongPosition)){const e=t.belong;if(!e)continue;const n=c.find((t=>(null==t?void 0:t.belong)===e&&"next"===(null==t?void 0:t.belongPosition)));void 0!==t&&void 0!==n&&t.point.left+n.point.left===2*e.left&&t.point.top+n.point.top===2*e.top&&(t.mirror=n,n.mirror=t)}this.controllers.handlers=c.filter(Boolean)}focus(...t){const e=this._platform,{handlers:n=[],activePoint:r}=this.controllers,i=t[0],o=t=>{const e=n.find((e=>(null==e?void 0:e.point)===t));e&&e.point.item(0).set({stroke:"#4b4b4b"}),this.controllers.activeHandlerPoint=t};(()=>{n.forEach((t=>{t&&t.point.item(0).set({stroke:"#bebebe"})})),this.controllers.activeHandlerPoint=void 0})(),i?(i[Mr].type===Br.MAJOR_POINT&&(null==r||r.item(0).set({fill:"#ffffff"}),this.controllers.activePoint=i,i.item(0).set({fill:"#29ca6e"}),this._updatePointHandlers()),i[Mr].type===Br.SUB_POINT&&o(i),e.setActiveObject(i)):(null==r||r.item(0).set({fill:"#ffffff"}),this.controllers.activePoint=void 0,e.discardActiveObject(),this._updatePointHandlers()),e.renderAll()}remove(t){var e,n;if(void 0===t&&(t=null!==(e=this.controllers.activeHandlerPoint)&&void 0!==e?e:this.controllers.activePoint),!t||!this.target)return;const r=this._platform,i=this.target.path;if(!i)return;const{type:o,instruction:s}=t[Mr];if(s){switch(o){case Br.MAJOR_POINT:{const t=this._splitPath(i),e=t.findIndex((t=>t.includes(s))),r=t[e].indexOf(s),o=tr(t[e]),c=o.slice(0,r),a=o.slice(r+1);if((null===(n=a[a.length-1])||void 0===n?void 0:n[0])===Nr.CLOSE){a.pop();const n=a[a.length-1];if(0===r&&n&&Xe(n.slice(n.length-2),s.slice(s.length-2)))a.pop();else{const t=c[0];(null==t?void 0:t[0])===Nr.START&&(t[0]=Nr.LINE,Xe(t.slice(t.length-2),n.slice(n.length-2))&&c.shift())}a.push(...c),t.splice(e,1,a)}else t.splice(e,1,c,a);const u=a[0];u&&(u.splice(1,{[Nr.START]:0,[Nr.LINE]:0,[Nr.BEZIER_CURVE]:4,[Nr.QUADRATIC_CURCE]:2}[u[0]]),u[0]=Nr.START),this.target.path=t.flat(1),this._initPathControlPoints();break}case Br.SUB_POINT:const{handlers:e}=this.controllers,r=null==e?void 0:e.find((e=>e.point===t));r&&this.transferToLine(r.belong,r.belongPosition)}this.focus(),r.requestRenderAll()}}transferToLine(t,e){if(!this.controllers.points.includes(t))return;const{cur:n,next:r,pre:i}=this._getAroundInstructions(t[Mr].instruction);if("pre"===e||"both"===e){const t=n[0]===Nr.START?i:n;t&&(t.splice(1,{[Nr.BEZIER_CURVE]:4,[Nr.QUADRATIC_CURCE]:2}[t[0]]),t[0]=Nr.LINE)}"next"!==e&&"both"!==e||r&&(r.splice(1,{[Nr.BEZIER_CURVE]:4,[Nr.QUADRATIC_CURCE]:2}[r[0]]),r[0]=Nr.LINE),this._platform.requestRenderAll()}transferToCurce(t){if(!this.controllers.points.includes(t))return;const{cur:n,pre:r,next:i}=this._getAroundInstructions(t[Mr].instruction);if(!r&&!i)return;const o=n[0]===Nr.START&&r?this._getAroundInstructions(r).pre:r;if(o&&i){const t=[o,n,i].map((t=>({x:t[t.length-2],y:t[t.length-1]}))),s=w.quadraticFromPoints(...t),{t:c}=s.project(t[1]),a=s.split(c),u=new e.fabric.Path(a.left.toSVG()+a.right.toSVG()),l=n[0]===Nr.START?r:n;l&&!Lr.includes(l[0])&&this._updatePathInstruction(l,u.path[1]),i&&!Lr.includes(i[0])&&this._updatePathInstruction(i,u.path[3])}else{const t={x:n[n.length-2],y:n[n.length-1]},e=null!=i?i:o,s={x:e[e.length-2],y:e[e.length-1]},c=Math.sqrt(Math.pow(t.x-s.x,2)+Math.pow(t.y-s.y,2)),a={x:t.x+(s.y-t.y)/c*(c/3),y:t.y+(s.x-t.x)/c*(c/3)};if(o){const e=n[0]===Nr.START?r:n;this._updatePathInstruction(e,[Nr.QUADRATIC_CURCE,a.x,a.y,t.x,t.y])}else i&&this._updatePathInstruction(i,[Nr.QUADRATIC_CURCE,a.x,a.y,s.x,s.y])}}destroy(){}}return Dr}));
